import{a as l,b as g,c as he,d as C,e as Cs,f as Re,g as Ps,h,i as v,j,k as ee,l as z}from"./chunk-TJICSKBO.js";var no=C((vb,ro)=>{"use strict";ro.exports=function(r,e){if(typeof r!="string")throw new TypeError("Expected a string");return e=typeof e>"u"?"_":e,r.replace(/([a-z\d])([A-Z])/g,"$1"+e+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+e+"$2").toLowerCase()}});var lo=C((xb,Is)=>{"use strict";var Jd=/[\p{Lu}]/u,Wd=/[\p{Ll}]/u,so=/^[\p{Lu}](?![\p{Lu}])/gu,oo=/([\p{Alpha}\p{N}_]|$)/u,uo=/[_.\- ]+/,Kd=new RegExp("^"+uo.source),ao=new RegExp(uo.source+oo.source,"gu"),io=new RegExp("\\d+"+oo.source,"gu"),Xd=(r,e,t)=>{let n=!1,s=!1,a=!1;for(let i=0;i<r.length;i++){let o=r[i];n&&Jd.test(o)?(r=r.slice(0,i)+"-"+r.slice(i),n=!1,a=s,s=!0,i++):s&&a&&Wd.test(o)?(r=r.slice(0,i-1)+"-"+r.slice(i-1),a=s,s=!1,n=!0):(n=e(o)===o&&t(o)!==o,a=s,s=t(o)===o&&e(o)!==o)}return r},Yd=(r,e)=>(so.lastIndex=0,r.replace(so,t=>e(t))),Qd=(r,e)=>(ao.lastIndex=0,io.lastIndex=0,r.replace(ao,(t,n)=>e(n)).replace(io,t=>e(t))),co=(r,e)=>{if(!(typeof r=="string"||Array.isArray(r)))throw new TypeError("Expected the input to be `string | string[]`");if(e=l({pascalCase:!1,preserveConsecutiveUppercase:!1},e),Array.isArray(r)?r=r.map(a=>a.trim()).filter(a=>a.length).join("-"):r=r.trim(),r.length===0)return"";let t=e.locale===!1?a=>a.toLowerCase():a=>a.toLocaleLowerCase(e.locale),n=e.locale===!1?a=>a.toUpperCase():a=>a.toLocaleUpperCase(e.locale);return r.length===1?e.pascalCase?n(r):t(r):(r!==t(r)&&(r=Xd(r,t,n)),r=r.replace(Kd,""),e.preserveConsecutiveUppercase?r=Yd(r,t):r=t(r),e.pascalCase&&(r=n(r.charAt(0))+r.slice(1)),Qd(r,n))};Is.exports=co;Is.exports.default=co});var wo=C((Cw,bo)=>{"use strict";function Ce(r,e){typeof e=="boolean"&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(r)),this._timeouts=r,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}bo.exports=Ce;Ce.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};Ce.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};Ce.prototype.retry=function(r){if(this._timeout&&clearTimeout(this._timeout),!r)return!1;var e=new Date().getTime();if(r&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(r),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(r);var t=this._timeouts.shift();if(t===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),t=this._cachedTimeouts.slice(-1);else return!1;var n=this;return this._timer=setTimeout(function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout(function(){n._operationTimeoutCb(n._attempts)},n._operationTimeout),n._options.unref&&n._timeout.unref()),n._fn(n._attempts)},t),this._options.unref&&this._timer.unref(),!0};Ce.prototype.attempt=function(r,e){this._fn=r,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var t=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){t._operationTimeoutCb()},t._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};Ce.prototype.try=function(r){console.log("Using RetryOperation.try() is deprecated"),this.attempt(r)};Ce.prototype.start=function(r){console.log("Using RetryOperation.start() is deprecated"),this.attempt(r)};Ce.prototype.start=Ce.prototype.try;Ce.prototype.errors=function(){return this._errors};Ce.prototype.attempts=function(){return this._attempts};Ce.prototype.mainError=function(){if(this._errors.length===0)return null;for(var r={},e=null,t=0,n=0;n<this._errors.length;n++){var s=this._errors[n],a=s.message,i=(r[a]||0)+1;r[a]=i,i>=t&&(e=s,t=i)}return e}});var vo=C(Ct=>{"use strict";var of=wo();Ct.operation=function(r){var e=Ct.timeouts(r);return new of(e,{forever:r&&(r.forever||r.retries===1/0),unref:r&&r.unref,maxRetryTime:r&&r.maxRetryTime})};Ct.timeouts=function(r){if(r instanceof Array)return[].concat(r);var e={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var t in r)e[t]=r[t];if(e.minTimeout>e.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var n=[],s=0;s<e.retries;s++)n.push(this.createTimeout(s,e));return r&&r.forever&&!n.length&&n.push(this.createTimeout(s,e)),n.sort(function(a,i){return a-i}),n};Ct.createTimeout=function(r,e){var t=e.randomize?Math.random()+1:1,n=Math.round(t*Math.max(e.minTimeout,1)*Math.pow(e.factor,r));return n=Math.min(n,e.maxTimeout),n};Ct.wrap=function(r,e,t){if(e instanceof Array&&(t=e,e=null),!t){t=[];for(var n in r)typeof r[n]=="function"&&t.push(n)}for(var s=0;s<t.length;s++){var a=t[s],i=r[a];r[a]=(function(u){var c=Ct.operation(e),d=Array.prototype.slice.call(arguments,1),f=d.pop();d.push(function(p){c.retry(p)||(p&&(arguments[0]=c.mainError()),f.apply(this,arguments))}),c.attempt(function(){u.apply(r,d)})}).bind(r,i),r[a].options=e}}});var Eo=C((Iw,xo)=>{"use strict";xo.exports=vo()});var ln=C((To,cn)=>{"use strict";var uf=Eo(),cf=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"],un=class extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}},lf=(r,e,t)=>{let n=t.retries-(e-1);return r.attemptNumber=e,r.retriesLeft=n,r},df=r=>cf.includes(r),Oo=(r,e)=>new Promise((t,n)=>{e=l({onFailedAttempt:()=>{},retries:10},e);let s=uf.operation(e);s.attempt(a=>h(null,null,function*(){try{t(yield r(a))}catch(i){if(!(i instanceof Error)){n(new TypeError(`Non-error was thrown: "${i}". You should only throw errors.`));return}if(i instanceof un)s.stop(),n(i.originalError);else if(i instanceof TypeError&&!df(i.message))s.stop(),n(i);else{lf(i,a,e);try{yield e.onFailedAttempt(i)}catch(o){n(o);return}s.retry(i)||n(s.mainError())}}}))});cn.exports=Oo;cn.exports.default=Oo;cn.exports.AbortError=un});var Ao=C(($w,Us)=>{"use strict";var ff=Object.prototype.hasOwnProperty,_e="~";function mr(){}Object.create&&(mr.prototype=Object.create(null),new mr().__proto__||(_e=!1));function hf(r,e,t){this.fn=r,this.context=e,this.once=t||!1}function So(r,e,t,n,s){if(typeof t!="function")throw new TypeError("The listener must be a function");var a=new hf(t,n||r,s),i=_e?_e+e:e;return r._events[i]?r._events[i].fn?r._events[i]=[r._events[i],a]:r._events[i].push(a):(r._events[i]=a,r._eventsCount++),r}function dn(r,e){--r._eventsCount===0?r._events=new mr:delete r._events[e]}function pe(){this._events=new mr,this._eventsCount=0}pe.prototype.eventNames=function(){var e=[],t,n;if(this._eventsCount===0)return e;for(n in t=this._events)ff.call(t,n)&&e.push(_e?n.slice(1):n);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e};pe.prototype.listeners=function(e){var t=_e?_e+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var s=0,a=n.length,i=new Array(a);s<a;s++)i[s]=n[s].fn;return i};pe.prototype.listenerCount=function(e){var t=_e?_e+e:e,n=this._events[t];return n?n.fn?1:n.length:0};pe.prototype.emit=function(e,t,n,s,a,i){var o=_e?_e+e:e;if(!this._events[o])return!1;var u=this._events[o],c=arguments.length,d,f;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),c){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,n),!0;case 4:return u.fn.call(u.context,t,n,s),!0;case 5:return u.fn.call(u.context,t,n,s,a),!0;case 6:return u.fn.call(u.context,t,n,s,a,i),!0}for(f=1,d=new Array(c-1);f<c;f++)d[f-1]=arguments[f];u.fn.apply(u.context,d)}else{var p=u.length,m;for(f=0;f<p;f++)switch(u[f].once&&this.removeListener(e,u[f].fn,void 0,!0),c){case 1:u[f].fn.call(u[f].context);break;case 2:u[f].fn.call(u[f].context,t);break;case 3:u[f].fn.call(u[f].context,t,n);break;case 4:u[f].fn.call(u[f].context,t,n,s);break;default:if(!d)for(m=1,d=new Array(c-1);m<c;m++)d[m-1]=arguments[m];u[f].fn.apply(u[f].context,d)}}return!0};pe.prototype.on=function(e,t,n){return So(this,e,t,n,!1)};pe.prototype.once=function(e,t,n){return So(this,e,t,n,!0)};pe.prototype.removeListener=function(e,t,n,s){var a=_e?_e+e:e;if(!this._events[a])return this;if(!t)return dn(this,a),this;var i=this._events[a];if(i.fn)i.fn===t&&(!s||i.once)&&(!n||i.context===n)&&dn(this,a);else{for(var o=0,u=[],c=i.length;o<c;o++)(i[o].fn!==t||s&&!i[o].once||n&&i[o].context!==n)&&u.push(i[o]);u.length?this._events[a]=u.length===1?u[0]:u:dn(this,a)}return this};pe.prototype.removeAllListeners=function(e){var t;return e?(t=_e?_e+e:e,this._events[t]&&dn(this,t)):(this._events=new mr,this._eventsCount=0),this};pe.prototype.off=pe.prototype.removeListener;pe.prototype.addListener=pe.prototype.on;pe.prefixed=_e;pe.EventEmitter=pe;typeof Us<"u"&&(Us.exports=pe)});var ko=C((Lw,Ro)=>{"use strict";Ro.exports=(r,e)=>(e=e||(()=>{}),r.then(t=>new Promise(n=>{n(e())}).then(()=>t),t=>new Promise(n=>{n(e())}).then(()=>{throw t})))});var Po=C((jw,hn)=>{"use strict";var pf=ko(),fn=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},Co=(r,e,t)=>new Promise((n,s)=>{if(typeof e!="number"||e<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(e===1/0){n(r);return}let a=setTimeout(()=>{if(typeof t=="function"){try{n(t())}catch(u){s(u)}return}let i=typeof t=="string"?t:`Promise timed out after ${e} milliseconds`,o=t instanceof Error?t:new fn(i);typeof r.cancel=="function"&&r.cancel(),s(o)},e);pf(r.then(n,s),()=>{clearTimeout(a)})});hn.exports=Co;hn.exports.default=Co;hn.exports.TimeoutError=fn});var Io=C(Fs=>{"use strict";Object.defineProperty(Fs,"__esModule",{value:!0});function mf(r,e,t){let n=0,s=r.length;for(;s>0;){let a=s/2|0,i=n+a;t(r[i],e)<=0?(n=++i,s-=a+1):s=a}return n}Fs.default=mf});var No=C(qs=>{"use strict";Object.defineProperty(qs,"__esModule",{value:!0});var gf=Io(),Bs=class{constructor(){this._queue=[]}enqueue(e,t){t=Object.assign({priority:0},t);let n={priority:t.priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority){this._queue.push(n);return}let s=gf.default(this._queue,n,(a,i)=>i.priority-a.priority);this._queue.splice(s,0,n)}dequeue(){let e=this._queue.shift();return e?.run}filter(e){return this._queue.filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return this._queue.length}};qs.default=Bs});var mn=C(zs=>{"use strict";Object.defineProperty(zs,"__esModule",{value:!0});var yf=Ao(),$o=Po(),_f=No(),pn=()=>{},bf=new $o.TimeoutError,Hs=class extends yf{constructor(e){var t,n,s,a;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=pn,this._resolveIdle=pn,e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:_f.default},e),!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(n=(t=e.intervalCap)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(a=(s=e.interval)===null||s===void 0?void 0:s.toString())!==null&&a!==void 0?a:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||e.interval===0,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=e.throwOnTimeout===!0,this._isPaused=e.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=pn,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=pn,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){let e=Date.now();if(this._intervalId===void 0){let t=this._intervalEnd-e;if(t<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},t)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){let e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){let t=this._queue.dequeue();return t?(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}add(n){return h(this,arguments,function*(e,t={}){return new Promise((s,a)=>{let i=()=>h(this,null,function*(){this._pendingCount++,this._intervalCount++;try{let o=this._timeout===void 0&&t.timeout===void 0?e():$o.default(Promise.resolve(e()),t.timeout===void 0?this._timeout:t.timeout,()=>{(t.throwOnTimeout===void 0?this._throwOnTimeout:t.throwOnTimeout)&&a(bf)});s(yield o)}catch(o){a(o)}this._next()});this._queue.enqueue(i,t),this._tryToStartAnother(),this.emit("add")})})}addAll(e,t){return h(this,null,function*(){return Promise.all(e.map(n=>h(this,null,function*(){return this.add(n,t)})))})}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}onEmpty(){return h(this,null,function*(){if(this._queue.size!==0)return new Promise(e=>{let t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}})})}onIdle(){return h(this,null,function*(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(e=>{let t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}})})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}};zs.default=Hs});var Mo=C(yn=>{"use strict";yn.byteLength=Ef;yn.toByteArray=Tf;yn.fromByteArray=Rf;var Ye=[],Pe=[],xf=typeof Uint8Array<"u"?Uint8Array:Array,Zs="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(Pt=0,jo=Zs.length;Pt<jo;++Pt)Ye[Pt]=Zs[Pt],Pe[Zs.charCodeAt(Pt)]=Pt;var Pt,jo;Pe[45]=62;Pe[95]=63;function Do(r){var e=r.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=r.indexOf("=");t===-1&&(t=e);var n=t===e?0:4-t%4;return[t,n]}function Ef(r){var e=Do(r),t=e[0],n=e[1];return(t+n)*3/4-n}function Of(r,e,t){return(e+t)*3/4-t}function Tf(r){var e,t=Do(r),n=t[0],s=t[1],a=new xf(Of(r,n,s)),i=0,o=s>0?n-4:n,u;for(u=0;u<o;u+=4)e=Pe[r.charCodeAt(u)]<<18|Pe[r.charCodeAt(u+1)]<<12|Pe[r.charCodeAt(u+2)]<<6|Pe[r.charCodeAt(u+3)],a[i++]=e>>16&255,a[i++]=e>>8&255,a[i++]=e&255;return s===2&&(e=Pe[r.charCodeAt(u)]<<2|Pe[r.charCodeAt(u+1)]>>4,a[i++]=e&255),s===1&&(e=Pe[r.charCodeAt(u)]<<10|Pe[r.charCodeAt(u+1)]<<4|Pe[r.charCodeAt(u+2)]>>2,a[i++]=e>>8&255,a[i++]=e&255),a}function Sf(r){return Ye[r>>18&63]+Ye[r>>12&63]+Ye[r>>6&63]+Ye[r&63]}function Af(r,e,t){for(var n,s=[],a=e;a<t;a+=3)n=(r[a]<<16&16711680)+(r[a+1]<<8&65280)+(r[a+2]&255),s.push(Sf(n));return s.join("")}function Rf(r){for(var e,t=r.length,n=t%3,s=[],a=16383,i=0,o=t-n;i<o;i+=a)s.push(Af(r,i,i+a>o?o:i+a));return n===1?(e=r[t-1],s.push(Ye[e>>2]+Ye[e<<4&63]+"==")):n===2&&(e=(r[t-2]<<8)+r[t-1],s.push(Ye[e>>10]+Ye[e>>4&63]+Ye[e<<2&63]+"=")),s.join("")}});var du=C((zv,lu)=>{"use strict";var uu=(r=0)=>e=>`\x1B[${38+r};5;${e}m`,cu=(r=0)=>(e,t,n)=>`\x1B[${38+r};2;${e};${t};${n}m`;function np(){let r=new Map,e={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};e.color.gray=e.color.blackBright,e.bgColor.bgGray=e.bgColor.bgBlackBright,e.color.grey=e.color.blackBright,e.bgColor.bgGrey=e.bgColor.bgBlackBright;for(let[t,n]of Object.entries(e)){for(let[s,a]of Object.entries(n))e[s]={open:`\x1B[${a[0]}m`,close:`\x1B[${a[1]}m`},n[s]=e[s],r.set(a[0],a[1]);Object.defineProperty(e,t,{value:n,enumerable:!1})}return Object.defineProperty(e,"codes",{value:r,enumerable:!1}),e.color.close="\x1B[39m",e.bgColor.close="\x1B[49m",e.color.ansi256=uu(),e.color.ansi16m=cu(),e.bgColor.ansi256=uu(10),e.bgColor.ansi16m=cu(10),Object.defineProperties(e,{rgbToAnsi256:{value:(t,n,s)=>t===n&&n===s?t<8?16:t>248?231:Math.round((t-8)/247*24)+232:16+36*Math.round(t/255*5)+6*Math.round(n/255*5)+Math.round(s/255*5),enumerable:!1},hexToRgb:{value:t=>{let n=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(t.toString(16));if(!n)return[0,0,0];let{colorString:s}=n.groups;s.length===3&&(s=s.split("").map(i=>i+i).join(""));let a=Number.parseInt(s,16);return[a>>16&255,a>>8&255,a&255]},enumerable:!1},hexToAnsi256:{value:t=>e.rgbToAnsi256(...e.hexToRgb(t)),enumerable:!1}}),e}Object.defineProperty(lu,"exports",{enumerable:!0,get:np})});var Or=C((b0,_u)=>{"use strict";var vp="2.0.0",xp=Number.MAX_SAFE_INTEGER||9007199254740991,Ep=16,Op=250,Tp=["major","premajor","minor","preminor","patch","prepatch","prerelease"];_u.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:Ep,MAX_SAFE_BUILD_LENGTH:Op,MAX_SAFE_INTEGER:xp,RELEASE_TYPES:Tp,SEMVER_SPEC_VERSION:vp,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}});var Tr=C((w0,bu)=>{"use strict";var Sp=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...r)=>console.error("SEMVER",...r):()=>{};bu.exports=Sp});var Qt=C((tt,wu)=>{"use strict";var{MAX_SAFE_COMPONENT_LENGTH:Ta,MAX_SAFE_BUILD_LENGTH:Ap,MAX_LENGTH:Rp}=Or(),kp=Tr();tt=wu.exports={};var Cp=tt.re=[],Pp=tt.safeRe=[],R=tt.src=[],Ip=tt.safeSrc=[],k=tt.t={},Np=0,Sa="[a-zA-Z0-9-]",$p=[["\\s",1],["\\d",Rp],[Sa,Ap]],Lp=r=>{for(let[e,t]of $p)r=r.split(`${e}*`).join(`${e}{0,${t}}`).split(`${e}+`).join(`${e}{1,${t}}`);return r},U=(r,e,t)=>{let n=Lp(e),s=Np++;kp(r,s,e),k[r]=s,R[s]=e,Ip[s]=n,Cp[s]=new RegExp(e,t?"g":void 0),Pp[s]=new RegExp(n,t?"g":void 0)};U("NUMERICIDENTIFIER","0|[1-9]\\d*");U("NUMERICIDENTIFIERLOOSE","\\d+");U("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${Sa}*`);U("MAINVERSION",`(${R[k.NUMERICIDENTIFIER]})\\.(${R[k.NUMERICIDENTIFIER]})\\.(${R[k.NUMERICIDENTIFIER]})`);U("MAINVERSIONLOOSE",`(${R[k.NUMERICIDENTIFIERLOOSE]})\\.(${R[k.NUMERICIDENTIFIERLOOSE]})\\.(${R[k.NUMERICIDENTIFIERLOOSE]})`);U("PRERELEASEIDENTIFIER",`(?:${R[k.NONNUMERICIDENTIFIER]}|${R[k.NUMERICIDENTIFIER]})`);U("PRERELEASEIDENTIFIERLOOSE",`(?:${R[k.NONNUMERICIDENTIFIER]}|${R[k.NUMERICIDENTIFIERLOOSE]})`);U("PRERELEASE",`(?:-(${R[k.PRERELEASEIDENTIFIER]}(?:\\.${R[k.PRERELEASEIDENTIFIER]})*))`);U("PRERELEASELOOSE",`(?:-?(${R[k.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${R[k.PRERELEASEIDENTIFIERLOOSE]})*))`);U("BUILDIDENTIFIER",`${Sa}+`);U("BUILD",`(?:\\+(${R[k.BUILDIDENTIFIER]}(?:\\.${R[k.BUILDIDENTIFIER]})*))`);U("FULLPLAIN",`v?${R[k.MAINVERSION]}${R[k.PRERELEASE]}?${R[k.BUILD]}?`);U("FULL",`^${R[k.FULLPLAIN]}$`);U("LOOSEPLAIN",`[v=\\s]*${R[k.MAINVERSIONLOOSE]}${R[k.PRERELEASELOOSE]}?${R[k.BUILD]}?`);U("LOOSE",`^${R[k.LOOSEPLAIN]}$`);U("GTLT","((?:<|>)?=?)");U("XRANGEIDENTIFIERLOOSE",`${R[k.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);U("XRANGEIDENTIFIER",`${R[k.NUMERICIDENTIFIER]}|x|X|\\*`);U("XRANGEPLAIN",`[v=\\s]*(${R[k.XRANGEIDENTIFIER]})(?:\\.(${R[k.XRANGEIDENTIFIER]})(?:\\.(${R[k.XRANGEIDENTIFIER]})(?:${R[k.PRERELEASE]})?${R[k.BUILD]}?)?)?`);U("XRANGEPLAINLOOSE",`[v=\\s]*(${R[k.XRANGEIDENTIFIERLOOSE]})(?:\\.(${R[k.XRANGEIDENTIFIERLOOSE]})(?:\\.(${R[k.XRANGEIDENTIFIERLOOSE]})(?:${R[k.PRERELEASELOOSE]})?${R[k.BUILD]}?)?)?`);U("XRANGE",`^${R[k.GTLT]}\\s*${R[k.XRANGEPLAIN]}$`);U("XRANGELOOSE",`^${R[k.GTLT]}\\s*${R[k.XRANGEPLAINLOOSE]}$`);U("COERCEPLAIN",`(^|[^\\d])(\\d{1,${Ta}})(?:\\.(\\d{1,${Ta}}))?(?:\\.(\\d{1,${Ta}}))?`);U("COERCE",`${R[k.COERCEPLAIN]}(?:$|[^\\d])`);U("COERCEFULL",R[k.COERCEPLAIN]+`(?:${R[k.PRERELEASE]})?(?:${R[k.BUILD]})?(?:$|[^\\d])`);U("COERCERTL",R[k.COERCE],!0);U("COERCERTLFULL",R[k.COERCEFULL],!0);U("LONETILDE","(?:~>?)");U("TILDETRIM",`(\\s*)${R[k.LONETILDE]}\\s+`,!0);tt.tildeTrimReplace="$1~";U("TILDE",`^${R[k.LONETILDE]}${R[k.XRANGEPLAIN]}$`);U("TILDELOOSE",`^${R[k.LONETILDE]}${R[k.XRANGEPLAINLOOSE]}$`);U("LONECARET","(?:\\^)");U("CARETTRIM",`(\\s*)${R[k.LONECARET]}\\s+`,!0);tt.caretTrimReplace="$1^";U("CARET",`^${R[k.LONECARET]}${R[k.XRANGEPLAIN]}$`);U("CARETLOOSE",`^${R[k.LONECARET]}${R[k.XRANGEPLAINLOOSE]}$`);U("COMPARATORLOOSE",`^${R[k.GTLT]}\\s*(${R[k.LOOSEPLAIN]})$|^$`);U("COMPARATOR",`^${R[k.GTLT]}\\s*(${R[k.FULLPLAIN]})$|^$`);U("COMPARATORTRIM",`(\\s*)${R[k.GTLT]}\\s*(${R[k.LOOSEPLAIN]}|${R[k.XRANGEPLAIN]})`,!0);tt.comparatorTrimReplace="$1$2$3";U("HYPHENRANGE",`^\\s*(${R[k.XRANGEPLAIN]})\\s+-\\s+(${R[k.XRANGEPLAIN]})\\s*$`);U("HYPHENRANGELOOSE",`^\\s*(${R[k.XRANGEPLAINLOOSE]})\\s+-\\s+(${R[k.XRANGEPLAINLOOSE]})\\s*$`);U("STAR","(<|>)?=?\\s*\\*");U("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$");U("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});var jn=C((v0,vu)=>{"use strict";var jp=Object.freeze({loose:!0}),Dp=Object.freeze({}),Mp=r=>r?typeof r!="object"?jp:r:Dp;vu.exports=Mp});var Aa=C((x0,Ou)=>{"use strict";var xu=/^[0-9]+$/,Eu=(r,e)=>{let t=xu.test(r),n=xu.test(e);return t&&n&&(r=+r,e=+e),r===e?0:t&&!n?-1:n&&!t?1:r<e?-1:1},Up=(r,e)=>Eu(e,r);Ou.exports={compareIdentifiers:Eu,rcompareIdentifiers:Up}});var ge=C((E0,Su)=>{"use strict";var Dn=Tr(),{MAX_LENGTH:Tu,MAX_SAFE_INTEGER:Mn}=Or(),{safeRe:Un,t:Fn}=Qt(),Fp=jn(),{compareIdentifiers:er}=Aa(),Ra=class r{constructor(e,t){if(t=Fp(t),e instanceof r){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>Tu)throw new TypeError(`version is longer than ${Tu} characters`);Dn("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;let n=e.trim().match(t.loose?Un[Fn.LOOSE]:Un[Fn.FULL]);if(!n)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>Mn||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Mn||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Mn||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map(s=>{if(/^[0-9]+$/.test(s)){let a=+s;if(a>=0&&a<Mn)return a}return s}):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(Dn("SemVer.compare",this.version,this.options,e),!(e instanceof r)){if(typeof e=="string"&&e===this.version)return 0;e=new r(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof r||(e=new r(e,this.options)),er(this.major,e.major)||er(this.minor,e.minor)||er(this.patch,e.patch)}comparePre(e){if(e instanceof r||(e=new r(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{let n=this.prerelease[t],s=e.prerelease[t];if(Dn("prerelease compare",t,n,s),n===void 0&&s===void 0)return 0;if(s===void 0)return 1;if(n===void 0)return-1;if(n===s)continue;return er(n,s)}while(++t)}compareBuild(e){e instanceof r||(e=new r(e,this.options));let t=0;do{let n=this.build[t],s=e.build[t];if(Dn("build compare",t,n,s),n===void 0&&s===void 0)return 0;if(s===void 0)return 1;if(n===void 0)return-1;if(n===s)continue;return er(n,s)}while(++t)}inc(e,t,n){if(e.startsWith("pre")){if(!t&&n===!1)throw new Error("invalid increment argument: identifier is empty");if(t){let s=`-${t}`.match(this.options.loose?Un[Fn.PRERELEASELOOSE]:Un[Fn.PRERELEASE]);if(!s||s[1]!==t)throw new Error(`invalid identifier: ${t}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,n);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,n);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,n),this.inc("pre",t,n);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",t,n),this.inc("pre",t,n);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{let s=Number(n)?1:0;if(this.prerelease.length===0)this.prerelease=[s];else{let a=this.prerelease.length;for(;--a>=0;)typeof this.prerelease[a]=="number"&&(this.prerelease[a]++,a=-2);if(a===-1){if(t===this.prerelease.join(".")&&n===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(s)}}if(t){let a=[t,s];n===!1&&(a=[t]),er(this.prerelease[0],t)===0?isNaN(this.prerelease[1])&&(this.prerelease=a):this.prerelease=a}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};Su.exports=Ra});var jt=C((O0,Ru)=>{"use strict";var Au=ge(),Bp=(r,e,t=!1)=>{if(r instanceof Au)return r;try{return new Au(r,e)}catch(n){if(!t)return null;throw n}};Ru.exports=Bp});var Cu=C((T0,ku)=>{"use strict";var qp=jt(),Hp=(r,e)=>{let t=qp(r,e);return t?t.version:null};ku.exports=Hp});var Iu=C((S0,Pu)=>{"use strict";var zp=jt(),Zp=(r,e)=>{let t=zp(r.trim().replace(/^[=v]+/,""),e);return t?t.version:null};Pu.exports=Zp});var Lu=C((A0,$u)=>{"use strict";var Nu=ge(),Vp=(r,e,t,n,s)=>{typeof t=="string"&&(s=n,n=t,t=void 0);try{return new Nu(r instanceof Nu?r.version:r,t).inc(e,n,s).version}catch{return null}};$u.exports=Vp});var Mu=C((R0,Du)=>{"use strict";var ju=jt(),Gp=(r,e)=>{let t=ju(r,null,!0),n=ju(e,null,!0),s=t.compare(n);if(s===0)return null;let a=s>0,i=a?t:n,o=a?n:t,u=!!i.prerelease.length;if(!!o.prerelease.length&&!u){if(!o.patch&&!o.minor)return"major";if(o.compareMain(i)===0)return o.minor&&!o.patch?"minor":"patch"}let d=u?"pre":"";return t.major!==n.major?d+"major":t.minor!==n.minor?d+"minor":t.patch!==n.patch?d+"patch":"prerelease"};Du.exports=Gp});var Fu=C((k0,Uu)=>{"use strict";var Jp=ge(),Wp=(r,e)=>new Jp(r,e).major;Uu.exports=Wp});var qu=C((C0,Bu)=>{"use strict";var Kp=ge(),Xp=(r,e)=>new Kp(r,e).minor;Bu.exports=Xp});var zu=C((P0,Hu)=>{"use strict";var Yp=ge(),Qp=(r,e)=>new Yp(r,e).patch;Hu.exports=Qp});var Vu=C((I0,Zu)=>{"use strict";var em=jt(),tm=(r,e)=>{let t=em(r,e);return t&&t.prerelease.length?t.prerelease:null};Zu.exports=tm});var Le=C((N0,Ju)=>{"use strict";var Gu=ge(),rm=(r,e,t)=>new Gu(r,t).compare(new Gu(e,t));Ju.exports=rm});var Ku=C(($0,Wu)=>{"use strict";var nm=Le(),sm=(r,e,t)=>nm(e,r,t);Wu.exports=sm});var Yu=C((L0,Xu)=>{"use strict";var am=Le(),im=(r,e)=>am(r,e,!0);Xu.exports=im});var Bn=C((j0,ec)=>{"use strict";var Qu=ge(),om=(r,e,t)=>{let n=new Qu(r,t),s=new Qu(e,t);return n.compare(s)||n.compareBuild(s)};ec.exports=om});var rc=C((D0,tc)=>{"use strict";var um=Bn(),cm=(r,e)=>r.sort((t,n)=>um(t,n,e));tc.exports=cm});var sc=C((M0,nc)=>{"use strict";var lm=Bn(),dm=(r,e)=>r.sort((t,n)=>lm(n,t,e));nc.exports=dm});var Sr=C((U0,ac)=>{"use strict";var fm=Le(),hm=(r,e,t)=>fm(r,e,t)>0;ac.exports=hm});var qn=C((F0,ic)=>{"use strict";var pm=Le(),mm=(r,e,t)=>pm(r,e,t)<0;ic.exports=mm});var ka=C((B0,oc)=>{"use strict";var gm=Le(),ym=(r,e,t)=>gm(r,e,t)===0;oc.exports=ym});var Ca=C((q0,uc)=>{"use strict";var _m=Le(),bm=(r,e,t)=>_m(r,e,t)!==0;uc.exports=bm});var Hn=C((H0,cc)=>{"use strict";var wm=Le(),vm=(r,e,t)=>wm(r,e,t)>=0;cc.exports=vm});var zn=C((z0,lc)=>{"use strict";var xm=Le(),Em=(r,e,t)=>xm(r,e,t)<=0;lc.exports=Em});var Pa=C((Z0,dc)=>{"use strict";var Om=ka(),Tm=Ca(),Sm=Sr(),Am=Hn(),Rm=qn(),km=zn(),Cm=(r,e,t,n)=>{switch(e){case"===":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r===t;case"!==":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r!==t;case"":case"=":case"==":return Om(r,t,n);case"!=":return Tm(r,t,n);case">":return Sm(r,t,n);case">=":return Am(r,t,n);case"<":return Rm(r,t,n);case"<=":return km(r,t,n);default:throw new TypeError(`Invalid operator: ${e}`)}};dc.exports=Cm});var hc=C((V0,fc)=>{"use strict";var Pm=ge(),Im=jt(),{safeRe:Zn,t:Vn}=Qt(),Nm=(r,e)=>{if(r instanceof Pm)return r;if(typeof r=="number"&&(r=String(r)),typeof r!="string")return null;e=e||{};let t=null;if(!e.rtl)t=r.match(e.includePrerelease?Zn[Vn.COERCEFULL]:Zn[Vn.COERCE]);else{let u=e.includePrerelease?Zn[Vn.COERCERTLFULL]:Zn[Vn.COERCERTL],c;for(;(c=u.exec(r))&&(!t||t.index+t[0].length!==r.length);)(!t||c.index+c[0].length!==t.index+t[0].length)&&(t=c),u.lastIndex=c.index+c[1].length+c[2].length;u.lastIndex=-1}if(t===null)return null;let n=t[2],s=t[3]||"0",a=t[4]||"0",i=e.includePrerelease&&t[5]?`-${t[5]}`:"",o=e.includePrerelease&&t[6]?`+${t[6]}`:"";return Im(`${n}.${s}.${a}${i}${o}`,e)};fc.exports=Nm});var mc=C((G0,pc)=>{"use strict";var Ia=class{constructor(){this.max=1e3,this.map=new Map}get(e){let t=this.map.get(e);if(t!==void 0)return this.map.delete(e),this.map.set(e,t),t}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&t!==void 0){if(this.map.size>=this.max){let s=this.map.keys().next().value;this.delete(s)}this.map.set(e,t)}return this}};pc.exports=Ia});var je=C((J0,bc)=>{"use strict";var $m=/\s+/g,Na=class r{constructor(e,t){if(t=jm(t),e instanceof r)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new r(e.raw,t);if(e instanceof $a)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().replace($m," "),this.set=this.raw.split("||").map(n=>this.parseRange(n.trim())).filter(n=>n.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){let n=this.set[0];if(this.set=this.set.filter(s=>!yc(s[0])),this.set.length===0)this.set=[n];else if(this.set.length>1){for(let s of this.set)if(s.length===1&&Hm(s[0])){this.set=[s];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");let t=this.set[e];for(let n=0;n<t.length;n++)n>0&&(this.formatted+=" "),this.formatted+=t[n].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){let n=((this.options.includePrerelease&&Bm)|(this.options.loose&&qm))+":"+e,s=gc.get(n);if(s)return s;let a=this.options.loose,i=a?Se[we.HYPHENRANGELOOSE]:Se[we.HYPHENRANGE];e=e.replace(i,Qm(this.options.includePrerelease)),X("hyphen replace",e),e=e.replace(Se[we.COMPARATORTRIM],Mm),X("comparator trim",e),e=e.replace(Se[we.TILDETRIM],Um),X("tilde trim",e),e=e.replace(Se[we.CARETTRIM],Fm),X("caret trim",e);let o=e.split(" ").map(f=>zm(f,this.options)).join(" ").split(/\s+/).map(f=>Ym(f,this.options));a&&(o=o.filter(f=>(X("loose invalid filter",f,this.options),!!f.match(Se[we.COMPARATORLOOSE])))),X("range list",o);let u=new Map,c=o.map(f=>new $a(f,this.options));for(let f of c){if(yc(f))return[f];u.set(f.value,f)}u.size>1&&u.has("")&&u.delete("");let d=[...u.values()];return gc.set(n,d),d}intersects(e,t){if(!(e instanceof r))throw new TypeError("a Range is required");return this.set.some(n=>_c(n,t)&&e.set.some(s=>_c(s,t)&&n.every(a=>s.every(i=>a.intersects(i,t)))))}test(e){if(!e)return!1;if(typeof e=="string")try{e=new Dm(e,this.options)}catch{return!1}for(let t=0;t<this.set.length;t++)if(eg(this.set[t],e,this.options))return!0;return!1}};bc.exports=Na;var Lm=mc(),gc=new Lm,jm=jn(),$a=Ar(),X=Tr(),Dm=ge(),{safeRe:Se,t:we,comparatorTrimReplace:Mm,tildeTrimReplace:Um,caretTrimReplace:Fm}=Qt(),{FLAG_INCLUDE_PRERELEASE:Bm,FLAG_LOOSE:qm}=Or(),yc=r=>r.value==="<0.0.0-0",Hm=r=>r.value==="",_c=(r,e)=>{let t=!0,n=r.slice(),s=n.pop();for(;t&&n.length;)t=n.every(a=>s.intersects(a,e)),s=n.pop();return t},zm=(r,e)=>(X("comp",r,e),r=Gm(r,e),X("caret",r),r=Zm(r,e),X("tildes",r),r=Wm(r,e),X("xrange",r),r=Xm(r,e),X("stars",r),r),ve=r=>!r||r.toLowerCase()==="x"||r==="*",Zm=(r,e)=>r.trim().split(/\s+/).map(t=>Vm(t,e)).join(" "),Vm=(r,e)=>{let t=e.loose?Se[we.TILDELOOSE]:Se[we.TILDE];return r.replace(t,(n,s,a,i,o)=>{X("tilde",r,n,s,a,i,o);let u;return ve(s)?u="":ve(a)?u=`>=${s}.0.0 <${+s+1}.0.0-0`:ve(i)?u=`>=${s}.${a}.0 <${s}.${+a+1}.0-0`:o?(X("replaceTilde pr",o),u=`>=${s}.${a}.${i}-${o} <${s}.${+a+1}.0-0`):u=`>=${s}.${a}.${i} <${s}.${+a+1}.0-0`,X("tilde return",u),u})},Gm=(r,e)=>r.trim().split(/\s+/).map(t=>Jm(t,e)).join(" "),Jm=(r,e)=>{X("caret",r,e);let t=e.loose?Se[we.CARETLOOSE]:Se[we.CARET],n=e.includePrerelease?"-0":"";return r.replace(t,(s,a,i,o,u)=>{X("caret",r,s,a,i,o,u);let c;return ve(a)?c="":ve(i)?c=`>=${a}.0.0${n} <${+a+1}.0.0-0`:ve(o)?a==="0"?c=`>=${a}.${i}.0${n} <${a}.${+i+1}.0-0`:c=`>=${a}.${i}.0${n} <${+a+1}.0.0-0`:u?(X("replaceCaret pr",u),a==="0"?i==="0"?c=`>=${a}.${i}.${o}-${u} <${a}.${i}.${+o+1}-0`:c=`>=${a}.${i}.${o}-${u} <${a}.${+i+1}.0-0`:c=`>=${a}.${i}.${o}-${u} <${+a+1}.0.0-0`):(X("no pr"),a==="0"?i==="0"?c=`>=${a}.${i}.${o}${n} <${a}.${i}.${+o+1}-0`:c=`>=${a}.${i}.${o}${n} <${a}.${+i+1}.0-0`:c=`>=${a}.${i}.${o} <${+a+1}.0.0-0`),X("caret return",c),c})},Wm=(r,e)=>(X("replaceXRanges",r,e),r.split(/\s+/).map(t=>Km(t,e)).join(" ")),Km=(r,e)=>{r=r.trim();let t=e.loose?Se[we.XRANGELOOSE]:Se[we.XRANGE];return r.replace(t,(n,s,a,i,o,u)=>{X("xRange",r,n,s,a,i,o,u);let c=ve(a),d=c||ve(i),f=d||ve(o),p=f;return s==="="&&p&&(s=""),u=e.includePrerelease?"-0":"",c?s===">"||s==="<"?n="<0.0.0-0":n="*":s&&p?(d&&(i=0),o=0,s===">"?(s=">=",d?(a=+a+1,i=0,o=0):(i=+i+1,o=0)):s==="<="&&(s="<",d?a=+a+1:i=+i+1),s==="<"&&(u="-0"),n=`${s+a}.${i}.${o}${u}`):d?n=`>=${a}.0.0${u} <${+a+1}.0.0-0`:f&&(n=`>=${a}.${i}.0${u} <${a}.${+i+1}.0-0`),X("xRange return",n),n})},Xm=(r,e)=>(X("replaceStars",r,e),r.trim().replace(Se[we.STAR],"")),Ym=(r,e)=>(X("replaceGTE0",r,e),r.trim().replace(Se[e.includePrerelease?we.GTE0PRE:we.GTE0],"")),Qm=r=>(e,t,n,s,a,i,o,u,c,d,f,p)=>(ve(n)?t="":ve(s)?t=`>=${n}.0.0${r?"-0":""}`:ve(a)?t=`>=${n}.${s}.0${r?"-0":""}`:i?t=`>=${t}`:t=`>=${t}${r?"-0":""}`,ve(c)?u="":ve(d)?u=`<${+c+1}.0.0-0`:ve(f)?u=`<${c}.${+d+1}.0-0`:p?u=`<=${c}.${d}.${f}-${p}`:r?u=`<${c}.${d}.${+f+1}-0`:u=`<=${u}`,`${t} ${u}`.trim()),eg=(r,e,t)=>{for(let n=0;n<r.length;n++)if(!r[n].test(e))return!1;if(e.prerelease.length&&!t.includePrerelease){for(let n=0;n<r.length;n++)if(X(r[n].semver),r[n].semver!==$a.ANY&&r[n].semver.prerelease.length>0){let s=r[n].semver;if(s.major===e.major&&s.minor===e.minor&&s.patch===e.patch)return!0}return!1}return!0}});var Ar=C((W0,Tc)=>{"use strict";var Rr=Symbol("SemVer ANY"),Da=class r{static get ANY(){return Rr}constructor(e,t){if(t=wc(t),e instanceof r){if(e.loose===!!t.loose)return e;e=e.value}e=e.trim().split(/\s+/).join(" "),ja("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===Rr?this.value="":this.value=this.operator+this.semver.version,ja("comp",this)}parse(e){let t=this.options.loose?vc[xc.COMPARATORLOOSE]:vc[xc.COMPARATOR],n=e.match(t);if(!n)throw new TypeError(`Invalid comparator: ${e}`);this.operator=n[1]!==void 0?n[1]:"",this.operator==="="&&(this.operator=""),n[2]?this.semver=new Ec(n[2],this.options.loose):this.semver=Rr}toString(){return this.value}test(e){if(ja("Comparator.test",e,this.options.loose),this.semver===Rr||e===Rr)return!0;if(typeof e=="string")try{e=new Ec(e,this.options)}catch{return!1}return La(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof r))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new Oc(e.value,t).test(this.value):e.operator===""?e.value===""?!0:new Oc(this.value,t).test(e.semver):(t=wc(t),t.includePrerelease&&(this.value==="<0.0.0-0"||e.value==="<0.0.0-0")||!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&e.operator.startsWith(">")||this.operator.startsWith("<")&&e.operator.startsWith("<")||this.semver.version===e.semver.version&&this.operator.includes("=")&&e.operator.includes("=")||La(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<")||La(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))}};Tc.exports=Da;var wc=jn(),{safeRe:vc,t:xc}=Qt(),La=Pa(),ja=Tr(),Ec=ge(),Oc=je()});var kr=C((K0,Sc)=>{"use strict";var tg=je(),rg=(r,e,t)=>{try{e=new tg(e,t)}catch{return!1}return e.test(r)};Sc.exports=rg});var Rc=C((X0,Ac)=>{"use strict";var ng=je(),sg=(r,e)=>new ng(r,e).set.map(t=>t.map(n=>n.value).join(" ").trim().split(" "));Ac.exports=sg});var Cc=C((Y0,kc)=>{"use strict";var ag=ge(),ig=je(),og=(r,e,t)=>{let n=null,s=null,a=null;try{a=new ig(e,t)}catch{return null}return r.forEach(i=>{a.test(i)&&(!n||s.compare(i)===-1)&&(n=i,s=new ag(n,t))}),n};kc.exports=og});var Ic=C((Q0,Pc)=>{"use strict";var ug=ge(),cg=je(),lg=(r,e,t)=>{let n=null,s=null,a=null;try{a=new cg(e,t)}catch{return null}return r.forEach(i=>{a.test(i)&&(!n||s.compare(i)===1)&&(n=i,s=new ug(n,t))}),n};Pc.exports=lg});var Lc=C((ex,$c)=>{"use strict";var Ma=ge(),dg=je(),Nc=Sr(),fg=(r,e)=>{r=new dg(r,e);let t=new Ma("0.0.0");if(r.test(t)||(t=new Ma("0.0.0-0"),r.test(t)))return t;t=null;for(let n=0;n<r.set.length;++n){let s=r.set[n],a=null;s.forEach(i=>{let o=new Ma(i.semver.version);switch(i.operator){case">":o.prerelease.length===0?o.patch++:o.prerelease.push(0),o.raw=o.format();case"":case">=":(!a||Nc(o,a))&&(a=o);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${i.operator}`)}}),a&&(!t||Nc(t,a))&&(t=a)}return t&&r.test(t)?t:null};$c.exports=fg});var Dc=C((tx,jc)=>{"use strict";var hg=je(),pg=(r,e)=>{try{return new hg(r,e).range||"*"}catch{return null}};jc.exports=pg});var Gn=C((rx,Bc)=>{"use strict";var mg=ge(),Fc=Ar(),{ANY:gg}=Fc,yg=je(),_g=kr(),Mc=Sr(),Uc=qn(),bg=zn(),wg=Hn(),vg=(r,e,t,n)=>{r=new mg(r,n),e=new yg(e,n);let s,a,i,o,u;switch(t){case">":s=Mc,a=bg,i=Uc,o=">",u=">=";break;case"<":s=Uc,a=wg,i=Mc,o="<",u="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(_g(r,e,n))return!1;for(let c=0;c<e.set.length;++c){let d=e.set[c],f=null,p=null;if(d.forEach(m=>{m.semver===gg&&(m=new Fc(">=0.0.0")),f=f||m,p=p||m,s(m.semver,f.semver,n)?f=m:i(m.semver,p.semver,n)&&(p=m)}),f.operator===o||f.operator===u||(!p.operator||p.operator===o)&&a(r,p.semver))return!1;if(p.operator===u&&i(r,p.semver))return!1}return!0};Bc.exports=vg});var Hc=C((nx,qc)=>{"use strict";var xg=Gn(),Eg=(r,e,t)=>xg(r,e,">",t);qc.exports=Eg});var Zc=C((sx,zc)=>{"use strict";var Og=Gn(),Tg=(r,e,t)=>Og(r,e,"<",t);zc.exports=Tg});var Jc=C((ax,Gc)=>{"use strict";var Vc=je(),Sg=(r,e,t)=>(r=new Vc(r,t),e=new Vc(e,t),r.intersects(e,t));Gc.exports=Sg});var Kc=C((ix,Wc)=>{"use strict";var Ag=kr(),Rg=Le();Wc.exports=(r,e,t)=>{let n=[],s=null,a=null,i=r.sort((d,f)=>Rg(d,f,t));for(let d of i)Ag(d,e,t)?(a=d,s||(s=d)):(a&&n.push([s,a]),a=null,s=null);s&&n.push([s,null]);let o=[];for(let[d,f]of n)d===f?o.push(d):!f&&d===i[0]?o.push("*"):f?d===i[0]?o.push(`<=${f}`):o.push(`${d} - ${f}`):o.push(`>=${d}`);let u=o.join(" || "),c=typeof e.raw=="string"?e.raw:String(e);return u.length<c.length?u:e}});var rl=C((ox,tl)=>{"use strict";var Xc=je(),Fa=Ar(),{ANY:Ua}=Fa,Cr=kr(),Ba=Le(),kg=(r,e,t={})=>{if(r===e)return!0;r=new Xc(r,t),e=new Xc(e,t);let n=!1;e:for(let s of r.set){for(let a of e.set){let i=Pg(s,a,t);if(n=n||i!==null,i)continue e}if(n)return!1}return!0},Cg=[new Fa(">=0.0.0-0")],Yc=[new Fa(">=0.0.0")],Pg=(r,e,t)=>{if(r===e)return!0;if(r.length===1&&r[0].semver===Ua){if(e.length===1&&e[0].semver===Ua)return!0;t.includePrerelease?r=Cg:r=Yc}if(e.length===1&&e[0].semver===Ua){if(t.includePrerelease)return!0;e=Yc}let n=new Set,s,a;for(let m of r)m.operator===">"||m.operator===">="?s=Qc(s,m,t):m.operator==="<"||m.operator==="<="?a=el(a,m,t):n.add(m.semver);if(n.size>1)return null;let i;if(s&&a){if(i=Ba(s.semver,a.semver,t),i>0)return null;if(i===0&&(s.operator!==">="||a.operator!=="<="))return null}for(let m of n){if(s&&!Cr(m,String(s),t)||a&&!Cr(m,String(a),t))return null;for(let _ of e)if(!Cr(m,String(_),t))return!1;return!0}let o,u,c,d,f=a&&!t.includePrerelease&&a.semver.prerelease.length?a.semver:!1,p=s&&!t.includePrerelease&&s.semver.prerelease.length?s.semver:!1;f&&f.prerelease.length===1&&a.operator==="<"&&f.prerelease[0]===0&&(f=!1);for(let m of e){if(d=d||m.operator===">"||m.operator===">=",c=c||m.operator==="<"||m.operator==="<=",s){if(p&&m.semver.prerelease&&m.semver.prerelease.length&&m.semver.major===p.major&&m.semver.minor===p.minor&&m.semver.patch===p.patch&&(p=!1),m.operator===">"||m.operator===">="){if(o=Qc(s,m,t),o===m&&o!==s)return!1}else if(s.operator===">="&&!Cr(s.semver,String(m),t))return!1}if(a){if(f&&m.semver.prerelease&&m.semver.prerelease.length&&m.semver.major===f.major&&m.semver.minor===f.minor&&m.semver.patch===f.patch&&(f=!1),m.operator==="<"||m.operator==="<="){if(u=el(a,m,t),u===m&&u!==a)return!1}else if(a.operator==="<="&&!Cr(a.semver,String(m),t))return!1}if(!m.operator&&(a||s)&&i!==0)return!1}return!(s&&c&&!a&&i!==0||a&&d&&!s&&i!==0||p||f)},Qc=(r,e,t)=>{if(!r)return e;let n=Ba(r.semver,e.semver,t);return n>0?r:n<0||e.operator===">"&&r.operator===">="?e:r},el=(r,e,t)=>{if(!r)return e;let n=Ba(r.semver,e.semver,t);return n<0?r:n>0||e.operator==="<"&&r.operator==="<="?e:r};tl.exports=kg});var il=C((ux,al)=>{"use strict";var qa=Qt(),nl=Or(),Ig=ge(),sl=Aa(),Ng=jt(),$g=Cu(),Lg=Iu(),jg=Lu(),Dg=Mu(),Mg=Fu(),Ug=qu(),Fg=zu(),Bg=Vu(),qg=Le(),Hg=Ku(),zg=Yu(),Zg=Bn(),Vg=rc(),Gg=sc(),Jg=Sr(),Wg=qn(),Kg=ka(),Xg=Ca(),Yg=Hn(),Qg=zn(),ey=Pa(),ty=hc(),ry=Ar(),ny=je(),sy=kr(),ay=Rc(),iy=Cc(),oy=Ic(),uy=Lc(),cy=Dc(),ly=Gn(),dy=Hc(),fy=Zc(),hy=Jc(),py=Kc(),my=rl();al.exports={parse:Ng,valid:$g,clean:Lg,inc:jg,diff:Dg,major:Mg,minor:Ug,patch:Fg,prerelease:Bg,compare:qg,rcompare:Hg,compareLoose:zg,compareBuild:Zg,sort:Vg,rsort:Gg,gt:Jg,lt:Wg,eq:Kg,neq:Xg,gte:Yg,lte:Qg,cmp:ey,coerce:ty,Comparator:ry,Range:ny,satisfies:sy,toComparators:ay,maxSatisfying:iy,minSatisfying:oy,minVersion:uy,validRange:cy,outside:ly,gtr:dy,ltr:fy,intersects:hy,simplifyRange:py,subset:my,SemVer:Ig,re:qa.re,src:qa.src,tokens:qa.t,SEMVER_SPEC_VERSION:nl.SEMVER_SPEC_VERSION,RELEASE_TYPES:nl.RELEASE_TYPES,compareIdentifiers:sl.compareIdentifiers,rcompareIdentifiers:sl.rcompareIdentifiers}});var Ud=C((pP,Md)=>{"use strict";var ub=new Set(["ENOTFOUND","ENETUNREACH","UNABLE_TO_GET_ISSUER_CERT","UNABLE_TO_GET_CRL","UNABLE_TO_DECRYPT_CERT_SIGNATURE","UNABLE_TO_DECRYPT_CRL_SIGNATURE","UNABLE_TO_DECODE_ISSUER_PUBLIC_KEY","CERT_SIGNATURE_FAILURE","CRL_SIGNATURE_FAILURE","CERT_NOT_YET_VALID","CERT_HAS_EXPIRED","CRL_NOT_YET_VALID","CRL_HAS_EXPIRED","ERROR_IN_CERT_NOT_BEFORE_FIELD","ERROR_IN_CERT_NOT_AFTER_FIELD","ERROR_IN_CRL_LAST_UPDATE_FIELD","ERROR_IN_CRL_NEXT_UPDATE_FIELD","OUT_OF_MEM","DEPTH_ZERO_SELF_SIGNED_CERT","SELF_SIGNED_CERT_IN_CHAIN","UNABLE_TO_GET_ISSUER_CERT_LOCALLY","UNABLE_TO_VERIFY_LEAF_SIGNATURE","CERT_CHAIN_TOO_LONG","CERT_REVOKED","INVALID_CA","PATH_LENGTH_EXCEEDED","INVALID_PURPOSE","CERT_UNTRUSTED","CERT_REJECTED","HOSTNAME_MISMATCH"]);Md.exports=r=>!ub.has(r&&r.code)});function to(r){if(typeof r>"u")return null;try{return JSON.parse(r)}catch{}let e="",t=[],n=!1,s=!1;for(let a of r){if(n)a==='"'&&!s?n=!1:a===`
`&&!s?a="\\n":a==="\\"?s=!s:s=!1;else if(a==='"')n=!0,s=!1;else if(a==="{")t.push("}");else if(a==="[")t.push("]");else if(a==="}"||a==="]")if(t&&t[t.length-1]===a)t.pop();else return null;e+=a}n&&(e+='"');for(let a=t.length-1;a>=0;a-=1)e+=t[a];try{return JSON.parse(e)}catch{return null}}var fo=Re(no(),1),ef=Re(lo(),1);function ho(r,e){return e?.[r]||(0,fo.default)(r)}function po(r,e,t){let n={};for(let s in r)Object.hasOwn(r,s)&&(n[e(s,t)]=r[s]);return n}function mo(r){return Array.isArray(r)?[...r]:l({},r)}function tf(r,e){let t=mo(r);for(let[n,s]of Object.entries(e)){let[a,...i]=n.split(".").reverse(),o=t;for(let u of i.reverse()){if(o[u]===void 0)break;o[u]=mo(o[u]),o=o[u]}o[a]!==void 0&&(o[a]={lc:1,type:"secret",id:[s]})}return t}function Ns(r){let e=Object.getPrototypeOf(r);return typeof r.lc_name=="function"&&(typeof e.lc_name!="function"||r.lc_name()!==e.lc_name())?r.lc_name():r.name}var Ue=class r{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,Ns(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_kwargs=e||{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof r||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();let e={},t={},n=Object.keys(this.lc_kwargs).reduce((s,a)=>(s[a]=a in this?this[a]:this.lc_kwargs[a],s),{});for(let s=Object.getPrototypeOf(this);s;s=Object.getPrototypeOf(s))Object.assign(e,Reflect.get(s,"lc_aliases",this)),Object.assign(t,Reflect.get(s,"lc_secrets",this)),Object.assign(n,Reflect.get(s,"lc_attributes",this));return Object.keys(t).forEach(s=>{let a=this,i=n,[o,...u]=s.split(".").reverse();for(let c of u.reverse()){if(!(c in a)||a[c]===void 0)return;(!(c in i)||i[c]===void 0)&&(typeof a[c]=="object"&&a[c]!=null?i[c]={}:Array.isArray(a[c])&&(i[c]=[])),a=a[c],i=i[c]}o in a&&a[o]!==void 0&&(i[o]=i[o]||a[o])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:po(Object.keys(t).length?tf(n,t):n,ho,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}};function At(r,e){return typeof r=="string"?typeof e=="string"?r+e:[{type:"text",text:r},...e]:Array.isArray(e)?[...r,...e]:[...r,{type:"text",text:e}]}var ke=class extends Ue{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return typeof this.content=="string"?this.content:""}constructor(e,t){typeof e=="string"&&(e={content:e,additional_kwargs:t,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}};function Xe(r,e){let t=l({},r);for(let[n,s]of Object.entries(e))if(t[n]==null)t[n]=s;else{if(s==null)continue;if(typeof t[n]!=typeof s||Array.isArray(t[n])!==Array.isArray(s))throw new Error(`field[${n}] already exists in the message chunk, but with a different type.`);if(typeof t[n]=="string")t[n]=t[n]+s;else if(!Array.isArray(t[n])&&typeof t[n]=="object")t[n]=Xe(t[n],s);else if(Array.isArray(t[n]))t[n]=$s(t[n],s);else{if(t[n]===s)continue;console.warn(`field[${n}] already exists in this message chunk and value has unsupported type.`)}}return t}function $s(r,e){if(!(r===void 0&&e===void 0)){if(r===void 0||e===void 0)return r||e;{let t=[...r];for(let n of e)if(typeof n=="object"&&"index"in n&&typeof n.index=="number"){let s=t.findIndex(a=>a.index===n.index);s!==-1?t[s]=Xe(t[s],n):t.push(n)}else t.push(n);return t}}}var at=class extends ke{};function go(r){return typeof r?._getType=="function"}function yo(r){let e=[],t=[];for(let n of r)if(n.function){let s=n.function.name;try{let a=JSON.parse(n.function.arguments),i={name:s||"",args:a||{},id:n.id};e.push(i)}catch{t.push({name:s,args:n.function.arguments,id:n.id,error:"Malformed args."})}}else continue;return[e,t]}var Zt=class extends ke{get lc_aliases(){return g(l({},super.lc_aliases),{tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"})}constructor(e,t){let n;if(typeof e=="string")n={content:e,tool_calls:[],invalid_tool_calls:[],additional_kwargs:t??{}};else{n=e;let s=n.additional_kwargs?.tool_calls,a=n.tool_calls;s!=null&&s.length>0&&(a===void 0||a.length===0)&&console.warn(["New LangChain packages are available that more efficiently handle",`tool calling.

Please upgrade your packages to versions that set`,"message tool calls. e.g., `yarn add @langchain/anthropic`,","yarn add @langchain/openai`, etc."].join(" "));try{if(s!=null&&a===void 0){let[i,o]=yo(s);n.tool_calls=i??[],n.invalid_tool_calls=o??[]}else n.tool_calls=n.tool_calls??[],n.invalid_tool_calls=n.invalid_tool_calls??[]}catch{n.tool_calls=[],n.invalid_tool_calls=[]}}super(n),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),typeof n!="string"&&(this.tool_calls=n.tool_calls??this.tool_calls,this.invalid_tool_calls=n.invalid_tool_calls??this.invalid_tool_calls)}static lc_name(){return"AIMessage"}_getType(){return"ai"}};var Rt=class r extends at{constructor(e){let t;if(typeof e=="string")t={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(e.tool_call_chunks===void 0)t=g(l({},e),{tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]});else{let n=[],s=[];for(let a of e.tool_call_chunks){let i={};try{if(i=to(a.args??"{}")??{},typeof i!="object"||Array.isArray(i))throw new Error("Malformed tool call chunk args.");n.push({name:a.name??"",args:i,id:a.id})}catch{s.push({name:a.name,args:a.args,id:a.id,error:"Malformed args."})}}t=g(l({},e),{tool_calls:n,invalid_tool_calls:s})}super(t),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.tool_call_chunks=t?.tool_call_chunks??this.tool_call_chunks,this.tool_calls=t?.tool_calls??this.tool_calls,this.invalid_tool_calls=t?.invalid_tool_calls??this.invalid_tool_calls}get lc_aliases(){return g(l({},super.lc_aliases),{tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"})}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}concat(e){let t={content:At(this.content,e.content),additional_kwargs:Xe(this.additional_kwargs,e.additional_kwargs),response_metadata:Xe(this.response_metadata,e.response_metadata),tool_call_chunks:[]};if(this.tool_call_chunks!==void 0||e.tool_call_chunks!==void 0){let n=$s(this.tool_call_chunks,e.tool_call_chunks);n!==void 0&&n.length>0&&(t.tool_call_chunks=n)}return new r(t)}};var it=class extends ke{static lc_name(){return"HumanMessage"}_getType(){return"human"}};var tn=class extends ke{static lc_name(){return"SystemMessage"}_getType(){return"system"}};function kt(r){if(typeof r=="string")return new it(r);if(go(r))return r;let[e,t]=r;if(e==="human"||e==="user")return new it({content:t});if(e==="ai"||e==="assistant")return new Zt({content:t});if(e==="system")return new tn({content:t});throw new Error("Unable to coerce message from array: only human, AI, or system message coercion is currently supported.")}function pr(r,e="Human",t="AI"){let n=[];for(let s of r){let a;if(s._getType()==="human")a=e;else if(s._getType()==="ai")a=t;else if(s._getType()==="system")a="System";else if(s._getType()==="function")a="Function";else if(s._getType()==="tool")a="Tool";else if(s._getType()==="generic")a=s.role;else throw new Error(`Got unsupported message type: ${s._getType()}`);let i=s.name?`${s.name}, `:"";n.push(`${a}: ${i}${s.content}`)}return n.join(`
`)}var js="__run",Ls=class r{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new r({text:this.text+e.text,generationInfo:l(l({},this.generationInfo),e.generationInfo)})}},rn=class r extends Ls{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new r({text:this.text+e.text,generationInfo:l(l({},this.generationInfo),e.generationInfo),message:this.message.concat(e.message)})}};var nf=typeof window=="object"?window:{},q="0123456789abcdef".split(""),sf=[-2147483648,8388608,32768,128],Fe=[24,16,8,0];var oe=[];function Be(r){r?(oe[0]=oe[16]=oe[1]=oe[2]=oe[3]=oe[4]=oe[5]=oe[6]=oe[7]=oe[8]=oe[9]=oe[10]=oe[11]=oe[12]=oe[13]=oe[14]=oe[15]=0,this.blocks=oe):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}Be.prototype.update=function(r){if(!this.finalized){var e=typeof r!="string";e&&r.constructor===nf.ArrayBuffer&&(r=new Uint8Array(r));for(var t,n=0,s,a=r.length||0,i=this.blocks;n<a;){if(this.hashed&&(this.hashed=!1,i[0]=this.block,i[16]=i[1]=i[2]=i[3]=i[4]=i[5]=i[6]=i[7]=i[8]=i[9]=i[10]=i[11]=i[12]=i[13]=i[14]=i[15]=0),e)for(s=this.start;n<a&&s<64;++n)i[s>>2]|=r[n]<<Fe[s++&3];else for(s=this.start;n<a&&s<64;++n)t=r.charCodeAt(n),t<128?i[s>>2]|=t<<Fe[s++&3]:t<2048?(i[s>>2]|=(192|t>>6)<<Fe[s++&3],i[s>>2]|=(128|t&63)<<Fe[s++&3]):t<55296||t>=57344?(i[s>>2]|=(224|t>>12)<<Fe[s++&3],i[s>>2]|=(128|t>>6&63)<<Fe[s++&3],i[s>>2]|=(128|t&63)<<Fe[s++&3]):(t=65536+((t&1023)<<10|r.charCodeAt(++n)&1023),i[s>>2]|=(240|t>>18)<<Fe[s++&3],i[s>>2]|=(128|t>>12&63)<<Fe[s++&3],i[s>>2]|=(128|t>>6&63)<<Fe[s++&3],i[s>>2]|=(128|t&63)<<Fe[s++&3]);this.lastByteIndex=s,this.bytes+=s-this.start,s>=64?(this.block=i[16],this.start=s-64,this.hash(),this.hashed=!0):this.start=s}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}};Be.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var r=this.blocks,e=this.lastByteIndex;r[16]=this.block,r[e>>2]|=sf[e&3],this.block=r[16],e>=56&&(this.hashed||this.hash(),r[0]=this.block,r[16]=r[1]=r[2]=r[3]=r[4]=r[5]=r[6]=r[7]=r[8]=r[9]=r[10]=r[11]=r[12]=r[13]=r[14]=r[15]=0),r[14]=this.hBytes<<3|this.bytes>>>29,r[15]=this.bytes<<3,this.hash()}};Be.prototype.hash=function(){var r=this.h0,e=this.h1,t=this.h2,n=this.h3,s=this.h4,a,i,o,u=this.blocks;for(i=16;i<80;++i)o=u[i-3]^u[i-8]^u[i-14]^u[i-16],u[i]=o<<1|o>>>31;for(i=0;i<20;i+=5)a=e&t|~e&n,o=r<<5|r>>>27,s=o+a+s+1518500249+u[i]<<0,e=e<<30|e>>>2,a=r&e|~r&t,o=s<<5|s>>>27,n=o+a+n+1518500249+u[i+1]<<0,r=r<<30|r>>>2,a=s&r|~s&e,o=n<<5|n>>>27,t=o+a+t+1518500249+u[i+2]<<0,s=s<<30|s>>>2,a=n&s|~n&r,o=t<<5|t>>>27,e=o+a+e+1518500249+u[i+3]<<0,n=n<<30|n>>>2,a=t&n|~t&s,o=e<<5|e>>>27,r=o+a+r+1518500249+u[i+4]<<0,t=t<<30|t>>>2;for(;i<40;i+=5)a=e^t^n,o=r<<5|r>>>27,s=o+a+s+1859775393+u[i]<<0,e=e<<30|e>>>2,a=r^e^t,o=s<<5|s>>>27,n=o+a+n+1859775393+u[i+1]<<0,r=r<<30|r>>>2,a=s^r^e,o=n<<5|n>>>27,t=o+a+t+1859775393+u[i+2]<<0,s=s<<30|s>>>2,a=n^s^r,o=t<<5|t>>>27,e=o+a+e+1859775393+u[i+3]<<0,n=n<<30|n>>>2,a=t^n^s,o=e<<5|e>>>27,r=o+a+r+1859775393+u[i+4]<<0,t=t<<30|t>>>2;for(;i<60;i+=5)a=e&t|e&n|t&n,o=r<<5|r>>>27,s=o+a+s-1894007588+u[i]<<0,e=e<<30|e>>>2,a=r&e|r&t|e&t,o=s<<5|s>>>27,n=o+a+n-1894007588+u[i+1]<<0,r=r<<30|r>>>2,a=s&r|s&e|r&e,o=n<<5|n>>>27,t=o+a+t-1894007588+u[i+2]<<0,s=s<<30|s>>>2,a=n&s|n&r|s&r,o=t<<5|t>>>27,e=o+a+e-1894007588+u[i+3]<<0,n=n<<30|n>>>2,a=t&n|t&s|n&s,o=e<<5|e>>>27,r=o+a+r-1894007588+u[i+4]<<0,t=t<<30|t>>>2;for(;i<80;i+=5)a=e^t^n,o=r<<5|r>>>27,s=o+a+s-899497514+u[i]<<0,e=e<<30|e>>>2,a=r^e^t,o=s<<5|s>>>27,n=o+a+n-899497514+u[i+1]<<0,r=r<<30|r>>>2,a=s^r^e,o=n<<5|n>>>27,t=o+a+t-899497514+u[i+2]<<0,s=s<<30|s>>>2,a=n^s^r,o=t<<5|t>>>27,e=o+a+e-899497514+u[i+3]<<0,n=n<<30|n>>>2,a=t^n^s,o=e<<5|e>>>27,r=o+a+r-899497514+u[i+4]<<0,t=t<<30|t>>>2;this.h0=this.h0+r<<0,this.h1=this.h1+e<<0,this.h2=this.h2+t<<0,this.h3=this.h3+n<<0,this.h4=this.h4+s<<0};Be.prototype.hex=function(){this.finalize();var r=this.h0,e=this.h1,t=this.h2,n=this.h3,s=this.h4;return q[r>>28&15]+q[r>>24&15]+q[r>>20&15]+q[r>>16&15]+q[r>>12&15]+q[r>>8&15]+q[r>>4&15]+q[r&15]+q[e>>28&15]+q[e>>24&15]+q[e>>20&15]+q[e>>16&15]+q[e>>12&15]+q[e>>8&15]+q[e>>4&15]+q[e&15]+q[t>>28&15]+q[t>>24&15]+q[t>>20&15]+q[t>>16&15]+q[t>>12&15]+q[t>>8&15]+q[t>>4&15]+q[t&15]+q[n>>28&15]+q[n>>24&15]+q[n>>20&15]+q[n>>16&15]+q[n>>12&15]+q[n>>8&15]+q[n>>4&15]+q[n&15]+q[s>>28&15]+q[s>>24&15]+q[s>>20&15]+q[s>>16&15]+q[s>>12&15]+q[s>>8&15]+q[s>>4&15]+q[s&15]};Be.prototype.toString=Be.prototype.hex;Be.prototype.digest=function(){this.finalize();var r=this.h0,e=this.h1,t=this.h2,n=this.h3,s=this.h4;return[r>>24&255,r>>16&255,r>>8&255,r&255,e>>24&255,e>>16&255,e>>8&255,e&255,t>>24&255,t>>16&255,t>>8&255,t&255,n>>24&255,n>>16&255,n>>8&255,n&255,s>>24&255,s>>16&255,s>>8&255,s&255]};Be.prototype.array=Be.prototype.digest;Be.prototype.arrayBuffer=function(){this.finalize();var r=new ArrayBuffer(20),e=new DataView(r);return e.setUint32(0,this.h0),e.setUint32(4,this.h1),e.setUint32(8,this.h2),e.setUint32(12,this.h3),e.setUint32(16,this.h4),r};var Ds=r=>new Be(!0).update(r).hex();var _o=(...r)=>Ds(r.join("_"));var Ms=class{},af=new Map,nn=class r extends Ms{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=e??new Map}lookup(e,t){return Promise.resolve(this.cache.get(_o(e,t))??null)}update(e,t,n){return h(this,null,function*(){this.cache.set(_o(e,t),n)})}static global(){return new r(af)}};var sn=class extends Ue{},an=class extends sn{static lc_name(){return"StringPromptValue"}constructor(e){super({value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new it(this.value)]}},on=class extends sn{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return pr(this.messages)}toChatMessages(){return this.messages}};var Lo=Re(ln(),1),gn=Re(mn(),1),wf=[400,401,402,403,404,405,406,407,409],vf=r=>{if(r.message.startsWith("Cancel")||r.message.startsWith("AbortError")||r.name==="AbortError"||r?.code==="ECONNABORTED")throw r;let e=r?.response?.status??r?.status;if(e&&wf.includes(+e))throw r;if(r?.error?.code==="insufficient_quota"){let t=new Error(r?.message);throw t.name="InsufficientQuotaError",t}},yt=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??vf;let t="default"in gn.default?gn.default.default:gn.default;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>(0,Lo.default)(()=>e(...t).catch(n=>{throw n instanceof Error?n:new Error(n)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...n){return e.signal?Promise.race([this.call(t,...n),new Promise((s,a)=>{e.signal?.addEventListener("abort",()=>{a(new Error("AbortError"))})})]):this.call(t,...n)}fetch(...e){return this.call(()=>fetch(...e).then(t=>t.ok?t:Promise.reject(t)))}};var Uo=Re(Mo(),1);var kf=Object.defineProperty,Cf=(r,e,t)=>e in r?kf(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Pf=(r,e,t)=>(Cf(r,typeof e!="symbol"?e+"":e,t),t);function If(r,e){let t=Array.from({length:r.length},(n,s)=>({start:s,end:s+1}));for(;t.length>1;){let n=null;for(let s=0;s<t.length-1;s++){let a=r.slice(t[s].start,t[s+1].end),i=e.get(a.join(","));i!=null&&(n==null||i<n[0])&&(n=[i,s])}if(n!=null){let s=n[1];t[s]={start:t[s].start,end:t[s+1].end},t.splice(s+1,1)}else break}return t}function Nf(r,e){return r.length===1?[e.get(r.join(","))]:If(r,e).map(t=>e.get(r.slice(t.start,t.end).join(","))).filter(t=>t!=null)}function $f(r){return r.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var Vs=class{specialTokens;inverseSpecialTokens;patStr;textEncoder=new TextEncoder;textDecoder=new TextDecoder("utf-8");rankMap=new Map;textMap=new Map;constructor(r,e){this.patStr=r.pat_str;let t=r.bpe_ranks.split(`
`).filter(Boolean).reduce((n,s)=>{let[a,i,...o]=s.split(" "),u=Number.parseInt(i,10);return o.forEach((c,d)=>n[c]=u+d),n},{});for(let[n,s]of Object.entries(t)){let a=Uo.default.toByteArray(n);this.rankMap.set(a.join(","),s),this.textMap.set(s,a)}this.specialTokens=l(l({},r.special_tokens),e),this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((n,[s,a])=>(n[a]=this.textEncoder.encode(s),n),{})}encode(r,e=[],t="all"){let n=new RegExp(this.patStr,"ug"),s=Vs.specialTokenRegex(Object.keys(this.specialTokens)),a=[],i=new Set(e==="all"?Object.keys(this.specialTokens):e),o=new Set(t==="all"?Object.keys(this.specialTokens).filter(c=>!i.has(c)):t);if(o.size>0){let c=Vs.specialTokenRegex([...o]),d=r.match(c);if(d!=null)throw new Error(`The text contains a special token that is not allowed: ${d[0]}`)}let u=0;for(;;){let c=null,d=u;for(;s.lastIndex=d,c=s.exec(r),!(c==null||i.has(c[0]));)d=c.index+1;let f=c?.index??r.length;for(let m of r.substring(u,f).matchAll(n)){let _=this.textEncoder.encode(m[0]),w=this.rankMap.get(_.join(","));if(w!=null){a.push(w);continue}a.push(...Nf(_,this.rankMap))}if(c==null)break;let p=this.specialTokens[c[0]];a.push(p),u=c.index+c[0].length}return a}decode(r){let e=[],t=0;for(let a=0;a<r.length;++a){let i=r[a],o=this.textMap.get(i)??this.inverseSpecialTokens[i];o!=null&&(e.push(o),t+=o.length)}let n=new Uint8Array(t),s=0;for(let a of e)n.set(a,s),s+=a.length;return this.textDecoder.decode(n)}},_n=Vs;Pf(_n,"specialTokenRegex",r=>new RegExp(r.map(e=>$f(e)).join("|"),"g"));function Gs(r){switch(r){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":case"text-embedding-3-small":case"text-embedding-3-large":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4o-2024-11-20":case"gpt-4o-mini-2024-07-18":case"gpt-4o-mini":case"gpt-4o-search-preview":case"gpt-4o-search-preview-2025-03-11":case"gpt-4o-mini-search-preview":case"gpt-4o-mini-search-preview-2025-03-11":case"gpt-4o-audio-preview":case"gpt-4o-audio-preview-2024-12-17":case"gpt-4o-audio-preview-2024-10-01":case"gpt-4o-mini-audio-preview":case"gpt-4o-mini-audio-preview-2024-12-17":case"o1":case"o1-2024-12-17":case"o1-mini":case"o1-mini-2024-09-12":case"o1-preview":case"o1-preview-2024-09-12":case"o1-pro":case"o1-pro-2025-03-19":case"o3":case"o3-2025-04-16":case"o3-mini":case"o3-mini-2025-01-31":case"o4-mini":case"o4-mini-2025-04-16":case"chatgpt-4o-latest":case"gpt-4o-realtime":case"gpt-4o-realtime-preview-2024-10-01":case"gpt-4o-realtime-preview-2024-12-17":case"gpt-4o-mini-realtime-preview":case"gpt-4o-mini-realtime-preview-2024-12-17":case"gpt-4.1":case"gpt-4.1-2025-04-14":case"gpt-4.1-mini":case"gpt-4.1-mini-2025-04-14":case"gpt-4.1-nano":case"gpt-4.1-nano-2025-04-14":case"gpt-4.5-preview":case"gpt-4.5-preview-2025-02-27":case"gpt-5":case"gpt-5-2025-08-07":case"gpt-5-nano":case"gpt-5-nano-2025-08-07":case"gpt-5-mini":case"gpt-5-mini-2025-08-07":case"gpt-5-chat-latest":return"o200k_base";default:throw new Error("Unknown model")}}var bn={},Lf=new yt({});function jf(r){return h(this,null,function*(){return r in bn||(bn[r]=Lf.fetch(`https://tiktoken.pages.dev/js/${r}.json`).then(e=>e.json()).then(e=>new _n(e)).catch(e=>{throw delete bn[r],e})),yield bn[r]})}function Fo(r){return h(this,null,function*(){return jf(Gs(r))})}var vr={};Cs(vr,{BRAND:()=>uh,DIRTY:()=>It,EMPTY_PATH:()=>Ff,INVALID:()=>N,NEVER:()=>Vh,OK:()=>me,ParseStatus:()=>ce,Schema:()=>H,ZodAny:()=>xn,ZodArray:()=>_r,ZodBigInt:()=>Xs,ZodBoolean:()=>Ys,ZodBranded:()=>br,ZodCatch:()=>ua,ZodDate:()=>Qs,ZodDefault:()=>oa,ZodDiscriminatedUnion:()=>En,ZodEffects:()=>Xt,ZodEnum:()=>An,ZodError:()=>et,ZodFirstPartyTypeKind:()=>E,ZodFunction:()=>Tn,ZodIntersection:()=>na,ZodIssueCode:()=>x,ZodLazy:()=>sa,ZodLiteral:()=>aa,ZodMap:()=>Ko,ZodNaN:()=>Qo,ZodNativeEnum:()=>ia,ZodNever:()=>Nt,ZodNull:()=>ta,ZodNullable:()=>Yt,ZodNumber:()=>Ks,ZodObject:()=>Wt,ZodOptional:()=>bt,ZodParsedType:()=>S,ZodPipeline:()=>wr,ZodPromise:()=>Rn,ZodReadonly:()=>ca,ZodRecord:()=>On,ZodSchema:()=>H,ZodSet:()=>Xo,ZodString:()=>Sn,ZodSymbol:()=>Jo,ZodTransformer:()=>Xt,ZodTuple:()=>Kt,ZodType:()=>H,ZodUndefined:()=>ea,ZodUnion:()=>ra,ZodUnknown:()=>yr,ZodVoid:()=>Wo,addIssueToContext:()=>O,any:()=>yh,array:()=>vh,bigint:()=>fh,boolean:()=>nu,coerce:()=>Zh,custom:()=>eu,date:()=>hh,datetimeRegex:()=>Go,defaultErrorMap:()=>ot,discriminatedUnion:()=>Th,effect:()=>Dh,enum:()=>$h,function:()=>Ph,getErrorMap:()=>Vt,getParsedType:()=>Qe,instanceof:()=>lh,intersection:()=>Sh,isAborted:()=>wn,isAsync:()=>Gt,isDirty:()=>vn,isValid:()=>_t,late:()=>ch,lazy:()=>Ih,literal:()=>Nh,makeIssue:()=>gr,map:()=>kh,nan:()=>dh,nativeEnum:()=>Lh,never:()=>bh,null:()=>gh,nullable:()=>Uh,number:()=>ru,object:()=>xh,objectUtil:()=>Bo,oboolean:()=>zh,onumber:()=>Hh,optional:()=>Mh,ostring:()=>qh,pipeline:()=>Bh,preprocess:()=>Fh,promise:()=>jh,quotelessJson:()=>Df,record:()=>Rh,set:()=>Ch,setErrorMap:()=>Uf,strictObject:()=>Eh,string:()=>tu,symbol:()=>ph,transformer:()=>Dh,tuple:()=>Ah,undefined:()=>mh,union:()=>Oh,unknown:()=>_h,util:()=>V,void:()=>wh});var V;(function(r){r.assertEqual=s=>{};function e(s){}r.assertIs=e;function t(s){throw new Error}r.assertNever=t,r.arrayToEnum=s=>{let a={};for(let i of s)a[i]=i;return a},r.getValidEnumValues=s=>{let a=r.objectKeys(s).filter(o=>typeof s[s[o]]!="number"),i={};for(let o of a)i[o]=s[o];return r.objectValues(i)},r.objectValues=s=>r.objectKeys(s).map(function(a){return s[a]}),r.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{let a=[];for(let i in s)Object.prototype.hasOwnProperty.call(s,i)&&a.push(i);return a},r.find=(s,a)=>{for(let i of s)if(a(i))return i},r.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&Number.isFinite(s)&&Math.floor(s)===s;function n(s,a=" | "){return s.map(i=>typeof i=="string"?`'${i}'`:i).join(a)}r.joinValues=n,r.jsonStringifyReplacer=(s,a)=>typeof a=="bigint"?a.toString():a})(V||(V={}));var Bo=(function(r){return r.mergeShapes=(e,t)=>l(l({},e),t),r})(Bo||{}),S=V.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Qe=r=>{switch(typeof r){case"undefined":return S.undefined;case"string":return S.string;case"number":return Number.isNaN(r)?S.nan:S.number;case"boolean":return S.boolean;case"function":return S.function;case"bigint":return S.bigint;case"symbol":return S.symbol;case"object":return Array.isArray(r)?S.array:r===null?S.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?S.promise:typeof Map<"u"&&r instanceof Map?S.map:typeof Set<"u"&&r instanceof Set?S.set:typeof Date<"u"&&r instanceof Date?S.date:S.object;default:return S.unknown}};var x=V.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),Df=r=>JSON.stringify(r,null,2).replace(/"([^"]+)":/g,"$1:"),et=(()=>{class r extends Error{get errors(){return this.issues}constructor(t){super(),this.issues=[],this.addIssue=s=>{this.issues=[...this.issues,s]},this.addIssues=(s=[])=>{this.issues=[...this.issues,...s]};let n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=t}format(t){let n=t||function(i){return i.message},s={_errors:[]},a=i=>{for(let o of i.issues)if(o.code==="invalid_union")o.unionErrors.map(a);else if(o.code==="invalid_return_type")a(o.returnTypeError);else if(o.code==="invalid_arguments")a(o.argumentsError);else if(o.path.length===0)s._errors.push(n(o));else{let u=s,c=0;for(;c<o.path.length;){let d=o.path[c];c===o.path.length-1?(u[d]=u[d]||{_errors:[]},u[d]._errors.push(n(o))):u[d]=u[d]||{_errors:[]},u=u[d],c++}}};return a(this),s}static assert(t){if(!(t instanceof r))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,V.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=n=>n.message){let n={},s=[];for(let a of this.issues)if(a.path.length>0){let i=a.path[0];n[i]=n[i]||[],n[i].push(t(a))}else s.push(t(a));return{formErrors:s,fieldErrors:n}}get formErrors(){return this.flatten()}}return r.create=e=>new r(e),r})();var Mf=(r,e)=>{let t;switch(r.code){case x.invalid_type:r.received===S.undefined?t="Required":t=`Expected ${r.expected}, received ${r.received}`;break;case x.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(r.expected,V.jsonStringifyReplacer)}`;break;case x.unrecognized_keys:t=`Unrecognized key(s) in object: ${V.joinValues(r.keys,", ")}`;break;case x.invalid_union:t="Invalid input";break;case x.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${V.joinValues(r.options)}`;break;case x.invalid_enum_value:t=`Invalid enum value. Expected ${V.joinValues(r.options)}, received '${r.received}'`;break;case x.invalid_arguments:t="Invalid function arguments";break;case x.invalid_return_type:t="Invalid function return type";break;case x.invalid_date:t="Invalid date";break;case x.invalid_string:typeof r.validation=="object"?"includes"in r.validation?(t=`Invalid input: must include "${r.validation.includes}"`,typeof r.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${r.validation.position}`)):"startsWith"in r.validation?t=`Invalid input: must start with "${r.validation.startsWith}"`:"endsWith"in r.validation?t=`Invalid input: must end with "${r.validation.endsWith}"`:V.assertNever(r.validation):r.validation!=="regex"?t=`Invalid ${r.validation}`:t="Invalid";break;case x.too_small:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at least":"more than"} ${r.minimum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at least":"over"} ${r.minimum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="bigint"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(r.minimum))}`:t="Invalid input";break;case x.too_big:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at most":"less than"} ${r.maximum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at most":"under"} ${r.maximum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="bigint"?t=`BigInt must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly":r.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(r.maximum))}`:t="Invalid input";break;case x.custom:t="Invalid input";break;case x.invalid_intersection_types:t="Intersection results could not be merged";break;case x.not_multiple_of:t=`Number must be a multiple of ${r.multipleOf}`;break;case x.not_finite:t="Number must be finite";break;default:t=e.defaultError,V.assertNever(r)}return{message:t}},ot=Mf;var qo=ot;function Uf(r){qo=r}function Vt(){return qo}var gr=r=>{let{data:e,path:t,errorMaps:n,issueData:s}=r,a=[...t,...s.path||[]],i=g(l({},s),{path:a});if(s.message!==void 0)return g(l({},s),{path:a,message:s.message});let o="",u=n.filter(c=>!!c).slice().reverse();for(let c of u)o=c(i,{data:e,defaultError:o}).message;return g(l({},s),{path:a,message:o})},Ff=[];function O(r,e){let t=Vt(),n=gr({issueData:e,data:r.data,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,t,t===ot?void 0:ot].filter(s=>!!s)});r.common.issues.push(n)}var ce=class r{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){let n=[];for(let s of t){if(s.status==="aborted")return N;s.status==="dirty"&&e.dirty(),n.push(s.value)}return{status:e.value,value:n}}static mergeObjectAsync(e,t){return h(this,null,function*(){let n=[];for(let s of t){let a=yield s.key,i=yield s.value;n.push({key:a,value:i})}return r.mergeObjectSync(e,n)})}static mergeObjectSync(e,t){let n={};for(let s of t){let{key:a,value:i}=s;if(a.status==="aborted"||i.status==="aborted")return N;a.status==="dirty"&&e.dirty(),i.status==="dirty"&&e.dirty(),a.value!=="__proto__"&&(typeof i.value<"u"||s.alwaysSet)&&(n[a.value]=i.value)}return{status:e.value,value:n}}},N=Object.freeze({status:"aborted"}),It=r=>({status:"dirty",value:r}),me=r=>({status:"valid",value:r}),wn=r=>r.status==="aborted",vn=r=>r.status==="dirty",_t=r=>r.status==="valid",Gt=r=>typeof Promise<"u"&&r instanceof Promise;var P=(function(r){return r.errToObj=e=>typeof e=="string"?{message:e}:e||{},r.toString=e=>typeof e=="string"?e:e?.message,r})(P||{});var Ie=class{constructor(e,t,n,s){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=s}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},Ho=(r,e)=>{if(_t(e))return{success:!0,data:e.value};if(!r.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new et(r.common.issues);return this._error=t,this._error}}};function F(r){if(!r)return{};let{errorMap:e,invalid_type_error:t,required_error:n,description:s}=r;if(e&&(t||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(i,o)=>{let{message:u}=r;return i.code==="invalid_enum_value"?{message:u??o.defaultError}:typeof o.data>"u"?{message:u??n??o.defaultError}:i.code!=="invalid_type"?{message:o.defaultError}:{message:u??t??o.defaultError}},description:s}}var H=class{get description(){return this._def.description}_getType(e){return Qe(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Qe(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new ce,ctx:{common:e.parent.common,data:e.data,parsedType:Qe(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(Gt(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){let t=this._parse(e);return Promise.resolve(t)}parse(e,t){let n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){let n={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Qe(e)},s=this._parseSync({data:e,path:n.path,parent:n});return Ho(n,s)}"~validate"(e){let t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Qe(e)};if(!this["~standard"].async)try{let n=this._parseSync({data:e,path:[],parent:t});return _t(n)?{value:n.value}:{issues:t.common.issues}}catch(n){n?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(n=>_t(n)?{value:n.value}:{issues:t.common.issues})}parseAsync(e,t){return h(this,null,function*(){let n=yield this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error})}safeParseAsync(e,t){return h(this,null,function*(){let n={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Qe(e)},s=this._parse({data:e,path:n.path,parent:n}),a=yield Gt(s)?s:Promise.resolve(s);return Ho(n,a)})}refine(e,t){let n=s=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(s):t;return this._refinement((s,a)=>{let i=e(s),o=()=>a.addIssue(l({code:x.custom},n(s)));return typeof Promise<"u"&&i instanceof Promise?i.then(u=>u?!0:(o(),!1)):i?!0:(o(),!1)})}refinement(e,t){return this._refinement((n,s)=>e(n)?!0:(s.addIssue(typeof t=="function"?t(n,s):t),!1))}_refinement(e){return new Xt({schema:this,typeName:E.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return bt.create(this,this._def)}nullable(){return Yt.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return _r.create(this)}promise(){return Rn.create(this,this._def)}or(e){return ra.create([this,e],this._def)}and(e){return na.create(this,e,this._def)}transform(e){return new Xt(g(l({},F(this._def)),{schema:this,typeName:E.ZodEffects,effect:{type:"transform",transform:e}}))}default(e){let t=typeof e=="function"?e:()=>e;return new oa(g(l({},F(this._def)),{innerType:this,defaultValue:t,typeName:E.ZodDefault}))}brand(){return new br(l({typeName:E.ZodBranded,type:this},F(this._def)))}catch(e){let t=typeof e=="function"?e:()=>e;return new ua(g(l({},F(this._def)),{innerType:this,catchValue:t,typeName:E.ZodCatch}))}describe(e){let t=this.constructor;return new t(g(l({},this._def),{description:e}))}pipe(e){return wr.create(this,e)}readonly(){return ca.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},Bf=/^c[^\s-]{8,}$/i,qf=/^[0-9a-z]+$/,Hf=/^[0-9A-HJKMNP-TV-Z]{26}$/i,zf=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Zf=/^[a-z0-9_-]{21}$/i,Vf=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Gf=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Jf=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Wf="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",Js,Kf=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Xf=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Yf=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Qf=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,eh=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,th=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Zo="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",rh=new RegExp(`^${Zo}$`);function Vo(r){let e="[0-5]\\d";r.precision?e=`${e}\\.\\d{${r.precision}}`:r.precision==null&&(e=`${e}(\\.\\d+)?`);let t=r.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${t}`}function nh(r){return new RegExp(`^${Vo(r)}$`)}function Go(r){let e=`${Zo}T${Vo(r)}`,t=[];return t.push(r.local?"Z?":"Z"),r.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function sh(r,e){return!!((e==="v4"||!e)&&Kf.test(r)||(e==="v6"||!e)&&Yf.test(r))}function ah(r,e){if(!Vf.test(r))return!1;try{let[t]=r.split(".");if(!t)return!1;let n=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),s=JSON.parse(atob(n));return!(typeof s!="object"||s===null||"typ"in s&&s?.typ!=="JWT"||!s.alg||e&&s.alg!==e)}catch{return!1}}function ih(r,e){return!!((e==="v4"||!e)&&Xf.test(r)||(e==="v6"||!e)&&Qf.test(r))}var Sn=(()=>{class r extends H{_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==S.string){let i=this._getOrReturnCtx(t);return O(i,{code:x.invalid_type,expected:S.string,received:i.parsedType}),N}let s=new ce,a;for(let i of this._def.checks)if(i.kind==="min")t.data.length<i.value&&(a=this._getOrReturnCtx(t,a),O(a,{code:x.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),s.dirty());else if(i.kind==="max")t.data.length>i.value&&(a=this._getOrReturnCtx(t,a),O(a,{code:x.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),s.dirty());else if(i.kind==="length"){let o=t.data.length>i.value,u=t.data.length<i.value;(o||u)&&(a=this._getOrReturnCtx(t,a),o?O(a,{code:x.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):u&&O(a,{code:x.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),s.dirty())}else if(i.kind==="email")Jf.test(t.data)||(a=this._getOrReturnCtx(t,a),O(a,{validation:"email",code:x.invalid_string,message:i.message}),s.dirty());else if(i.kind==="emoji")Js||(Js=new RegExp(Wf,"u")),Js.test(t.data)||(a=this._getOrReturnCtx(t,a),O(a,{validation:"emoji",code:x.invalid_string,message:i.message}),s.dirty());else if(i.kind==="uuid")zf.test(t.data)||(a=this._getOrReturnCtx(t,a),O(a,{validation:"uuid",code:x.invalid_string,message:i.message}),s.dirty());else if(i.kind==="nanoid")Zf.test(t.data)||(a=this._getOrReturnCtx(t,a),O(a,{validation:"nanoid",code:x.invalid_string,message:i.message}),s.dirty());else if(i.kind==="cuid")Bf.test(t.data)||(a=this._getOrReturnCtx(t,a),O(a,{validation:"cuid",code:x.invalid_string,message:i.message}),s.dirty());else if(i.kind==="cuid2")qf.test(t.data)||(a=this._getOrReturnCtx(t,a),O(a,{validation:"cuid2",code:x.invalid_string,message:i.message}),s.dirty());else if(i.kind==="ulid")Hf.test(t.data)||(a=this._getOrReturnCtx(t,a),O(a,{validation:"ulid",code:x.invalid_string,message:i.message}),s.dirty());else if(i.kind==="url")try{new URL(t.data)}catch{a=this._getOrReturnCtx(t,a),O(a,{validation:"url",code:x.invalid_string,message:i.message}),s.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(t.data)||(a=this._getOrReturnCtx(t,a),O(a,{validation:"regex",code:x.invalid_string,message:i.message}),s.dirty())):i.kind==="trim"?t.data=t.data.trim():i.kind==="includes"?t.data.includes(i.value,i.position)||(a=this._getOrReturnCtx(t,a),O(a,{code:x.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),s.dirty()):i.kind==="toLowerCase"?t.data=t.data.toLowerCase():i.kind==="toUpperCase"?t.data=t.data.toUpperCase():i.kind==="startsWith"?t.data.startsWith(i.value)||(a=this._getOrReturnCtx(t,a),O(a,{code:x.invalid_string,validation:{startsWith:i.value},message:i.message}),s.dirty()):i.kind==="endsWith"?t.data.endsWith(i.value)||(a=this._getOrReturnCtx(t,a),O(a,{code:x.invalid_string,validation:{endsWith:i.value},message:i.message}),s.dirty()):i.kind==="datetime"?Go(i).test(t.data)||(a=this._getOrReturnCtx(t,a),O(a,{code:x.invalid_string,validation:"datetime",message:i.message}),s.dirty()):i.kind==="date"?rh.test(t.data)||(a=this._getOrReturnCtx(t,a),O(a,{code:x.invalid_string,validation:"date",message:i.message}),s.dirty()):i.kind==="time"?nh(i).test(t.data)||(a=this._getOrReturnCtx(t,a),O(a,{code:x.invalid_string,validation:"time",message:i.message}),s.dirty()):i.kind==="duration"?Gf.test(t.data)||(a=this._getOrReturnCtx(t,a),O(a,{validation:"duration",code:x.invalid_string,message:i.message}),s.dirty()):i.kind==="ip"?sh(t.data,i.version)||(a=this._getOrReturnCtx(t,a),O(a,{validation:"ip",code:x.invalid_string,message:i.message}),s.dirty()):i.kind==="jwt"?ah(t.data,i.alg)||(a=this._getOrReturnCtx(t,a),O(a,{validation:"jwt",code:x.invalid_string,message:i.message}),s.dirty()):i.kind==="cidr"?ih(t.data,i.version)||(a=this._getOrReturnCtx(t,a),O(a,{validation:"cidr",code:x.invalid_string,message:i.message}),s.dirty()):i.kind==="base64"?eh.test(t.data)||(a=this._getOrReturnCtx(t,a),O(a,{validation:"base64",code:x.invalid_string,message:i.message}),s.dirty()):i.kind==="base64url"?th.test(t.data)||(a=this._getOrReturnCtx(t,a),O(a,{validation:"base64url",code:x.invalid_string,message:i.message}),s.dirty()):V.assertNever(i);return{status:s.value,value:t.data}}_regex(t,n,s){return this.refinement(a=>t.test(a),l({validation:n,code:x.invalid_string},P.errToObj(s)))}_addCheck(t){return new r(g(l({},this._def),{checks:[...this._def.checks,t]}))}email(t){return this._addCheck(l({kind:"email"},P.errToObj(t)))}url(t){return this._addCheck(l({kind:"url"},P.errToObj(t)))}emoji(t){return this._addCheck(l({kind:"emoji"},P.errToObj(t)))}uuid(t){return this._addCheck(l({kind:"uuid"},P.errToObj(t)))}nanoid(t){return this._addCheck(l({kind:"nanoid"},P.errToObj(t)))}cuid(t){return this._addCheck(l({kind:"cuid"},P.errToObj(t)))}cuid2(t){return this._addCheck(l({kind:"cuid2"},P.errToObj(t)))}ulid(t){return this._addCheck(l({kind:"ulid"},P.errToObj(t)))}base64(t){return this._addCheck(l({kind:"base64"},P.errToObj(t)))}base64url(t){return this._addCheck(l({kind:"base64url"},P.errToObj(t)))}jwt(t){return this._addCheck(l({kind:"jwt"},P.errToObj(t)))}ip(t){return this._addCheck(l({kind:"ip"},P.errToObj(t)))}cidr(t){return this._addCheck(l({kind:"cidr"},P.errToObj(t)))}datetime(t){return typeof t=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:t}):this._addCheck(l({kind:"datetime",precision:typeof t?.precision>"u"?null:t?.precision,offset:t?.offset??!1,local:t?.local??!1},P.errToObj(t?.message)))}date(t){return this._addCheck({kind:"date",message:t})}time(t){return typeof t=="string"?this._addCheck({kind:"time",precision:null,message:t}):this._addCheck(l({kind:"time",precision:typeof t?.precision>"u"?null:t?.precision},P.errToObj(t?.message)))}duration(t){return this._addCheck(l({kind:"duration"},P.errToObj(t)))}regex(t,n){return this._addCheck(l({kind:"regex",regex:t},P.errToObj(n)))}includes(t,n){return this._addCheck(l({kind:"includes",value:t,position:n?.position},P.errToObj(n?.message)))}startsWith(t,n){return this._addCheck(l({kind:"startsWith",value:t},P.errToObj(n)))}endsWith(t,n){return this._addCheck(l({kind:"endsWith",value:t},P.errToObj(n)))}min(t,n){return this._addCheck(l({kind:"min",value:t},P.errToObj(n)))}max(t,n){return this._addCheck(l({kind:"max",value:t},P.errToObj(n)))}length(t,n){return this._addCheck(l({kind:"length",value:t},P.errToObj(n)))}nonempty(t){return this.min(1,P.errToObj(t))}trim(){return new r(g(l({},this._def),{checks:[...this._def.checks,{kind:"trim"}]}))}toLowerCase(){return new r(g(l({},this._def),{checks:[...this._def.checks,{kind:"toLowerCase"}]}))}toUpperCase(){return new r(g(l({},this._def),{checks:[...this._def.checks,{kind:"toUpperCase"}]}))}get isDatetime(){return!!this._def.checks.find(t=>t.kind==="datetime")}get isDate(){return!!this._def.checks.find(t=>t.kind==="date")}get isTime(){return!!this._def.checks.find(t=>t.kind==="time")}get isDuration(){return!!this._def.checks.find(t=>t.kind==="duration")}get isEmail(){return!!this._def.checks.find(t=>t.kind==="email")}get isURL(){return!!this._def.checks.find(t=>t.kind==="url")}get isEmoji(){return!!this._def.checks.find(t=>t.kind==="emoji")}get isUUID(){return!!this._def.checks.find(t=>t.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(t=>t.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(t=>t.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(t=>t.kind==="cuid2")}get isULID(){return!!this._def.checks.find(t=>t.kind==="ulid")}get isIP(){return!!this._def.checks.find(t=>t.kind==="ip")}get isCIDR(){return!!this._def.checks.find(t=>t.kind==="cidr")}get isBase64(){return!!this._def.checks.find(t=>t.kind==="base64")}get isBase64url(){return!!this._def.checks.find(t=>t.kind==="base64url")}get minLength(){let t=null;for(let n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxLength(){let t=null;for(let n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}}return r.create=e=>new r(l({checks:[],typeName:E.ZodString,coerce:e?.coerce??!1},F(e))),r})();function oh(r,e){let t=(r.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,s=t>n?t:n,a=Number.parseInt(r.toFixed(s).replace(".","")),i=Number.parseInt(e.toFixed(s).replace(".",""));return a%i/10**s}var Ks=(()=>{class r extends H{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==S.number){let i=this._getOrReturnCtx(t);return O(i,{code:x.invalid_type,expected:S.number,received:i.parsedType}),N}let s,a=new ce;for(let i of this._def.checks)i.kind==="int"?V.isInteger(t.data)||(s=this._getOrReturnCtx(t,s),O(s,{code:x.invalid_type,expected:"integer",received:"float",message:i.message}),a.dirty()):i.kind==="min"?(i.inclusive?t.data<i.value:t.data<=i.value)&&(s=this._getOrReturnCtx(t,s),O(s,{code:x.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),a.dirty()):i.kind==="max"?(i.inclusive?t.data>i.value:t.data>=i.value)&&(s=this._getOrReturnCtx(t,s),O(s,{code:x.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),a.dirty()):i.kind==="multipleOf"?oh(t.data,i.value)!==0&&(s=this._getOrReturnCtx(t,s),O(s,{code:x.not_multiple_of,multipleOf:i.value,message:i.message}),a.dirty()):i.kind==="finite"?Number.isFinite(t.data)||(s=this._getOrReturnCtx(t,s),O(s,{code:x.not_finite,message:i.message}),a.dirty()):V.assertNever(i);return{status:a.value,value:t.data}}gte(t,n){return this.setLimit("min",t,!0,P.toString(n))}gt(t,n){return this.setLimit("min",t,!1,P.toString(n))}lte(t,n){return this.setLimit("max",t,!0,P.toString(n))}lt(t,n){return this.setLimit("max",t,!1,P.toString(n))}setLimit(t,n,s,a){return new r(g(l({},this._def),{checks:[...this._def.checks,{kind:t,value:n,inclusive:s,message:P.toString(a)}]}))}_addCheck(t){return new r(g(l({},this._def),{checks:[...this._def.checks,t]}))}int(t){return this._addCheck({kind:"int",message:P.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:P.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:P.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:P.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:P.toString(t)})}multipleOf(t,n){return this._addCheck({kind:"multipleOf",value:t,message:P.toString(n)})}finite(t){return this._addCheck({kind:"finite",message:P.toString(t)})}safe(t){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:P.toString(t)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:P.toString(t)})}get minValue(){let t=null;for(let n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxValue(){let t=null;for(let n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}get isInt(){return!!this._def.checks.find(t=>t.kind==="int"||t.kind==="multipleOf"&&V.isInteger(t.value))}get isFinite(){let t=null,n=null;for(let s of this._def.checks){if(s.kind==="finite"||s.kind==="int"||s.kind==="multipleOf")return!0;s.kind==="min"?(n===null||s.value>n)&&(n=s.value):s.kind==="max"&&(t===null||s.value<t)&&(t=s.value)}return Number.isFinite(n)&&Number.isFinite(t)}}return r.create=e=>new r(l({checks:[],typeName:E.ZodNumber,coerce:e?.coerce||!1},F(e))),r})(),Xs=(()=>{class r extends H{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(t){if(this._def.coerce)try{t.data=BigInt(t.data)}catch{return this._getInvalidInput(t)}if(this._getType(t)!==S.bigint)return this._getInvalidInput(t);let s,a=new ce;for(let i of this._def.checks)i.kind==="min"?(i.inclusive?t.data<i.value:t.data<=i.value)&&(s=this._getOrReturnCtx(t,s),O(s,{code:x.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),a.dirty()):i.kind==="max"?(i.inclusive?t.data>i.value:t.data>=i.value)&&(s=this._getOrReturnCtx(t,s),O(s,{code:x.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),a.dirty()):i.kind==="multipleOf"?t.data%i.value!==BigInt(0)&&(s=this._getOrReturnCtx(t,s),O(s,{code:x.not_multiple_of,multipleOf:i.value,message:i.message}),a.dirty()):V.assertNever(i);return{status:a.value,value:t.data}}_getInvalidInput(t){let n=this._getOrReturnCtx(t);return O(n,{code:x.invalid_type,expected:S.bigint,received:n.parsedType}),N}gte(t,n){return this.setLimit("min",t,!0,P.toString(n))}gt(t,n){return this.setLimit("min",t,!1,P.toString(n))}lte(t,n){return this.setLimit("max",t,!0,P.toString(n))}lt(t,n){return this.setLimit("max",t,!1,P.toString(n))}setLimit(t,n,s,a){return new r(g(l({},this._def),{checks:[...this._def.checks,{kind:t,value:n,inclusive:s,message:P.toString(a)}]}))}_addCheck(t){return new r(g(l({},this._def),{checks:[...this._def.checks,t]}))}positive(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:P.toString(t)})}negative(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:P.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:P.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:P.toString(t)})}multipleOf(t,n){return this._addCheck({kind:"multipleOf",value:t,message:P.toString(n)})}get minValue(){let t=null;for(let n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxValue(){let t=null;for(let n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}}return r.create=e=>new r(l({checks:[],typeName:E.ZodBigInt,coerce:e?.coerce??!1},F(e))),r})(),Ys=(()=>{class r extends H{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==S.boolean){let s=this._getOrReturnCtx(t);return O(s,{code:x.invalid_type,expected:S.boolean,received:s.parsedType}),N}return me(t.data)}}return r.create=e=>new r(l({typeName:E.ZodBoolean,coerce:e?.coerce||!1},F(e))),r})(),Qs=(()=>{class r extends H{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==S.date){let i=this._getOrReturnCtx(t);return O(i,{code:x.invalid_type,expected:S.date,received:i.parsedType}),N}if(Number.isNaN(t.data.getTime())){let i=this._getOrReturnCtx(t);return O(i,{code:x.invalid_date}),N}let s=new ce,a;for(let i of this._def.checks)i.kind==="min"?t.data.getTime()<i.value&&(a=this._getOrReturnCtx(t,a),O(a,{code:x.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),s.dirty()):i.kind==="max"?t.data.getTime()>i.value&&(a=this._getOrReturnCtx(t,a),O(a,{code:x.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),s.dirty()):V.assertNever(i);return{status:s.value,value:new Date(t.data.getTime())}}_addCheck(t){return new r(g(l({},this._def),{checks:[...this._def.checks,t]}))}min(t,n){return this._addCheck({kind:"min",value:t.getTime(),message:P.toString(n)})}max(t,n){return this._addCheck({kind:"max",value:t.getTime(),message:P.toString(n)})}get minDate(){let t=null;for(let n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t!=null?new Date(t):null}get maxDate(){let t=null;for(let n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t!=null?new Date(t):null}}return r.create=e=>new r(l({checks:[],coerce:e?.coerce||!1,typeName:E.ZodDate},F(e))),r})(),Jo=(()=>{class r extends H{_parse(t){if(this._getType(t)!==S.symbol){let s=this._getOrReturnCtx(t);return O(s,{code:x.invalid_type,expected:S.symbol,received:s.parsedType}),N}return me(t.data)}}return r.create=e=>new r(l({typeName:E.ZodSymbol},F(e))),r})(),ea=(()=>{class r extends H{_parse(t){if(this._getType(t)!==S.undefined){let s=this._getOrReturnCtx(t);return O(s,{code:x.invalid_type,expected:S.undefined,received:s.parsedType}),N}return me(t.data)}}return r.create=e=>new r(l({typeName:E.ZodUndefined},F(e))),r})(),ta=(()=>{class r extends H{_parse(t){if(this._getType(t)!==S.null){let s=this._getOrReturnCtx(t);return O(s,{code:x.invalid_type,expected:S.null,received:s.parsedType}),N}return me(t.data)}}return r.create=e=>new r(l({typeName:E.ZodNull},F(e))),r})(),xn=(()=>{class r extends H{constructor(){super(...arguments),this._any=!0}_parse(t){return me(t.data)}}return r.create=e=>new r(l({typeName:E.ZodAny},F(e))),r})(),yr=(()=>{class r extends H{constructor(){super(...arguments),this._unknown=!0}_parse(t){return me(t.data)}}return r.create=e=>new r(l({typeName:E.ZodUnknown},F(e))),r})(),Nt=(()=>{class r extends H{_parse(t){let n=this._getOrReturnCtx(t);return O(n,{code:x.invalid_type,expected:S.never,received:n.parsedType}),N}}return r.create=e=>new r(l({typeName:E.ZodNever},F(e))),r})(),Wo=(()=>{class r extends H{_parse(t){if(this._getType(t)!==S.undefined){let s=this._getOrReturnCtx(t);return O(s,{code:x.invalid_type,expected:S.void,received:s.parsedType}),N}return me(t.data)}}return r.create=e=>new r(l({typeName:E.ZodVoid},F(e))),r})(),_r=(()=>{class r extends H{_parse(t){let{ctx:n,status:s}=this._processInputParams(t),a=this._def;if(n.parsedType!==S.array)return O(n,{code:x.invalid_type,expected:S.array,received:n.parsedType}),N;if(a.exactLength!==null){let o=n.data.length>a.exactLength.value,u=n.data.length<a.exactLength.value;(o||u)&&(O(n,{code:o?x.too_big:x.too_small,minimum:u?a.exactLength.value:void 0,maximum:o?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),s.dirty())}if(a.minLength!==null&&n.data.length<a.minLength.value&&(O(n,{code:x.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),s.dirty()),a.maxLength!==null&&n.data.length>a.maxLength.value&&(O(n,{code:x.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),s.dirty()),n.common.async)return Promise.all([...n.data].map((o,u)=>a.type._parseAsync(new Ie(n,o,n.path,u)))).then(o=>ce.mergeArray(s,o));let i=[...n.data].map((o,u)=>a.type._parseSync(new Ie(n,o,n.path,u)));return ce.mergeArray(s,i)}get element(){return this._def.type}min(t,n){return new r(g(l({},this._def),{minLength:{value:t,message:P.toString(n)}}))}max(t,n){return new r(g(l({},this._def),{maxLength:{value:t,message:P.toString(n)}}))}length(t,n){return new r(g(l({},this._def),{exactLength:{value:t,message:P.toString(n)}}))}nonempty(t){return this.min(1,t)}}return r.create=(e,t)=>new r(l({type:e,minLength:null,maxLength:null,exactLength:null,typeName:E.ZodArray},F(t))),r})();function Jt(r){if(r instanceof Wt){let e={};for(let t in r.shape){let n=r.shape[t];e[t]=bt.create(Jt(n))}return new Wt(g(l({},r._def),{shape:()=>e}))}else return r instanceof _r?new _r(g(l({},r._def),{type:Jt(r.element)})):r instanceof bt?bt.create(Jt(r.unwrap())):r instanceof Yt?Yt.create(Jt(r.unwrap())):r instanceof Kt?Kt.create(r.items.map(e=>Jt(e))):r}var Wt=(()=>{class r extends H{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let t=this._def.shape(),n=V.objectKeys(t);return this._cached={shape:t,keys:n},this._cached}_parse(t){if(this._getType(t)!==S.object){let d=this._getOrReturnCtx(t);return O(d,{code:x.invalid_type,expected:S.object,received:d.parsedType}),N}let{status:s,ctx:a}=this._processInputParams(t),{shape:i,keys:o}=this._getCached(),u=[];if(!(this._def.catchall instanceof Nt&&this._def.unknownKeys==="strip"))for(let d in a.data)o.includes(d)||u.push(d);let c=[];for(let d of o){let f=i[d],p=a.data[d];c.push({key:{status:"valid",value:d},value:f._parse(new Ie(a,p,a.path,d)),alwaysSet:d in a.data})}if(this._def.catchall instanceof Nt){let d=this._def.unknownKeys;if(d==="passthrough")for(let f of u)c.push({key:{status:"valid",value:f},value:{status:"valid",value:a.data[f]}});else if(d==="strict")u.length>0&&(O(a,{code:x.unrecognized_keys,keys:u}),s.dirty());else if(d!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let d=this._def.catchall;for(let f of u){let p=a.data[f];c.push({key:{status:"valid",value:f},value:d._parse(new Ie(a,p,a.path,f)),alwaysSet:f in a.data})}}return a.common.async?Promise.resolve().then(()=>h(this,null,function*(){let d=[];for(let f of c){let p=yield f.key,m=yield f.value;d.push({key:p,value:m,alwaysSet:f.alwaysSet})}return d})).then(d=>ce.mergeObjectSync(s,d)):ce.mergeObjectSync(s,c)}get shape(){return this._def.shape()}strict(t){return P.errToObj,new r(l(g(l({},this._def),{unknownKeys:"strict"}),t!==void 0?{errorMap:(n,s)=>{let a=this._def.errorMap?.(n,s).message??s.defaultError;return n.code==="unrecognized_keys"?{message:P.errToObj(t).message??a}:{message:a}}}:{}))}strip(){return new r(g(l({},this._def),{unknownKeys:"strip"}))}passthrough(){return new r(g(l({},this._def),{unknownKeys:"passthrough"}))}extend(t){return new r(g(l({},this._def),{shape:()=>l(l({},this._def.shape()),t)}))}merge(t){return new r({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>l(l({},this._def.shape()),t._def.shape()),typeName:E.ZodObject})}setKey(t,n){return this.augment({[t]:n})}catchall(t){return new r(g(l({},this._def),{catchall:t}))}pick(t){let n={};for(let s of V.objectKeys(t))t[s]&&this.shape[s]&&(n[s]=this.shape[s]);return new r(g(l({},this._def),{shape:()=>n}))}omit(t){let n={};for(let s of V.objectKeys(this.shape))t[s]||(n[s]=this.shape[s]);return new r(g(l({},this._def),{shape:()=>n}))}deepPartial(){return Jt(this)}partial(t){let n={};for(let s of V.objectKeys(this.shape)){let a=this.shape[s];t&&!t[s]?n[s]=a:n[s]=a.optional()}return new r(g(l({},this._def),{shape:()=>n}))}required(t){let n={};for(let s of V.objectKeys(this.shape))if(t&&!t[s])n[s]=this.shape[s];else{let i=this.shape[s];for(;i instanceof bt;)i=i._def.innerType;n[s]=i}return new r(g(l({},this._def),{shape:()=>n}))}keyof(){return Yo(V.objectKeys(this.shape))}}return r.create=(e,t)=>new r(l({shape:()=>e,unknownKeys:"strip",catchall:Nt.create(),typeName:E.ZodObject},F(t))),r.strictCreate=(e,t)=>new r(l({shape:()=>e,unknownKeys:"strict",catchall:Nt.create(),typeName:E.ZodObject},F(t))),r.lazycreate=(e,t)=>new r(l({shape:e,unknownKeys:"strip",catchall:Nt.create(),typeName:E.ZodObject},F(t))),r})(),ra=(()=>{class r extends H{_parse(t){let{ctx:n}=this._processInputParams(t),s=this._def.options;function a(i){for(let u of i)if(u.result.status==="valid")return u.result;for(let u of i)if(u.result.status==="dirty")return n.common.issues.push(...u.ctx.common.issues),u.result;let o=i.map(u=>new et(u.ctx.common.issues));return O(n,{code:x.invalid_union,unionErrors:o}),N}if(n.common.async)return Promise.all(s.map(i=>h(this,null,function*(){let o=g(l({},n),{common:g(l({},n.common),{issues:[]}),parent:null});return{result:yield i._parseAsync({data:n.data,path:n.path,parent:o}),ctx:o}}))).then(a);{let i,o=[];for(let c of s){let d=g(l({},n),{common:g(l({},n.common),{issues:[]}),parent:null}),f=c._parseSync({data:n.data,path:n.path,parent:d});if(f.status==="valid")return f;f.status==="dirty"&&!i&&(i={result:f,ctx:d}),d.common.issues.length&&o.push(d.common.issues)}if(i)return n.common.issues.push(...i.ctx.common.issues),i.result;let u=o.map(c=>new et(c));return O(n,{code:x.invalid_union,unionErrors:u}),N}}get options(){return this._def.options}}return r.create=(e,t)=>new r(l({options:e,typeName:E.ZodUnion},F(t))),r})(),ut=r=>r instanceof sa?ut(r.schema):r instanceof Xt?ut(r.innerType()):r instanceof aa?[r.value]:r instanceof An?r.options:r instanceof ia?V.objectValues(r.enum):r instanceof oa?ut(r._def.innerType):r instanceof ea?[void 0]:r instanceof ta?[null]:r instanceof bt?[void 0,...ut(r.unwrap())]:r instanceof Yt?[null,...ut(r.unwrap())]:r instanceof br||r instanceof ca?ut(r.unwrap()):r instanceof ua?ut(r._def.innerType):[],En=class r extends H{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==S.object)return O(t,{code:x.invalid_type,expected:S.object,received:t.parsedType}),N;let n=this.discriminator,s=t.data[n],a=this.optionsMap.get(s);return a?t.common.async?a._parseAsync({data:t.data,path:t.path,parent:t}):a._parseSync({data:t.data,path:t.path,parent:t}):(O(t,{code:x.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),N)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,n){let s=new Map;for(let a of t){let i=ut(a.shape[e]);if(!i.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let o of i){if(s.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);s.set(o,a)}}return new r(l({typeName:E.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:s},F(n)))}};function Ws(r,e){let t=Qe(r),n=Qe(e);if(r===e)return{valid:!0,data:r};if(t===S.object&&n===S.object){let s=V.objectKeys(e),a=V.objectKeys(r).filter(o=>s.indexOf(o)!==-1),i=l(l({},r),e);for(let o of a){let u=Ws(r[o],e[o]);if(!u.valid)return{valid:!1};i[o]=u.data}return{valid:!0,data:i}}else if(t===S.array&&n===S.array){if(r.length!==e.length)return{valid:!1};let s=[];for(let a=0;a<r.length;a++){let i=r[a],o=e[a],u=Ws(i,o);if(!u.valid)return{valid:!1};s.push(u.data)}return{valid:!0,data:s}}else return t===S.date&&n===S.date&&+r==+e?{valid:!0,data:r}:{valid:!1}}var na=(()=>{class r extends H{_parse(t){let{status:n,ctx:s}=this._processInputParams(t),a=(i,o)=>{if(wn(i)||wn(o))return N;let u=Ws(i.value,o.value);return u.valid?((vn(i)||vn(o))&&n.dirty(),{status:n.value,value:u.data}):(O(s,{code:x.invalid_intersection_types}),N)};return s.common.async?Promise.all([this._def.left._parseAsync({data:s.data,path:s.path,parent:s}),this._def.right._parseAsync({data:s.data,path:s.path,parent:s})]).then(([i,o])=>a(i,o)):a(this._def.left._parseSync({data:s.data,path:s.path,parent:s}),this._def.right._parseSync({data:s.data,path:s.path,parent:s}))}}return r.create=(e,t,n)=>new r(l({left:e,right:t,typeName:E.ZodIntersection},F(n))),r})(),Kt=(()=>{class r extends H{_parse(t){let{status:n,ctx:s}=this._processInputParams(t);if(s.parsedType!==S.array)return O(s,{code:x.invalid_type,expected:S.array,received:s.parsedType}),N;if(s.data.length<this._def.items.length)return O(s,{code:x.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),N;!this._def.rest&&s.data.length>this._def.items.length&&(O(s,{code:x.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),n.dirty());let i=[...s.data].map((o,u)=>{let c=this._def.items[u]||this._def.rest;return c?c._parse(new Ie(s,o,s.path,u)):null}).filter(o=>!!o);return s.common.async?Promise.all(i).then(o=>ce.mergeArray(n,o)):ce.mergeArray(n,i)}get items(){return this._def.items}rest(t){return new r(g(l({},this._def),{rest:t}))}}return r.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new r(l({items:e,typeName:E.ZodTuple,rest:null},F(t)))},r})(),On=class r extends H{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==S.object)return O(n,{code:x.invalid_type,expected:S.object,received:n.parsedType}),N;let s=[],a=this._def.keyType,i=this._def.valueType;for(let o in n.data)s.push({key:a._parse(new Ie(n,o,n.path,o)),value:i._parse(new Ie(n,n.data[o],n.path,o)),alwaysSet:o in n.data});return n.common.async?ce.mergeObjectAsync(t,s):ce.mergeObjectSync(t,s)}get element(){return this._def.valueType}static create(e,t,n){return t instanceof H?new r(l({keyType:e,valueType:t,typeName:E.ZodRecord},F(n))):new r(l({keyType:Sn.create(),valueType:e,typeName:E.ZodRecord},F(t)))}},Ko=(()=>{class r extends H{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){let{status:n,ctx:s}=this._processInputParams(t);if(s.parsedType!==S.map)return O(s,{code:x.invalid_type,expected:S.map,received:s.parsedType}),N;let a=this._def.keyType,i=this._def.valueType,o=[...s.data.entries()].map(([u,c],d)=>({key:a._parse(new Ie(s,u,s.path,[d,"key"])),value:i._parse(new Ie(s,c,s.path,[d,"value"]))}));if(s.common.async){let u=new Map;return Promise.resolve().then(()=>h(this,null,function*(){for(let c of o){let d=yield c.key,f=yield c.value;if(d.status==="aborted"||f.status==="aborted")return N;(d.status==="dirty"||f.status==="dirty")&&n.dirty(),u.set(d.value,f.value)}return{status:n.value,value:u}}))}else{let u=new Map;for(let c of o){let d=c.key,f=c.value;if(d.status==="aborted"||f.status==="aborted")return N;(d.status==="dirty"||f.status==="dirty")&&n.dirty(),u.set(d.value,f.value)}return{status:n.value,value:u}}}}return r.create=(e,t,n)=>new r(l({valueType:t,keyType:e,typeName:E.ZodMap},F(n))),r})(),Xo=(()=>{class r extends H{_parse(t){let{status:n,ctx:s}=this._processInputParams(t);if(s.parsedType!==S.set)return O(s,{code:x.invalid_type,expected:S.set,received:s.parsedType}),N;let a=this._def;a.minSize!==null&&s.data.size<a.minSize.value&&(O(s,{code:x.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),n.dirty()),a.maxSize!==null&&s.data.size>a.maxSize.value&&(O(s,{code:x.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),n.dirty());let i=this._def.valueType;function o(c){let d=new Set;for(let f of c){if(f.status==="aborted")return N;f.status==="dirty"&&n.dirty(),d.add(f.value)}return{status:n.value,value:d}}let u=[...s.data.values()].map((c,d)=>i._parse(new Ie(s,c,s.path,d)));return s.common.async?Promise.all(u).then(c=>o(c)):o(u)}min(t,n){return new r(g(l({},this._def),{minSize:{value:t,message:P.toString(n)}}))}max(t,n){return new r(g(l({},this._def),{maxSize:{value:t,message:P.toString(n)}}))}size(t,n){return this.min(t,n).max(t,n)}nonempty(t){return this.min(1,t)}}return r.create=(e,t)=>new r(l({valueType:e,minSize:null,maxSize:null,typeName:E.ZodSet},F(t))),r})(),Tn=class r extends H{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==S.function)return O(t,{code:x.invalid_type,expected:S.function,received:t.parsedType}),N;function n(o,u){return gr({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Vt(),ot].filter(c=>!!c),issueData:{code:x.invalid_arguments,argumentsError:u}})}function s(o,u){return gr({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Vt(),ot].filter(c=>!!c),issueData:{code:x.invalid_return_type,returnTypeError:u}})}let a={errorMap:t.common.contextualErrorMap},i=t.data;if(this._def.returns instanceof Rn){let o=this;return me(function(...u){return h(this,null,function*(){let c=new et([]),d=yield o._def.args.parseAsync(u,a).catch(m=>{throw c.addIssue(n(u,m)),c}),f=yield Reflect.apply(i,this,d);return yield o._def.returns._def.type.parseAsync(f,a).catch(m=>{throw c.addIssue(s(f,m)),c})})})}else{let o=this;return me(function(...u){let c=o._def.args.safeParse(u,a);if(!c.success)throw new et([n(u,c.error)]);let d=Reflect.apply(i,this,c.data),f=o._def.returns.safeParse(d,a);if(!f.success)throw new et([s(d,f.error)]);return f.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new r(g(l({},this._def),{args:Kt.create(e).rest(yr.create())}))}returns(e){return new r(g(l({},this._def),{returns:e}))}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,n){return new r(l({args:e||Kt.create([]).rest(yr.create()),returns:t||yr.create(),typeName:E.ZodFunction},F(n)))}},sa=(()=>{class r extends H{get schema(){return this._def.getter()}_parse(t){let{ctx:n}=this._processInputParams(t);return this._def.getter()._parse({data:n.data,path:n.path,parent:n})}}return r.create=(e,t)=>new r(l({getter:e,typeName:E.ZodLazy},F(t))),r})(),aa=(()=>{class r extends H{_parse(t){if(t.data!==this._def.value){let n=this._getOrReturnCtx(t);return O(n,{received:n.data,code:x.invalid_literal,expected:this._def.value}),N}return{status:"valid",value:t.data}}get value(){return this._def.value}}return r.create=(e,t)=>new r(l({value:e,typeName:E.ZodLiteral},F(t))),r})();function Yo(r,e){return new An(l({values:r,typeName:E.ZodEnum},F(e)))}var An=(()=>{class r extends H{_parse(t){if(typeof t.data!="string"){let n=this._getOrReturnCtx(t),s=this._def.values;return O(n,{expected:V.joinValues(s),received:n.parsedType,code:x.invalid_type}),N}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(t.data)){let n=this._getOrReturnCtx(t),s=this._def.values;return O(n,{received:n.data,code:x.invalid_enum_value,options:s}),N}return me(t.data)}get options(){return this._def.values}get enum(){let t={};for(let n of this._def.values)t[n]=n;return t}get Values(){let t={};for(let n of this._def.values)t[n]=n;return t}get Enum(){let t={};for(let n of this._def.values)t[n]=n;return t}extract(t,n=this._def){return r.create(t,l(l({},this._def),n))}exclude(t,n=this._def){return r.create(this.options.filter(s=>!t.includes(s)),l(l({},this._def),n))}}return r.create=Yo,r})(),ia=(()=>{class r extends H{_parse(t){let n=V.getValidEnumValues(this._def.values),s=this._getOrReturnCtx(t);if(s.parsedType!==S.string&&s.parsedType!==S.number){let a=V.objectValues(n);return O(s,{expected:V.joinValues(a),received:s.parsedType,code:x.invalid_type}),N}if(this._cache||(this._cache=new Set(V.getValidEnumValues(this._def.values))),!this._cache.has(t.data)){let a=V.objectValues(n);return O(s,{received:s.data,code:x.invalid_enum_value,options:a}),N}return me(t.data)}get enum(){return this._def.values}}return r.create=(e,t)=>new r(l({values:e,typeName:E.ZodNativeEnum},F(t))),r})(),Rn=(()=>{class r extends H{unwrap(){return this._def.type}_parse(t){let{ctx:n}=this._processInputParams(t);if(n.parsedType!==S.promise&&n.common.async===!1)return O(n,{code:x.invalid_type,expected:S.promise,received:n.parsedType}),N;let s=n.parsedType===S.promise?n.data:Promise.resolve(n.data);return me(s.then(a=>this._def.type.parseAsync(a,{path:n.path,errorMap:n.common.contextualErrorMap})))}}return r.create=(e,t)=>new r(l({type:e,typeName:E.ZodPromise},F(t))),r})(),Xt=(()=>{class r extends H{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===E.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){let{status:n,ctx:s}=this._processInputParams(t),a=this._def.effect||null,i={addIssue:o=>{O(s,o),o.fatal?n.abort():n.dirty()},get path(){return s.path}};if(i.addIssue=i.addIssue.bind(i),a.type==="preprocess"){let o=a.transform(s.data,i);if(s.common.async)return Promise.resolve(o).then(u=>h(this,null,function*(){if(n.value==="aborted")return N;let c=yield this._def.schema._parseAsync({data:u,path:s.path,parent:s});return c.status==="aborted"?N:c.status==="dirty"?It(c.value):n.value==="dirty"?It(c.value):c}));{if(n.value==="aborted")return N;let u=this._def.schema._parseSync({data:o,path:s.path,parent:s});return u.status==="aborted"?N:u.status==="dirty"?It(u.value):n.value==="dirty"?It(u.value):u}}if(a.type==="refinement"){let o=u=>{let c=a.refinement(u,i);if(s.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return u};if(s.common.async===!1){let u=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});return u.status==="aborted"?N:(u.status==="dirty"&&n.dirty(),o(u.value),{status:n.value,value:u.value})}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(u=>u.status==="aborted"?N:(u.status==="dirty"&&n.dirty(),o(u.value).then(()=>({status:n.value,value:u.value}))))}if(a.type==="transform")if(s.common.async===!1){let o=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});if(!_t(o))return N;let u=a.transform(o.value,i);if(u instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:n.value,value:u}}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(o=>_t(o)?Promise.resolve(a.transform(o.value,i)).then(u=>({status:n.value,value:u})):N);V.assertNever(a)}}return r.create=(e,t,n)=>new r(l({schema:e,typeName:E.ZodEffects,effect:t},F(n))),r.createWithPreprocess=(e,t,n)=>new r(l({schema:t,effect:{type:"preprocess",transform:e},typeName:E.ZodEffects},F(n))),r})();var bt=(()=>{class r extends H{_parse(t){return this._getType(t)===S.undefined?me(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}return r.create=(e,t)=>new r(l({innerType:e,typeName:E.ZodOptional},F(t))),r})(),Yt=(()=>{class r extends H{_parse(t){return this._getType(t)===S.null?me(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}return r.create=(e,t)=>new r(l({innerType:e,typeName:E.ZodNullable},F(t))),r})(),oa=(()=>{class r extends H{_parse(t){let{ctx:n}=this._processInputParams(t),s=n.data;return n.parsedType===S.undefined&&(s=this._def.defaultValue()),this._def.innerType._parse({data:s,path:n.path,parent:n})}removeDefault(){return this._def.innerType}}return r.create=(e,t)=>new r(l({innerType:e,typeName:E.ZodDefault,defaultValue:typeof t.default=="function"?t.default:()=>t.default},F(t))),r})(),ua=(()=>{class r extends H{_parse(t){let{ctx:n}=this._processInputParams(t),s=g(l({},n),{common:g(l({},n.common),{issues:[]})}),a=this._def.innerType._parse({data:s.data,path:s.path,parent:l({},s)});return Gt(a)?a.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new et(s.common.issues)},input:s.data})})):{status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new et(s.common.issues)},input:s.data})}}removeCatch(){return this._def.innerType}}return r.create=(e,t)=>new r(l({innerType:e,typeName:E.ZodCatch,catchValue:typeof t.catch=="function"?t.catch:()=>t.catch},F(t))),r})(),Qo=(()=>{class r extends H{_parse(t){if(this._getType(t)!==S.nan){let s=this._getOrReturnCtx(t);return O(s,{code:x.invalid_type,expected:S.nan,received:s.parsedType}),N}return{status:"valid",value:t.data}}}return r.create=e=>new r(l({typeName:E.ZodNaN},F(e))),r})(),uh=Symbol("zod_brand"),br=class extends H{_parse(e){let{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}},wr=class r extends H{_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.common.async)return h(this,null,function*(){let a=yield this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?N:a.status==="dirty"?(t.dirty(),It(a.value)):this._def.out._parseAsync({data:a.value,path:n.path,parent:n})});{let s=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?N:s.status==="dirty"?(t.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:n.path,parent:n})}}static create(e,t){return new r({in:e,out:t,typeName:E.ZodPipeline})}},ca=(()=>{class r extends H{_parse(t){let n=this._def.innerType._parse(t),s=a=>(_t(a)&&(a.value=Object.freeze(a.value)),a);return Gt(n)?n.then(a=>s(a)):s(n)}unwrap(){return this._def.innerType}}return r.create=(e,t)=>new r(l({innerType:e,typeName:E.ZodReadonly},F(t))),r})();function zo(r,e){let t=typeof r=="function"?r(e):typeof r=="string"?{message:r}:r;return typeof t=="string"?{message:t}:t}function eu(r,e={},t){return r?xn.create().superRefine((n,s)=>{let a=r(n);if(a instanceof Promise)return a.then(i=>{if(!i){let o=zo(e,n),u=o.fatal??t??!0;s.addIssue(g(l({code:"custom"},o),{fatal:u}))}});if(!a){let i=zo(e,n),o=i.fatal??t??!0;s.addIssue(g(l({code:"custom"},i),{fatal:o}))}}):xn.create()}var ch={object:Wt.lazycreate},E=(function(r){return r.ZodString="ZodString",r.ZodNumber="ZodNumber",r.ZodNaN="ZodNaN",r.ZodBigInt="ZodBigInt",r.ZodBoolean="ZodBoolean",r.ZodDate="ZodDate",r.ZodSymbol="ZodSymbol",r.ZodUndefined="ZodUndefined",r.ZodNull="ZodNull",r.ZodAny="ZodAny",r.ZodUnknown="ZodUnknown",r.ZodNever="ZodNever",r.ZodVoid="ZodVoid",r.ZodArray="ZodArray",r.ZodObject="ZodObject",r.ZodUnion="ZodUnion",r.ZodDiscriminatedUnion="ZodDiscriminatedUnion",r.ZodIntersection="ZodIntersection",r.ZodTuple="ZodTuple",r.ZodRecord="ZodRecord",r.ZodMap="ZodMap",r.ZodSet="ZodSet",r.ZodFunction="ZodFunction",r.ZodLazy="ZodLazy",r.ZodLiteral="ZodLiteral",r.ZodEnum="ZodEnum",r.ZodEffects="ZodEffects",r.ZodNativeEnum="ZodNativeEnum",r.ZodOptional="ZodOptional",r.ZodNullable="ZodNullable",r.ZodDefault="ZodDefault",r.ZodCatch="ZodCatch",r.ZodPromise="ZodPromise",r.ZodBranded="ZodBranded",r.ZodPipeline="ZodPipeline",r.ZodReadonly="ZodReadonly",r})(E||{});var lh=(r,e={message:`Input not instance of ${r.name}`})=>eu(t=>t instanceof r,e),tu=Sn.create,ru=Ks.create,dh=Qo.create,fh=Xs.create,nu=Ys.create,hh=Qs.create,ph=Jo.create,mh=ea.create,gh=ta.create,yh=xn.create,_h=yr.create,bh=Nt.create,wh=Wo.create,vh=_r.create,xh=Wt.create,Eh=Wt.strictCreate,Oh=ra.create,Th=En.create,Sh=na.create,Ah=Kt.create,Rh=On.create,kh=Ko.create,Ch=Xo.create,Ph=Tn.create,Ih=sa.create,Nh=aa.create,$h=An.create,Lh=ia.create,jh=Rn.create,Dh=Xt.create,Mh=bt.create,Uh=Yt.create,Fh=Xt.createWithPreprocess,Bh=wr.create,qh=()=>tu().optional(),Hh=()=>ru().optional(),zh=()=>nu().optional(),Zh={string:r=>Sn.create(g(l({},r),{coerce:!0})),number:r=>Ks.create(g(l({},r),{coerce:!0})),boolean:r=>Ys.create(g(l({},r),{coerce:!0})),bigint:r=>Xs.create(g(l({},r),{coerce:!0})),date:r=>Qs.create(g(l({},r),{coerce:!0}))};var Vh=N;var pi=Re(ln(),1);var kn,Gh=new Uint8Array(16);function la(){if(!kn&&(kn=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!kn))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return kn(Gh)}var su=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Jh(r){return typeof r=="string"&&su.test(r)}var da=Jh;var le=[];for(let r=0;r<256;++r)le.push((r+256).toString(16).slice(1));function au(r,e=0){return le[r[e+0]]+le[r[e+1]]+le[r[e+2]]+le[r[e+3]]+"-"+le[r[e+4]]+le[r[e+5]]+"-"+le[r[e+6]]+le[r[e+7]]+"-"+le[r[e+8]]+le[r[e+9]]+"-"+le[r[e+10]]+le[r[e+11]]+le[r[e+12]]+le[r[e+13]]+le[r[e+14]]+le[r[e+15]]}var Wh=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),fa={randomUUID:Wh};function Kh(r,e,t){if(fa.randomUUID&&!e&&!r)return fa.randomUUID();r=r||{};let n=r.random||(r.rng||la)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){t=t||0;for(let s=0;s<16;++s)e[t+s]=n[s];return e}return au(n)}var Ne=Kh;var Yh=()=>typeof window<"u"&&typeof window.document<"u",Qh=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",ep=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),iu=()=>typeof Deno<"u",tp=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!iu(),rp=()=>{let r;return Yh()?r="browser":tp()?r="node":Qh()?r="webworker":ep()?r="jsdom":iu()?r="deno":r="other",r},ha;function ou(){return h(this,null,function*(){return ha===void 0&&(ha={library:"langchain-js",runtime:rp()}),ha})}function $e(r){try{return typeof process<"u"?process.env?.[r]:void 0}catch{return}}var pa=class{},$t=class r extends pa{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,Ns(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:$e("LANGCHAIN_CALLBACKS_BACKGROUND")!=="true"}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.awaitHandlers=e._awaitHandler??this.awaitHandlers)}copy(){return new this.constructor(this)}toJSON(){return Ue.prototype.toJSON.call(this)}toJSONNotImplemented(){return Ue.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class t extends r{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:Ne()}),Object.assign(this,e)}}return new t}};var ga=Re(du(),1);function ma(r,e){return r&&!Array.isArray(r)&&typeof r=="object"?r:{[e]:r}}function sp(r){return r.replace(/[-:.]/g,"")}function ap(r,e,t){let n=t.toFixed(0).slice(0,3).padStart(3,"0");return sp(`${new Date(r).toISOString().slice(0,-1)}${n}Z`)+e}var qe=class extends $t{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}stringifyError(e){return e instanceof Error?e.message+(e?.stack?`

${e.stack}`:""):typeof e=="string"?e:`${e}`}_addChildRun(e,t){e.child_runs.push(t)}_startTrace(e){return h(this,null,function*(){let t=ap(e.start_time,e.id,e.execution_order),n=l({},e);if(n.parent_run_id!==void 0){let s=this.runMap.get(n.parent_run_id);s&&(this._addChildRun(s,n),s.child_execution_order=Math.max(s.child_execution_order,n.child_execution_order),n.trace_id=s.trace_id,s.dotted_order!==void 0&&(n.dotted_order=[s.dotted_order,t].join(".")))}else n.trace_id=n.id,n.dotted_order=t;this.runMap.set(n.id,n),yield this.onRunCreate?.(n)})}_endTrace(e){return h(this,null,function*(){let t=e.parent_run_id!==void 0&&this.runMap.get(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):yield this.persistRun(e),this.runMap.delete(e.id),yield this.onRunUpdate?.(e)})}_getExecutionOrder(e){let t=e!==void 0&&this.runMap.get(e);return t?t.child_execution_order+1:1}handleLLMStart(e,t,n,s,a,i,o,u){return h(this,null,function*(){let c=this._getExecutionOrder(s),d=Date.now(),f=o?g(l({},a),{metadata:o}):a,p={id:n,name:u??e.id[e.id.length-1],parent_run_id:s,start_time:d,serialized:e,events:[{name:"start",time:new Date(d).toISOString()}],inputs:{prompts:t},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:f??{},tags:i||[]};return yield this._startTrace(p),yield this.onLLMStart?.(p),p})}handleChatModelStart(e,t,n,s,a,i,o,u){return h(this,null,function*(){let c=this._getExecutionOrder(s),d=Date.now(),f=o?g(l({},a),{metadata:o}):a,p={id:n,name:u??e.id[e.id.length-1],parent_run_id:s,start_time:d,serialized:e,events:[{name:"start",time:new Date(d).toISOString()}],inputs:{messages:t},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:f??{},tags:i||[]};return yield this._startTrace(p),yield this.onLLMStart?.(p),p})}handleLLMEnd(e,t){return h(this,null,function*(){let n=this.runMap.get(t);if(!n||n?.run_type!=="llm")throw new Error("No LLM run to end.");return n.end_time=Date.now(),n.outputs=e,n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),yield this.onLLMEnd?.(n),yield this._endTrace(n),n})}handleLLMError(e,t){return h(this,null,function*(){let n=this.runMap.get(t);if(!n||n?.run_type!=="llm")throw new Error("No LLM run to end.");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),yield this.onLLMError?.(n),yield this._endTrace(n),n})}handleChainStart(e,t,n,s,a,i,o,u){return h(this,null,function*(){let c=this._getExecutionOrder(s),d=Date.now(),f={id:n,name:u??e.id[e.id.length-1],parent_run_id:s,start_time:d,serialized:e,events:[{name:"start",time:new Date(d).toISOString()}],inputs:t,execution_order:c,child_execution_order:c,run_type:o??"chain",child_runs:[],extra:i?{metadata:i}:{},tags:a||[]};return yield this._startTrace(f),yield this.onChainStart?.(f),f})}handleChainEnd(e,t,n,s,a){return h(this,null,function*(){let i=this.runMap.get(t);if(!i)throw new Error("No chain run to end.");return i.end_time=Date.now(),i.outputs=ma(e,"output"),i.events.push({name:"end",time:new Date(i.end_time).toISOString()}),a?.inputs!==void 0&&(i.inputs=ma(a.inputs,"input")),yield this.onChainEnd?.(i),yield this._endTrace(i),i})}handleChainError(e,t,n,s,a){return h(this,null,function*(){let i=this.runMap.get(t);if(!i)throw new Error("No chain run to end.");return i.end_time=Date.now(),i.error=this.stringifyError(e),i.events.push({name:"error",time:new Date(i.end_time).toISOString()}),a?.inputs!==void 0&&(i.inputs=ma(a.inputs,"input")),yield this.onChainError?.(i),yield this._endTrace(i),i})}handleToolStart(e,t,n,s,a,i,o){return h(this,null,function*(){let u=this._getExecutionOrder(s),c=Date.now(),d={id:n,name:o??e.id[e.id.length-1],parent_run_id:s,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{input:t},execution_order:u,child_execution_order:u,run_type:"tool",child_runs:[],extra:i?{metadata:i}:{},tags:a||[]};return yield this._startTrace(d),yield this.onToolStart?.(d),d})}handleToolEnd(e,t){return h(this,null,function*(){let n=this.runMap.get(t);if(!n||n?.run_type!=="tool")throw new Error("No tool run to end");return n.end_time=Date.now(),n.outputs={output:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),yield this.onToolEnd?.(n),yield this._endTrace(n),n})}handleToolError(e,t){return h(this,null,function*(){let n=this.runMap.get(t);if(!n||n?.run_type!=="tool")throw new Error("No tool run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),yield this.onToolError?.(n),yield this._endTrace(n),n})}handleAgentAction(e,t){return h(this,null,function*(){let n=this.runMap.get(t);if(!n||n?.run_type!=="chain")return;let s=n;s.actions=s.actions||[],s.actions.push(e),s.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),yield this.onAgentAction?.(n)})}handleAgentEnd(e,t){return h(this,null,function*(){let n=this.runMap.get(t);!n||n?.run_type!=="chain"||(n.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),yield this.onAgentEnd?.(n))})}handleRetrieverStart(e,t,n,s,a,i,o){return h(this,null,function*(){let u=this._getExecutionOrder(s),c=Date.now(),d={id:n,name:o??e.id[e.id.length-1],parent_run_id:s,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{query:t},execution_order:u,child_execution_order:u,run_type:"retriever",child_runs:[],extra:i?{metadata:i}:{},tags:a||[]};return yield this._startTrace(d),yield this.onRetrieverStart?.(d),d})}handleRetrieverEnd(e,t){return h(this,null,function*(){let n=this.runMap.get(t);if(!n||n?.run_type!=="retriever")throw new Error("No retriever run to end");return n.end_time=Date.now(),n.outputs={documents:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),yield this.onRetrieverEnd?.(n),yield this._endTrace(n),n})}handleRetrieverError(e,t){return h(this,null,function*(){let n=this.runMap.get(t);if(!n||n?.run_type!=="retriever")throw new Error("No retriever run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),yield this.onRetrieverError?.(n),yield this._endTrace(n),n})}handleText(e,t){return h(this,null,function*(){let n=this.runMap.get(t);!n||n?.run_type!=="chain"||(n.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),yield this.onText?.(n))})}handleLLMNewToken(e,t,n,s,a,i){return h(this,null,function*(){let o=this.runMap.get(n);if(!o||o?.run_type!=="llm")throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return o.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:t,chunk:i?.chunk}}),yield this.onLLMNewToken?.(o,e,{chunk:i?.chunk}),o})}};function be(r,e){return`${r.open}${e}${r.close}`}function He(r,e){try{return JSON.stringify(r,null,2)}catch{return e}}function wt(r){if(!r.end_time)return"";let e=r.end_time-r.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}var{color:Te}=ga.default,xr=class extends qe{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){let t=[],n=e;for(;n.parent_run_id;){let s=this.runMap.get(n.parent_run_id);if(s)t.push(s),n=s;else break}return t}getBreadcrumbs(e){let n=[...this.getParents(e).reverse(),e].map((s,a,i)=>{let o=`${s.execution_order}:${s.run_type}:${s.name}`;return a===i.length-1?be(ga.default.bold,o):o}).join(" > ");return be(Te.grey,n)}onChainStart(e){let t=this.getBreadcrumbs(e);console.log(`${be(Te.green,"[chain/start]")} [${t}] Entering Chain run with input: ${He(e.inputs,"[inputs]")}`)}onChainEnd(e){let t=this.getBreadcrumbs(e);console.log(`${be(Te.cyan,"[chain/end]")} [${t}] [${wt(e)}] Exiting Chain run with output: ${He(e.outputs,"[outputs]")}`)}onChainError(e){let t=this.getBreadcrumbs(e);console.log(`${be(Te.red,"[chain/error]")} [${t}] [${wt(e)}] Chain run errored with error: ${He(e.error,"[error]")}`)}onLLMStart(e){let t=this.getBreadcrumbs(e),n="prompts"in e.inputs?{prompts:e.inputs.prompts.map(s=>s.trim())}:e.inputs;console.log(`${be(Te.green,"[llm/start]")} [${t}] Entering LLM run with input: ${He(n,"[inputs]")}`)}onLLMEnd(e){let t=this.getBreadcrumbs(e);console.log(`${be(Te.cyan,"[llm/end]")} [${t}] [${wt(e)}] Exiting LLM run with output: ${He(e.outputs,"[response]")}`)}onLLMError(e){let t=this.getBreadcrumbs(e);console.log(`${be(Te.red,"[llm/error]")} [${t}] [${wt(e)}] LLM run errored with error: ${He(e.error,"[error]")}`)}onToolStart(e){let t=this.getBreadcrumbs(e);console.log(`${be(Te.green,"[tool/start]")} [${t}] Entering Tool run with input: "${e.inputs.input?.trim()}"`)}onToolEnd(e){let t=this.getBreadcrumbs(e);console.log(`${be(Te.cyan,"[tool/end]")} [${t}] [${wt(e)}] Exiting Tool run with output: "${e.outputs?.output?.trim()}"`)}onToolError(e){let t=this.getBreadcrumbs(e);console.log(`${be(Te.red,"[tool/error]")} [${t}] [${wt(e)}] Tool run errored with error: ${He(e.error,"[error]")}`)}onRetrieverStart(e){let t=this.getBreadcrumbs(e);console.log(`${be(Te.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${He(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){let t=this.getBreadcrumbs(e);console.log(`${be(Te.cyan,"[retriever/end]")} [${t}] [${wt(e)}] Exiting Retriever run with output: ${He(e.outputs,"[outputs]")}`)}onRetrieverError(e){let t=this.getBreadcrumbs(e);console.log(`${be(Te.red,"[retriever/error]")} [${t}] [${wt(e)}] Retriever run errored with error: ${He(e.error,"[error]")}`)}onAgentAction(e){let t=e,n=this.getBreadcrumbs(e);console.log(`${be(Te.blue,"[agent/action]")} [${n}] Agent selected action: ${He(t.actions[t.actions.length-1],"[action]")}`)}};var fu=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function ip(r){return typeof r=="string"&&fu.test(r)}var ya=ip;var de=[];for(Cn=0;Cn<256;++Cn)de.push((Cn+256).toString(16).slice(1));var Cn;function hu(r,e=0){return(de[r[e+0]]+de[r[e+1]]+de[r[e+2]]+de[r[e+3]]+"-"+de[r[e+4]]+de[r[e+5]]+"-"+de[r[e+6]]+de[r[e+7]]+"-"+de[r[e+8]]+de[r[e+9]]+"-"+de[r[e+10]]+de[r[e+11]]+de[r[e+12]]+de[r[e+13]]+de[r[e+14]]+de[r[e+15]]).toLowerCase()}var Pn,op=new Uint8Array(16);function _a(){if(!Pn&&(Pn=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Pn))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Pn(op)}var up=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ba={randomUUID:up};function cp(r,e,t){if(ba.randomUUID&&!e&&!r)return ba.randomUUID();r=r||{};var n=r.random||(r.rng||_a)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){t=t||0;for(var s=0;s<16;++s)e[t+s]=n[s];return e}return hu(n)}var Lt=cp;var pu=Re(ln(),1),In=Re(mn(),1);var lp=(...r)=>fetch(...r),dp=Symbol.for("ls:fetch_implementation");var I=()=>globalThis[dp]??lp;var fp=[400,401,403,404,405,406,407,408],hp=[409],Er=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,"default"in In.default?this.queue=new In.default.default({concurrency:this.maxConcurrency}):this.queue=new In.default({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e?.onFailedResponseHook}call(e,...t){let n=this.onFailedResponseHook;return this.queue.add(()=>(0,pu.default)(()=>e(...t).catch(a=>{throw a instanceof Error?a:new Error(a)}),{onFailedAttempt(a){return h(this,null,function*(){if(a.message.startsWith("Cancel")||a.message.startsWith("TimeoutError")||a.message.startsWith("AbortError")||a?.code==="ECONNABORTED")throw a;let i=a?.response,o=i?.status;if(o){if(fp.includes(+o))throw a;if(hp.includes(+o))return;n&&(yield n(i))}})},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...n){return e.signal?Promise.race([this.call(t,...n),new Promise((s,a)=>{e.signal?.addEventListener("abort",()=>{a(new Error("AbortError"))})})]):this.call(t,...n)}fetch(...e){return this.call(()=>I()(...e).then(t=>t.ok?t:Promise.reject(t)))}};function va(r){return typeof r?._getType=="function"}function xa(r){let e={type:r._getType(),data:{content:r.content}};return r?.additional_kwargs&&Object.keys(r.additional_kwargs).length>0&&(e.data.additional_kwargs=l({},r.additional_kwargs)),e}var ct,pp=()=>typeof window<"u"&&typeof window.document<"u",mp=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",gp=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),mu=()=>typeof Deno<"u",yp=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!mu(),_p=()=>ct||(pp()?ct="browser":yp()?ct="node":mp()?ct="webworker":gp()?ct="jsdom":mu()?ct="deno":ct="other",ct),Ea;function Nn(){if(Ea===void 0){let r=_p(),e=wp();Ea=l({library:"langsmith",runtime:r,sdk:"langsmith-js",sdk_version:$n},e)}return Ea}function gu(){let r=bp()||{},e={},t=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION"];for(let[n,s]of Object.entries(r))n.startsWith("LANGCHAIN_")&&typeof s=="string"&&!t.includes(n)&&!n.toLowerCase().includes("key")&&!n.toLowerCase().includes("secret")&&!n.toLowerCase().includes("token")&&(n==="LANGCHAIN_REVISION_ID"?e.revision_id=s:e[n]=s);return e}function bp(){try{return typeof process<"u"&&process.env?Object.entries(process.env).reduce((r,[e,t])=>(r[e]=String(t),r),{}):void 0}catch{return}}function vt(r){try{return typeof process<"u"?process.env?.[r]:void 0}catch{return}}function lt(r){return vt(`LANGSMITH_${r}`)||vt(`LANGCHAIN_${r}`)}var Oa;function wp(){if(Oa!==void 0)return Oa;let r=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],e={};for(let t of r){let n=vt(t);n!==void 0&&(e[t]=n)}return Oa=e,e}function G(r,e){if(!ya(r)){let t=e!==void 0?`Invalid UUID for ${e}: ${r}`:`Invalid UUID: ${r}`;throw new Error(t)}return r}var yu={};function Ln(r){yu[r]||(console.warn(r),yu[r]=!0)}var Ha=Re(il(),1);function ol(r,e){let t=(0,Ha.parse)(r),n=(0,Ha.parse)(e);if(!t||!n)throw new Error("Invalid version format.");return t.compare(n)>=0}function dt(r){if(!r||r.split("/").length>2||r.startsWith("/")||r.endsWith("/")||r.split(":").length>2)throw new Error(`Invalid identifier format: ${r}`);let[e,t]=r.split(":"),n=t||"latest";if(e.includes("/")){let[s,a]=e.split("/",2);if(!s||!a)throw new Error(`Invalid identifier format: ${r}`);return[s,a,n]}else{if(!e)throw new Error(`Invalid identifier format: ${r}`);return["-",e,n]}}var za=class extends Error{constructor(e){super(e),this.name="LangSmithConflictError"}};function Z(r,e,t){return h(this,null,function*(){let n;if(r.ok){t&&(n=yield r.text());return}n=yield r.text();let s=`Failed to ${e}. Received status [${r.status}]: ${r.statusText}. Server response: ${n}`;throw r.status===409?new za(s):new Error(s)})}var ul="[...]",gy={result:"[Circular]"},Jn=[],tr=[];function yy(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function Dt(r,e,t,n){try{return JSON.stringify(r,e,t)}catch(i){if(!i.message?.includes("Converting circular structure to JSON"))return console.warn("[WARNING]: LangSmith received unserializable value."),"[Unserializable]";console.warn("[WARNING]: LangSmith received circular JSON. This will decrease tracer performance."),typeof n>"u"&&(n=yy()),Va(r,"",0,[],void 0,0,n);var s;try{tr.length===0?s=JSON.stringify(r,e,t):s=JSON.stringify(r,_y(e),t)}catch{return JSON.stringify("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;Jn.length!==0;){var a=Jn.pop();a.length===4?Object.defineProperty(a[0],a[1],a[3]):a[0][a[1]]=a[2]}}return s}}function Za(r,e,t,n){var s=Object.getOwnPropertyDescriptor(n,t);s.get!==void 0?s.configurable?(Object.defineProperty(n,t,{value:r}),Jn.push([n,t,e,s])):tr.push([e,t,r]):(n[t]=r,Jn.push([n,t,e]))}function Va(r,e,t,n,s,a,i){a+=1;var o;if(typeof r=="object"&&r!==null){for(o=0;o<n.length;o++)if(n[o]===r){Za(gy,r,e,s);return}if(typeof i.depthLimit<"u"&&a>i.depthLimit){Za(ul,r,e,s);return}if(typeof i.edgesLimit<"u"&&t+1>i.edgesLimit){Za(ul,r,e,s);return}if(n.push(r),Array.isArray(r))for(o=0;o<r.length;o++)Va(r[o],o,o,n,r,a,i);else{var u=Object.keys(r);for(o=0;o<u.length;o++){var c=u[o];Va(r[c],c,o,n,r,a,i)}}n.pop()}}function _y(r){return r=typeof r<"u"?r:function(e,t){return t},function(e,t){if(tr.length>0)for(var n=0;n<tr.length;n++){var s=tr[n];if(s[1]===e&&s[0]===t){t=s[2],tr.splice(n,1);break}}return r.call(this,e,t)}}function cl(r){let e=Nn(),t=gu(),n=r.extra??{},s=n.metadata;return r.extra=g(l({},n),{runtime:l(l({},e),n?.runtime),metadata:l(l(l({},t),t.revision_id||r.revision_id?{revision_id:r.revision_id??t.revision_id}:{}),s)}),r}var by=()=>{let r=lt("TRACING_SAMPLING_RATE");if(r===void 0)return;let e=parseFloat(r);if(e<0||e>1)throw new Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${e}`);return e},wy=r=>{let t=r.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return t==="localhost"||t==="127.0.0.1"||t==="::1"};function vy(r){return h(this,null,function*(){let e=[];try{for(var t=z(r),n,s,a;n=!(s=yield t.next()).done;n=!1){let i=s.value;e.push(i)}}catch{a=[s]}finally{try{n&&(s=t.return)&&(yield s.call(t))}finally{if(a)throw a[0]}}return e})}function Ga(r){if(r!==void 0)return r.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}var xy=r=>h(null,null,function*(){if(r?.status===429){let e=parseInt(r.headers.get("retry-after")??"30",10)*1e3;if(e>0)return yield new Promise(t=>setTimeout(t,e)),!0}return!1}),Ja=class{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0})}peek(){return this.items[0]}push(e){let t,n=new Promise(a=>{t=a}),s=Dt(e.item).length;return this.items.push({action:e.action,payload:e.item,itemPromiseResolve:t,itemPromise:n,size:s}),this.sizeBytes+=s,n}pop(e){if(e<1)throw new Error("Number of bytes to pop off may not be less than 1.");let t=[],n=0;for(;n+(this.peek()?.size??0)<e&&this.items.length>0;){let s=this.items.shift();s&&(t.push(s),n+=s.size,this.sizeBytes-=s.size)}if(t.length===0&&this.items.length>0){let s=this.items.shift();t.push(s),n+=s.size,this.sizeBytes-=s.size}return[t.map(s=>({action:s.action,item:s.payload})),()=>t.forEach(s=>s.itemPromiseResolve())]}},Ey=20971520,Oy=1e3,Mt=class r{constructor(e={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new Ja}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchInitialDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:50}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let t=r.getDefaultClientConfig();this.tracingSampleRate=by(),this.apiUrl=Ga(e.apiUrl??t.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=Ga(e.apiKey??t.apiKey),this.webUrl=Ga(e.webUrl??t.webUrl),this.webUrl?.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.timeout_ms=e.timeout_ms??12e3,this.caller=new Er(e.callerOptions??{}),this.batchIngestCaller=new Er(g(l({},e.callerOptions??{}),{onFailedResponseHook:xy})),this.hideInputs=e.hideInputs??e.anonymizer??t.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??t.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.blockOnRootRunFinalization=e.blockOnRootRunFinalization??this.blockOnRootRunFinalization,this.batchSizeBytesLimit=e.batchSizeBytesLimit,this.fetchOptions=e.fetchOptions||{}}static getDefaultClientConfig(){let e=lt("API_KEY"),t=lt("ENDPOINT")??"https://api.smith.langchain.com",n=lt("HIDE_INPUTS")==="true",s=lt("HIDE_OUTPUTS")==="true";return{apiUrl:t,apiKey:e,webUrl:void 0,hideInputs:n,hideOutputs:s}}getHostUrl(){return this.webUrl?this.webUrl:wy(this.apiUrl)?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("eu")?(this.webUrl="https://eu.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){let e={"User-Agent":`langsmith-js/${$n}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}processInputs(e){return this.hideInputs===!1?e:this.hideInputs===!0?{}:typeof this.hideInputs=="function"?this.hideInputs(e):e}processOutputs(e){return this.hideOutputs===!1?e:this.hideOutputs===!0?{}:typeof this.hideOutputs=="function"?this.hideOutputs(e):e}prepareRunCreateOrUpdateInputs(e){let t=l({},e);return t.inputs!==void 0&&(t.inputs=this.processInputs(t.inputs)),t.outputs!==void 0&&(t.outputs=this.processOutputs(t.outputs)),t}_getResponse(e,t){return h(this,null,function*(){let n=t?.toString()??"",s=`${this.apiUrl}${e}?${n}`,a=yield this.caller.call(I(),s,l({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield Z(a,`Failed to fetch ${e}`),a})}_get(e,t){return h(this,null,function*(){return(yield this._getResponse(e,t)).json()})}_getPaginated(s){return j(this,arguments,function*(e,t=new URLSearchParams,n){let a=Number(t.get("offset"))||0,i=Number(t.get("limit"))||100;for(;;){t.set("offset",String(a)),t.set("limit",String(i));let o=`${this.apiUrl}${e}?${t}`,u=yield new v(this.caller.call(I(),o,l({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions)));yield new v(Z(u,`Failed to fetch ${e}`));let c=n?n(yield new v(u.json())):yield new v(u.json());if(c.length===0||(yield c,c.length<i))break;a+=c.length}})}_getCursorPaginatedList(e,t=null,n="POST",s="runs"){return j(this,null,function*(){let a=t?l({},t):{};for(;;){let i=yield new v(this.caller.call(I(),`${this.apiUrl}${e}`,g(l({method:n,headers:g(l({},this.headers),{"Content-Type":"application/json"}),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions),{body:JSON.stringify(a)}))),o=yield new v(i.json());if(!o||!o[s])break;yield o[s];let u=o.cursors;if(!u||!u.next)break;a.cursor=u.next}})}_filterForSampling(e,t=!1){if(this.tracingSampleRate===void 0)return e;if(t){let n=[];for(let s of e)this.filteredPostUuids.has(s.id)?this.filteredPostUuids.delete(s.id):n.push(s);return n}else{let n=[];for(let s of e)s.id!==s.trace_id&&!this.filteredPostUuids.has(s.trace_id)||Math.random()<this.tracingSampleRate?n.push(s):this.filteredPostUuids.add(s.id);return n}}_getBatchSizeLimitBytes(){return h(this,null,function*(){let e=yield this._ensureServerInfo();return this.batchSizeBytesLimit??e.batch_ingest_config?.size_limit_bytes??Ey})}drainAutoBatchQueue(){return h(this,null,function*(){for(;this.autoBatchQueue.items.length>=0;){let[e,t]=this.autoBatchQueue.pop(yield this._getBatchSizeLimitBytes());if(!e.length){t();return}try{let n={runCreates:e.filter(a=>a.action==="create").map(a=>a.item),runUpdates:e.filter(a=>a.action==="update").map(a=>a.item)};(yield this._ensureServerInfo())?.batch_ingest_config?.use_multipart_endpoint?yield this.multipartIngestRuns(n):yield this.batchIngestRuns(n)}finally{t()}}})}processRunOperation(e,t){return h(this,null,function*(){let n=this.autoBatchTimeout;clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,e.action==="create"&&(e.item=cl(e.item));let s=this.autoBatchQueue.push(e),a=yield this._getBatchSizeLimitBytes();return(t||this.autoBatchQueue.sizeBytes>a)&&(yield this.drainAutoBatchQueue().catch(console.error)),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue().catch(console.error)},n?this.autoBatchAggregationDelayMs:this.autoBatchInitialDelayMs)),s})}_getServerInfo(){return h(this,null,function*(){let e=yield I()(`${this.apiUrl}/info`,l({method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(Oy)},this.fetchOptions));return yield Z(e,"get server info"),e.json()})}_ensureServerInfo(){return h(this,null,function*(){return this._getServerInfoPromise===void 0&&(this._getServerInfoPromise=h(this,null,function*(){if(this._serverInfo===void 0)try{this._serverInfo=yield this._getServerInfo()}catch{console.warn("[WARNING]: LangSmith failed to fetch info on supported operations. Falling back to single calls and default limits.")}return this._serverInfo??{}})),this._getServerInfoPromise.then(e=>(this._serverInfo===void 0&&(this._getServerInfoPromise=void 0),e))})}_getSettings(){return h(this,null,function*(){return this.settings||(this.settings=this._get("/settings")),yield this.settings})}createRun(e){return h(this,null,function*(){if(!this._filterForSampling([e]).length)return;let t=g(l({},this.headers),{"Content-Type":"application/json"}),n=e.project_name;delete e.project_name;let s=this.prepareRunCreateOrUpdateInputs(g(l({session_name:n},e),{start_time:e.start_time??Date.now()}));if(this.autoBatchTracing&&s.trace_id!==void 0&&s.dotted_order!==void 0){this.processRunOperation({action:"create",item:s}).catch(console.error);return}let a=cl(s),i=yield this.caller.call(I(),`${this.apiUrl}/runs`,l({method:"POST",headers:t,body:Dt(a),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield Z(i,"create run",!0)})}batchIngestRuns(n){return h(this,arguments,function*({runCreates:e,runUpdates:t}){if(e===void 0&&t===void 0)return;let s=e?.map(c=>this.prepareRunCreateOrUpdateInputs(c))??[],a=t?.map(c=>this.prepareRunCreateOrUpdateInputs(c))??[];if(s.length>0&&a.length>0){let c=s.reduce((f,p)=>(p.id&&(f[p.id]=p),f),{}),d=[];for(let f of a)f.id!==void 0&&c[f.id]?c[f.id]=l(l({},c[f.id]),f):d.push(f);s=Object.values(c),a=d}let i={post:this._filterForSampling(s),patch:this._filterForSampling(a,!0)};if(!i.post.length&&!i.patch.length)return;if((yield this._ensureServerInfo()).version===void 0){this.autoBatchTracing=!1;for(let c of i.post)yield this.createRun(c);for(let c of i.patch)c.id!==void 0&&(yield this.updateRun(c.id,c));return}let u={post:[],patch:[]};for(let c of["post","patch"]){let d=c,f=i[d].reverse(),p=f.pop();for(;p!==void 0;)u[d].push(p),p=f.pop()}(u.post.length>0||u.patch.length>0)&&(yield this._postBatchIngestRuns(Dt(u)))})}_postBatchIngestRuns(e){return h(this,null,function*(){let t=g(l({},this.headers),{"Content-Type":"application/json",Accept:"application/json"}),n=yield this.batchIngestCaller.call(I(),`${this.apiUrl}/runs/batch`,l({method:"POST",headers:t,body:e,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield Z(n,"batch create run",!0)})}multipartIngestRuns(n){return h(this,arguments,function*({runCreates:e,runUpdates:t}){if(e===void 0&&t===void 0)return;let s={},a=[];for(let p of e??[]){let m=this.prepareRunCreateOrUpdateInputs(p);m.id!==void 0&&m.attachments!==void 0&&(s[m.id]=m.attachments),delete m.attachments,a.push(m)}let i=[];for(let p of t??[])i.push(this.prepareRunCreateOrUpdateInputs(p));if(a.find(p=>p.trace_id===void 0||p.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(i.find(p=>p.trace_id===void 0||p.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(a.length>0&&i.length>0){let p=a.reduce((_,w)=>(w.id&&(_[w.id]=w),_),{}),m=[];for(let _ of i)_.id!==void 0&&p[_.id]?p[_.id]=l(l({},p[_.id]),_):m.push(_);a=Object.values(p),i=m}if(a.length===0&&i.length===0)return;let c=[],d=[];for(let[p,m]of[["post",a],["patch",i]])for(let _ of m){let f=_,{inputs:w,outputs:b,events:T}=f,A=he(f,["inputs","outputs","events"]),M={inputs:w,outputs:b,events:T},$=Dt(A);d.push({name:`${p}.${A.id}`,payload:new Blob([$],{type:`application/json; length=${$.length}`})});for(let[B,K]of Object.entries(M)){if(K===void 0)continue;let W=Dt(K);d.push({name:`${p}.${A.id}.${B}`,payload:new Blob([W],{type:`application/json; length=${W.length}`})})}if(A.id!==void 0){let B=s[A.id];if(B){delete s[A.id];for(let[K,[W,ae]]of Object.entries(B))d.push({name:`attachment.${A.id}.${K}`,payload:new Blob([ae],{type:`${W}; length=${ae.length}`})})}}c.push(`trace=${A.trace_id},id=${A.id}`)}yield this._sendMultipartRequest(d,c.join("; "))})}_sendMultipartRequest(e,t){return h(this,null,function*(){try{let n=new FormData;for(let s of e)n.append(s.name,s.payload);yield this.batchIngestCaller.call(I(),`${this.apiUrl}/runs/multipart`,l({method:"POST",headers:l({},this.headers),body:n,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions))}catch(n){let s="Failed to multipart ingest runs";n instanceof Error?s+=`: ${n.stack||n.message}`:s+=`: ${String(n)}`,console.warn(`${s.trim()}

Context: ${t}`)}})}updateRun(e,t){return h(this,null,function*(){G(e),t.inputs&&(t.inputs=this.processInputs(t.inputs)),t.outputs&&(t.outputs=this.processOutputs(t.outputs));let n=g(l({},t),{id:e});if(!this._filterForSampling([n],!0).length)return;if(this.autoBatchTracing&&n.trace_id!==void 0&&n.dotted_order!==void 0){if(t.end_time!==void 0&&n.parent_run_id===void 0&&this.blockOnRootRunFinalization){yield this.processRunOperation({action:"update",item:n},!0);return}else this.processRunOperation({action:"update",item:n}).catch(console.error);return}let s=g(l({},this.headers),{"Content-Type":"application/json"}),a=yield this.caller.call(I(),`${this.apiUrl}/runs/${e}`,l({method:"PATCH",headers:s,body:Dt(t),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield Z(a,"update run",!0)})}readRun(n){return h(this,arguments,function*(e,{loadChildRuns:t}={loadChildRuns:!1}){G(e);let s=yield this._get(`/runs/${e}`);return t&&s.child_run_ids&&(s=yield this._loadChildRuns(s)),s})}getRunUrl(s){return h(this,arguments,function*({runId:e,run:t,projectOpts:n}){if(t!==void 0){let a;t.session_id?a=t.session_id:n?.projectName?a=(yield this.readProject({projectName:n?.projectName})).id:n?.projectId?a=n?.projectId:a=(yield this.readProject({projectName:lt("PROJECT")||"default"})).id;let i=yield this._getTenantId();return`${this.getHostUrl()}/o/${i}/projects/p/${a}/r/${t.id}?poll=true`}else if(e!==void 0){let a=yield this.readRun(e);if(!a.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${a.app_path}`}else throw new Error("Must provide either runId or run")})}_loadChildRuns(e){return h(this,null,function*(){let t=yield vy(this.listRuns({id:e.child_run_ids})),n={},s={};t.sort((a,i)=>(a?.dotted_order??"").localeCompare(i?.dotted_order??""));for(let a of t){if(a.parent_run_id===null||a.parent_run_id===void 0)throw new Error(`Child run ${a.id} has no parent`);a.parent_run_id in n||(n[a.parent_run_id]=[]),n[a.parent_run_id].push(a),s[a.id]=a}e.child_runs=n[e.id]||[];for(let a in n)a!==e.id&&(s[a].child_runs=n[a]);return e})}listRuns(e){return j(this,null,function*(){let{projectId:t,projectName:n,parentRunId:s,traceId:a,referenceExampleId:i,startTime:o,executionOrder:u,isRoot:c,runType:d,error:f,id:p,query:m,filter:_,traceFilter:w,treeFilter:b,limit:T,select:A}=e,M=[];if(t&&(M=Array.isArray(t)?t:[t]),n){let We=Array.isArray(n)?n:[n],pt=yield new v(Promise.all(We.map(St=>this.readProject({projectName:St}).then(st=>st.id))));M.push(...pt)}let $=["app_path","child_run_ids","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],B={session:M.length?M:null,run_type:d,reference_example:i,query:m,filter:_,trace_filter:w,tree_filter:b,execution_order:u,parent_run:s,start_time:o?o.toISOString():null,error:f,id:p,limit:T,trace:a,select:A||$,is_root:c},K=0;try{for(var W=z(this._getCursorPaginatedList("/runs/query",B)),ae,ne,hr;ae=!(ne=yield new v(W.next())).done;ae=!1){let We=ne.value;if(T){if(K>=T)break;if(We.length+K>T){let pt=We.slice(0,T-K);yield*ee(pt);break}K+=We.length,yield*ee(We)}else yield*ee(We)}}catch{hr=[ne]}finally{try{ae&&(ne=W.return)&&(yield new v(ne.call(W)))}finally{if(hr)throw hr[0]}}})}getRunStats(T){return h(this,arguments,function*({id:e,trace:t,parentRun:n,runType:s,projectNames:a,projectIds:i,referenceExampleIds:o,startTime:u,endTime:c,error:d,query:f,filter:p,traceFilter:m,treeFilter:_,isRoot:w,dataSourceType:b}){let A=i||[];a&&(A=[...i||[],...yield Promise.all(a.map(W=>this.readProject({projectName:W}).then(ae=>ae.id)))]);let $=Object.fromEntries(Object.entries({id:e,trace:t,parent_run:n,run_type:s,session:A,reference_example:o,start_time:u,end_time:c,error:d,query:f,filter:p,trace_filter:m,tree_filter:_,is_root:w,data_source_type:b}).filter(([W,ae])=>ae!==void 0));return yield(yield this.caller.call(I(),`${this.apiUrl}/runs/stats`,l({method:"POST",headers:this.headers,body:JSON.stringify($),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions))).json()})}shareRun(n){return h(this,arguments,function*(e,{shareId:t}={}){let s={run_id:e,share_token:t||Lt()};G(e);let i=yield(yield this.caller.call(I(),`${this.apiUrl}/runs/${e}/share`,l({method:"PUT",headers:this.headers,body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions))).json();if(i===null||!("share_token"in i))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${i.share_token}/r`})}unshareRun(e){return h(this,null,function*(){G(e);let t=yield this.caller.call(I(),`${this.apiUrl}/runs/${e}/share`,l({method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield Z(t,"unshare run",!0)})}readRunSharedLink(e){return h(this,null,function*(){G(e);let n=yield(yield this.caller.call(I(),`${this.apiUrl}/runs/${e}/share`,l({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions))).json();if(!(n===null||!("share_token"in n)))return`${this.getHostUrl()}/public/${n.share_token}/r`})}listSharedRuns(n){return h(this,arguments,function*(e,{runIds:t}={}){let s=new URLSearchParams({share_token:e});if(t!==void 0)for(let o of t)s.append("id",o);return G(e),yield(yield this.caller.call(I(),`${this.apiUrl}/public/${e}/runs${s}`,l({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions))).json()})}readDatasetSharedSchema(e,t){return h(this,null,function*(){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(yield this.readDataset({datasetName:t})).id),G(e);let s=yield(yield this.caller.call(I(),`${this.apiUrl}/datasets/${e}/share`,l({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions))).json();return s.url=`${this.getHostUrl()}/public/${s.share_token}/d`,s})}shareDataset(e,t){return h(this,null,function*(){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(yield this.readDataset({datasetName:t})).id);let n={dataset_id:e};G(e);let a=yield(yield this.caller.call(I(),`${this.apiUrl}/datasets/${e}/share`,l({method:"PUT",headers:this.headers,body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions))).json();return a.url=`${this.getHostUrl()}/public/${a.share_token}/d`,a})}unshareDataset(e){return h(this,null,function*(){G(e);let t=yield this.caller.call(I(),`${this.apiUrl}/datasets/${e}/share`,l({method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield Z(t,"unshare dataset",!0)})}readSharedDataset(e){return h(this,null,function*(){return G(e),yield(yield this.caller.call(I(),`${this.apiUrl}/public/${e}/datasets`,l({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions))).json()})}listSharedExamples(e,t){return h(this,null,function*(){let n={};t?.exampleIds&&(n.id=t.exampleIds);let s=new URLSearchParams;Object.entries(n).forEach(([o,u])=>{Array.isArray(u)?u.forEach(c=>s.append(o,c)):s.append(o,u)});let a=yield this.caller.call(I(),`${this.apiUrl}/public/${e}/examples?${s.toString()}`,l({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions)),i=yield a.json();if(!a.ok)throw"detail"in i?new Error(`Failed to list shared examples.
Status: ${a.status}
Message: ${i.detail.join(`
`)}`):new Error(`Failed to list shared examples: ${a.status} ${a.statusText}`);return i.map(o=>g(l({},o),{_hostUrl:this.getHostUrl()}))})}createProject(o){return h(this,arguments,function*({projectName:e,description:t=null,metadata:n=null,upsert:s=!1,projectExtra:a=null,referenceDatasetId:i=null}){let u=s?"?upsert=true":"",c=`${this.apiUrl}/sessions${u}`,d=a||{};n&&(d.metadata=n);let f={name:e,extra:d,description:t};i!==null&&(f.reference_dataset_id=i);let p=yield this.caller.call(I(),c,l({method:"POST",headers:g(l({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(f),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield Z(p,"create project"),yield p.json()})}updateProject(o,u){return h(this,arguments,function*(e,{name:t=null,description:n=null,metadata:s=null,projectExtra:a=null,endTime:i=null}){let c=`${this.apiUrl}/sessions/${e}`,d=a;s&&(d=g(l({},d||{}),{metadata:s}));let f={name:t,extra:d,description:n,end_time:i?new Date(i).toISOString():null},p=yield this.caller.call(I(),c,l({method:"PATCH",headers:g(l({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(f),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield Z(p,"update project"),yield p.json()})}hasProject(n){return h(this,arguments,function*({projectId:e,projectName:t}){let s="/sessions",a=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)G(e),s+=`/${e}`;else if(t!==void 0)a.append("name",t);else throw new Error("Must provide projectName or projectId");let i=yield this.caller.call(I(),`${this.apiUrl}${s}?${a}`,l({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));try{let o=yield i.json();return i.ok?Array.isArray(o)?o.length>0:!0:!1}catch{return!1}})}readProject(s){return h(this,arguments,function*({projectId:e,projectName:t,includeStats:n}){let a="/sessions",i=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)G(e),a+=`/${e}`;else if(t!==void 0)i.append("name",t);else throw new Error("Must provide projectName or projectId");n!==void 0&&i.append("include_stats",n.toString());let o=yield this._get(a,i),u;if(Array.isArray(o)){if(o.length===0)throw new Error(`Project[id=${e}, name=${t}] not found`);u=o[0]}else u=o;return u})}getProjectUrl(n){return h(this,arguments,function*({projectId:e,projectName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either projectName or projectId");let s=yield this.readProject({projectId:e,projectName:t}),a=yield this._getTenantId();return`${this.getHostUrl()}/o/${a}/projects/p/${s.id}`})}getDatasetUrl(n){return h(this,arguments,function*({datasetId:e,datasetName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");let s=yield this.readDataset({datasetId:e,datasetName:t}),a=yield this._getTenantId();return`${this.getHostUrl()}/o/${a}/datasets/${s.id}`})}_getTenantId(){return h(this,null,function*(){if(this._tenantId!==null)return this._tenantId;let e=new URLSearchParams({limit:"1"});try{for(var t=z(this._getPaginated("/sessions",e)),n,s,a;n=!(s=yield t.next()).done;n=!1){let i=s.value;return this._tenantId=i[0].tenant_id,i[0].tenant_id}}catch{a=[s]}finally{try{n&&(s=t.return)&&(yield s.call(t))}finally{if(a)throw a[0]}}throw new Error("No projects found to resolve tenant.")})}listProjects(){return j(this,arguments,function*({projectIds:e,name:t,nameContains:n,referenceDatasetId:s,referenceDatasetName:a,referenceFree:i,metadata:o}={}){let u=new URLSearchParams;if(e!==void 0)for(let m of e)u.append("id",m);if(t!==void 0&&u.append("name",t),n!==void 0&&u.append("name_contains",n),s!==void 0)u.append("reference_dataset",s);else if(a!==void 0){let m=yield new v(this.readDataset({datasetName:a}));u.append("reference_dataset",m.id)}i!==void 0&&u.append("reference_free",i.toString()),o!==void 0&&u.append("metadata",JSON.stringify(o));try{for(var c=z(this._getPaginated("/sessions",u)),d,f,p;d=!(f=yield new v(c.next())).done;d=!1){let m=f.value;yield*ee(m)}}catch{p=[f]}finally{try{d&&(f=c.return)&&(yield new v(f.call(c)))}finally{if(p)throw p[0]}}})}deleteProject(n){return h(this,arguments,function*({projectId:e,projectName:t}){let s;if(e===void 0&&t===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?s=(yield this.readProject({projectName:t})).id:s=e,G(s);let a=yield this.caller.call(I(),`${this.apiUrl}/sessions/${s}`,l({method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield Z(a,`delete session ${s} (${t})`,!0)})}uploadCsv(u){return h(this,arguments,function*({csvFile:e,fileName:t,inputKeys:n,outputKeys:s,description:a,dataType:i,name:o}){let c=`${this.apiUrl}/datasets/upload`,d=new FormData;d.append("file",e,t),n.forEach(m=>{d.append("input_keys",m)}),s.forEach(m=>{d.append("output_keys",m)}),a&&d.append("description",a),i&&d.append("data_type",i),o&&d.append("name",o);let f=yield this.caller.call(I(),c,l({method:"POST",headers:this.headers,body:d,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield Z(f,"upload CSV"),yield f.json()})}createDataset(o){return h(this,arguments,function*(e,{description:t,dataType:n,inputsSchema:s,outputsSchema:a,metadata:i}={}){let u={name:e,description:t,extra:i?{metadata:i}:void 0};n&&(u.data_type=n),s&&(u.inputs_schema_definition=s),a&&(u.outputs_schema_definition=a);let c=yield this.caller.call(I(),`${this.apiUrl}/datasets`,l({method:"POST",headers:g(l({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield Z(c,"create dataset"),yield c.json()})}readDataset(n){return h(this,arguments,function*({datasetId:e,datasetName:t}){let s="/datasets",a=new URLSearchParams({limit:"1"});if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)G(e),s+=`/${e}`;else if(t!==void 0)a.append("name",t);else throw new Error("Must provide datasetName or datasetId");let i=yield this._get(s,a),o;if(Array.isArray(i)){if(i.length===0)throw new Error(`Dataset[id=${e}, name=${t}] not found`);o=i[0]}else o=i;return o})}hasDataset(n){return h(this,arguments,function*({datasetId:e,datasetName:t}){try{return yield this.readDataset({datasetId:e,datasetName:t}),!0}catch(s){if(s instanceof Error&&s.message.toLocaleLowerCase().includes("not found"))return!1;throw s}})}diffDatasetVersions(a){return h(this,arguments,function*({datasetId:e,datasetName:t,fromVersion:n,toVersion:s}){let i=e;if(i===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");if(i!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");i===void 0&&(i=(yield this.readDataset({datasetName:t})).id);let o=new URLSearchParams({from_version:typeof n=="string"?n:n.toISOString(),to_version:typeof s=="string"?s:s.toISOString()});return yield this._get(`/datasets/${i}/versions/diff`,o)})}readDatasetOpenaiFinetuning(n){return h(this,arguments,function*({datasetId:e,datasetName:t}){let s="/datasets";if(e===void 0)if(t!==void 0)e=(yield this.readDataset({datasetName:t})).id;else throw new Error("Must provide datasetName or datasetId");return(yield(yield this._getResponse(`${s}/${e}/openai_ft`)).text()).trim().split(`
`).map(u=>JSON.parse(u))})}listDatasets(){return j(this,arguments,function*({limit:e=100,offset:t=0,datasetIds:n,datasetName:s,datasetNameContains:a,metadata:i}={}){let o="/datasets",u=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(n!==void 0)for(let m of n)u.append("id",m);s!==void 0&&u.append("name",s),a!==void 0&&u.append("name_contains",a),i!==void 0&&u.append("metadata",JSON.stringify(i));try{for(var c=z(this._getPaginated(o,u)),d,f,p;d=!(f=yield new v(c.next())).done;d=!1){let m=f.value;yield*ee(m)}}catch{p=[f]}finally{try{d&&(f=c.return)&&(yield new v(f.call(c)))}finally{if(p)throw p[0]}}})}updateDataset(e){return h(this,null,function*(){let o=e,{datasetId:t,datasetName:n}=o,s=he(o,["datasetId","datasetName"]);if(!t&&!n)throw new Error("Must provide either datasetName or datasetId");let a=t??(yield this.readDataset({datasetName:n})).id;G(a);let i=yield this.caller.call(I(),`${this.apiUrl}/datasets/${a}`,l({method:"PATCH",headers:g(l({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield Z(i,"update dataset"),yield i.json()})}deleteDataset(n){return h(this,arguments,function*({datasetId:e,datasetName:t}){let s="/datasets",a=e;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(t!==void 0&&(a=(yield this.readDataset({datasetName:t})).id),a!==void 0)G(a),s+=`/${a}`;else throw new Error("Must provide datasetName or datasetId");let i=yield this.caller.call(I(),this.apiUrl+s,l({method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield Z(i,`delete ${s}`),yield i.json()})}indexDataset(s){return h(this,arguments,function*({datasetId:e,datasetName:t,tag:n}){let a=e;if(!a&&!t)throw new Error("Must provide either datasetName or datasetId");if(a&&t)throw new Error("Must provide either datasetName or datasetId, not both");a||(a=(yield this.readDataset({datasetName:t})).id),G(a);let i={tag:n},o=yield this.caller.call(I(),`${this.apiUrl}/datasets/${a}/index`,l({method:"POST",headers:g(l({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield Z(o,"index dataset"),yield o.json()})}similarExamples(a,i,o){return h(this,arguments,function*(e,t,n,{filter:s}={}){let u={limit:n,inputs:e};s!==void 0&&(u.filter=s),G(t);let c=yield this.caller.call(I(),`${this.apiUrl}/datasets/${t}/search`,l({method:"POST",headers:g(l({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield Z(c,"fetch similar examples"),(yield c.json()).examples})}createExample(d,f,p){return h(this,arguments,function*(e,t,{datasetId:n,datasetName:s,createdAt:a,exampleId:i,metadata:o,split:u,sourceRunId:c}){let m=n;if(m===void 0&&s===void 0)throw new Error("Must provide either datasetName or datasetId");if(m!==void 0&&s!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");m===void 0&&(m=(yield this.readDataset({datasetName:s})).id);let w={dataset_id:m,inputs:e,outputs:t,created_at:(a||new Date)?.toISOString(),id:i,metadata:o,split:u,source_run_id:c},b=yield this.caller.call(I(),`${this.apiUrl}/examples`,l({method:"POST",headers:g(l({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(w),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield Z(b,"create example"),yield b.json()})}createExamples(e){return h(this,null,function*(){let{inputs:t,outputs:n,metadata:s,sourceRunIds:a,exampleIds:i,datasetId:o,datasetName:u}=e,c=o;if(c===void 0&&u===void 0)throw new Error("Must provide either datasetName or datasetId");if(c!==void 0&&u!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");c===void 0&&(c=(yield this.readDataset({datasetName:u})).id);let d=t.map((m,_)=>({dataset_id:c,inputs:m,outputs:n?n[_]:void 0,metadata:s?s[_]:void 0,split:e.splits?e.splits[_]:void 0,id:i?i[_]:void 0,source_run_id:a?a[_]:void 0})),f=yield this.caller.call(I(),`${this.apiUrl}/examples/bulk`,l({method:"POST",headers:g(l({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(d),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield Z(f,"create examples"),yield f.json()})}createLLMExample(e,t,n){return h(this,null,function*(){return this.createExample({input:e},{output:t},n)})}createChatExample(e,t,n){return h(this,null,function*(){let s=e.map(i=>va(i)?xa(i):i),a=va(t)?xa(t):t;return this.createExample({input:s},{output:a},n)})}readExample(e){return h(this,null,function*(){G(e);let t=`/examples/${e}`;return yield this._get(t)})}listExamples(){return j(this,arguments,function*({datasetId:e,datasetName:t,exampleIds:n,asOf:s,splits:a,inlineS3Urls:i,metadata:o,limit:u,offset:c,filter:d}={}){let f;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)f=e;else if(t!==void 0)f=(yield new v(this.readDataset({datasetName:t}))).id;else throw new Error("Must provide a datasetName or datasetId");let p=new URLSearchParams({dataset:f}),m=s?typeof s=="string"?s:s?.toISOString():void 0;m&&p.append("as_of",m);let _=i??!0;if(p.append("inline_s3_urls",_.toString()),n!==void 0)for(let $ of n)p.append("id",$);if(a!==void 0)for(let $ of a)p.append("splits",$);if(o!==void 0){let $=JSON.stringify(o);p.append("metadata",$)}u!==void 0&&p.append("limit",u.toString()),c!==void 0&&p.append("offset",c.toString()),d!==void 0&&p.append("filter",d);let w=0;try{for(var b=z(this._getPaginated("/examples",p)),T,A,M;T=!(A=yield new v(b.next())).done;T=!1){let $=A.value;for(let B of $)yield B,w++;if(u!==void 0&&w>=u)break}}catch{M=[A]}finally{try{T&&(A=b.return)&&(yield new v(A.call(b)))}finally{if(M)throw M[0]}}})}deleteExample(e){return h(this,null,function*(){G(e);let t=`/examples/${e}`,n=yield this.caller.call(I(),this.apiUrl+t,l({method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield Z(n,`delete ${t}`),yield n.json()})}updateExample(e,t){return h(this,null,function*(){G(e);let n=yield this.caller.call(I(),`${this.apiUrl}/examples/${e}`,l({method:"PATCH",headers:g(l({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield Z(n,"update example"),yield n.json()})}updateExamples(e){return h(this,null,function*(){let t=yield this.caller.call(I(),`${this.apiUrl}/examples/bulk`,l({method:"PATCH",headers:g(l({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(e),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield Z(t,"update examples"),yield t.json()})}listDatasetSplits(s){return h(this,arguments,function*({datasetId:e,datasetName:t,asOf:n}){let a;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?a=(yield this.readDataset({datasetName:t})).id:a=e,G(a);let i=new URLSearchParams,o=n?typeof n=="string"?n:n?.toISOString():void 0;return o&&i.append("as_of",o),yield this._get(`/datasets/${a}/splits`,i)})}updateDatasetSplits(i){return h(this,arguments,function*({datasetId:e,datasetName:t,splitName:n,exampleIds:s,remove:a=!1}){let o;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?o=(yield this.readDataset({datasetName:t})).id:o=e,G(o);let u={split_name:n,examples:s.map(d=>(G(d),d)),remove:a},c=yield this.caller.call(I(),`${this.apiUrl}/datasets/${o}/splits`,l({method:"PUT",headers:g(l({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield Z(c,"update dataset splits",!0)})}evaluateRun(i,o){return h(this,arguments,function*(e,t,{sourceInfo:n,loadChildRuns:s,referenceExample:a}={loadChildRuns:!1}){Ln("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead.");let u;if(typeof e=="string")u=yield this.readRun(e,{loadChildRuns:s});else if(typeof e=="object"&&"id"in e)u=e;else throw new Error(`Invalid run type: ${typeof e}`);u.reference_example_id!==null&&u.reference_example_id!==void 0&&(a=yield this.readExample(u.reference_example_id));let c=yield t.evaluateRun(u,a),[d,f]=yield this._logEvaluationFeedback(c,u,n);return f[0]})}createFeedback(_,w,b){return h(this,arguments,function*(e,t,{score:n,value:s,correction:a,comment:i,sourceInfo:o,feedbackSourceType:u="api",sourceRunId:c,feedbackId:d,feedbackConfig:f,projectId:p,comparativeExperimentId:m}){if(!e&&!p)throw new Error("One of runId or projectId must be provided");if(e&&p)throw new Error("Only one of runId or projectId can be provided");let T={type:u??"api",metadata:o??{}};c!==void 0&&T?.metadata!==void 0&&!T.metadata.__run&&(T.metadata.__run={run_id:c}),T?.metadata!==void 0&&T.metadata.__run?.run_id!==void 0&&G(T.metadata.__run.run_id);let A={id:d??Lt(),run_id:e,key:t,score:n,value:s,correction:a,comment:i,feedback_source:T,comparative_experiment_id:m,feedbackConfig:f,session_id:p},M=`${this.apiUrl}/feedback`,$=yield this.caller.call(I(),M,l({method:"POST",headers:g(l({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(A),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield Z($,"create feedback",!0),A})}updateFeedback(i,o){return h(this,arguments,function*(e,{score:t,value:n,correction:s,comment:a}){let u={};t!=null&&(u.score=t),n!=null&&(u.value=n),s!=null&&(u.correction=s),a!=null&&(u.comment=a),G(e);let c=yield this.caller.call(I(),`${this.apiUrl}/feedback/${e}`,l({method:"PATCH",headers:g(l({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield Z(c,"update feedback",!0)})}readFeedback(e){return h(this,null,function*(){G(e);let t=`/feedback/${e}`;return yield this._get(t)})}deleteFeedback(e){return h(this,null,function*(){G(e);let t=`/feedback/${e}`,n=yield this.caller.call(I(),this.apiUrl+t,l({method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield Z(n,`delete ${t}`),yield n.json()})}listFeedback(){return j(this,arguments,function*({runIds:e,feedbackKeys:t,feedbackSourceTypes:n}={}){let s=new URLSearchParams;if(e&&s.append("run",e.join(",")),t)for(let c of t)s.append("key",c);if(n)for(let c of n)s.append("source",c);try{for(var a=z(this._getPaginated("/feedback",s)),i,o,u;i=!(o=yield new v(a.next())).done;i=!1){let c=o.value;yield*ee(c)}}catch{u=[o]}finally{try{i&&(o=a.return)&&(yield new v(o.call(a)))}finally{if(u)throw u[0]}}})}createPresignedFeedbackToken(a,i){return h(this,arguments,function*(e,t,{expiration:n,feedbackConfig:s}={}){let o={run_id:e,feedback_key:t,feedback_config:s};return n?typeof n=="string"?o.expires_at=n:(n?.hours||n?.minutes||n?.days)&&(o.expires_in=n):o.expires_in={hours:3},yield(yield this.caller.call(I(),`${this.apiUrl}/feedback/tokens`,l({method:"POST",headers:g(l({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions))).json()})}createComparativeExperiment(u){return h(this,arguments,function*({name:e,experimentIds:t,referenceDatasetId:n,createdAt:s,description:a,metadata:i,id:o}){if(t.length===0)throw new Error("At least one experiment is required");if(n||(n=(yield this.readProject({projectId:t[0]})).reference_dataset_id),!n==null)throw new Error("A reference dataset is required");let c={id:o,name:e,experiment_ids:t,reference_dataset_id:n,description:a,created_at:(s??new Date)?.toISOString(),extra:{}};return i&&(c.extra.metadata=i),yield(yield this.caller.call(I(),`${this.apiUrl}/datasets/comparative`,l({method:"POST",headers:g(l({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions))).json()})}listPresignedFeedbackTokens(e){return j(this,null,function*(){G(e);let t=new URLSearchParams({run_id:e});try{for(var n=z(this._getPaginated("/feedback/tokens",t)),s,a,i;s=!(a=yield new v(n.next())).done;s=!1){let o=a.value;yield*ee(o)}}catch{i=[a]}finally{try{s&&(a=n.return)&&(yield new v(a.call(n)))}finally{if(i)throw i[0]}}})}_selectEvalResults(e){let t;return"results"in e?t=e.results:t=[e],t}_logEvaluationFeedback(e,t,n){return h(this,null,function*(){let s=this._selectEvalResults(e),a=[];for(let i of s){let o=n||{};i.evaluatorInfo&&(o=l(l({},i.evaluatorInfo),o));let u=null;i.targetRunId?u=i.targetRunId:t&&(u=t.id),a.push(yield this.createFeedback(u,i.key,{score:i.score,value:i.value,comment:i.comment,correction:i.correction,sourceInfo:o,sourceRunId:i.sourceRunId,feedbackConfig:i.feedbackConfig,feedbackSourceType:"model"}))}return[s,a]})}logEvaluationFeedback(e,t,n){return h(this,null,function*(){let[s]=yield this._logEvaluationFeedback(e,t,n);return s})}listAnnotationQueues(){return j(this,arguments,function*(e={}){let{queueIds:t,name:n,nameContains:s,limit:a}=e,i=new URLSearchParams;t&&t.forEach((p,m)=>{G(p,`queueIds[${m}]`),i.append("ids",p)}),n&&i.append("name",n),s&&i.append("name_contains",s),i.append("limit",(a!==void 0?Math.min(a,100):100).toString());let o=0;try{for(var u=z(this._getPaginated("/annotation-queues",i)),c,d,f;c=!(d=yield new v(u.next())).done;c=!1){let p=d.value;if(yield*ee(p),o++,a!==void 0&&o>=a)break}}catch{f=[d]}finally{try{c&&(d=u.return)&&(yield new v(d.call(u)))}finally{if(f)throw f[0]}}})}createAnnotationQueue(e){return h(this,null,function*(){let{name:t,description:n,queueId:s}=e,a={name:t,description:n,id:s||Lt()},i=yield this.caller.call(I(),`${this.apiUrl}/annotation-queues`,l({method:"POST",headers:g(l({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(Object.fromEntries(Object.entries(a).filter(([u,c])=>c!==void 0))),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield Z(i,"create annotation queue"),yield i.json()})}readAnnotationQueue(e){return h(this,null,function*(){let t=yield this.listAnnotationQueues({queueIds:[e]}).next();if(t.done)throw new Error(`Annotation queue with ID ${e} not found`);return t.value})}updateAnnotationQueue(e,t){return h(this,null,function*(){let{name:n,description:s}=t,a=yield this.caller.call(I(),`${this.apiUrl}/annotation-queues/${G(e,"queueId")}`,l({method:"PATCH",headers:g(l({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify({name:n,description:s}),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield Z(a,"update annotation queue")})}deleteAnnotationQueue(e){return h(this,null,function*(){let t=yield this.caller.call(I(),`${this.apiUrl}/annotation-queues/${G(e,"queueId")}`,l({method:"DELETE",headers:g(l({},this.headers),{Accept:"application/json"}),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield Z(t,"delete annotation queue")})}addRunsToAnnotationQueue(e,t){return h(this,null,function*(){let n=yield this.caller.call(I(),`${this.apiUrl}/annotation-queues/${G(e,"queueId")}/runs`,l({method:"POST",headers:g(l({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(t.map((s,a)=>G(s,`runIds[${a}]`).toString())),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield Z(n,"add runs to annotation queue")})}getRunFromAnnotationQueue(e,t){return h(this,null,function*(){let n=`/annotation-queues/${G(e,"queueId")}/run`,s=yield this.caller.call(I(),`${this.apiUrl}${n}/${t}`,l({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield Z(s,"get run from annotation queue"),yield s.json()})}_currentTenantIsOwner(e){return h(this,null,function*(){let t=yield this._getSettings();return e=="-"||t.tenant_handle===e})}_ownerConflictError(e,t){return h(this,null,function*(){let n=yield this._getSettings();return new Error(`Cannot ${e} for another tenant.

      Current tenant: ${n.tenant_handle}

      Requested tenant: ${t}`)})}_getLatestCommitHash(e){return h(this,null,function*(){let t=yield this.caller.call(I(),`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,l({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions)),n=yield t.json();if(!t.ok){let s=typeof n.detail=="string"?n.detail:JSON.stringify(n.detail),a=new Error(`Error ${t.status}: ${t.statusText}
${s}`);throw a.statusCode=t.status,a}if(n.commits.length!==0)return n.commits[0].commit_hash})}_likeOrUnlikePrompt(e,t){return h(this,null,function*(){let[n,s,a]=dt(e),i=yield this.caller.call(I(),`${this.apiUrl}/likes/${n}/${s}`,l({method:"POST",body:JSON.stringify({like:t}),headers:g(l({},this.headers),{"Content-Type":"application/json"}),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield Z(i,`${t?"like":"unlike"} prompt`),yield i.json()})}_getPromptUrl(e){return h(this,null,function*(){let[t,n,s]=dt(e);if(yield this._currentTenantIsOwner(t)){let a=yield this._getSettings();return s!=="latest"?`${this.getHostUrl()}/prompts/${n}/${s.substring(0,8)}?organizationId=${a.id}`:`${this.getHostUrl()}/prompts/${n}?organizationId=${a.id}`}else return s!=="latest"?`${this.getHostUrl()}/hub/${t}/${n}/${s.substring(0,8)}`:`${this.getHostUrl()}/hub/${t}/${n}`})}promptExists(e){return h(this,null,function*(){return!!(yield this.getPrompt(e))})}likePrompt(e){return h(this,null,function*(){return this._likeOrUnlikePrompt(e,!0)})}unlikePrompt(e){return h(this,null,function*(){return this._likeOrUnlikePrompt(e,!1)})}listCommits(e){return j(this,null,function*(){try{for(var t=z(this._getPaginated(`/commits/${e}/`,new URLSearchParams,o=>o.commits)),n,s,a;n=!(s=yield new v(t.next())).done;n=!1){let i=s.value;yield*ee(i)}}catch{a=[s]}finally{try{n&&(s=t.return)&&(yield new v(s.call(t)))}finally{if(a)throw a[0]}}})}listPrompts(e){return j(this,null,function*(){let t=new URLSearchParams;t.append("sort_field",e?.sortField??"updated_at"),t.append("sort_direction","desc"),t.append("is_archived",(!!e?.isArchived).toString()),e?.isPublic!==void 0&&t.append("is_public",e.isPublic.toString()),e?.query&&t.append("query",e.query);try{for(var n=z(this._getPaginated("/repos",t,u=>u.repos)),s,a,i;s=!(a=yield new v(n.next())).done;s=!1){let o=a.value;yield*ee(o)}}catch{i=[a]}finally{try{s&&(a=n.return)&&(yield new v(a.call(n)))}finally{if(i)throw i[0]}}})}getPrompt(e){return h(this,null,function*(){let[t,n,s]=dt(e),a=yield this.caller.call(I(),`${this.apiUrl}/repos/${t}/${n}`,l({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));if(a.status===404)return null;yield Z(a,"get prompt");let i=yield a.json();return i.repo?i.repo:null})}createPrompt(e,t){return h(this,null,function*(){let n=yield this._getSettings();if(t?.isPublic&&!n.tenant_handle)throw new Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle. 
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);let[s,a,i]=dt(e);if(!(yield this._currentTenantIsOwner(s)))throw yield this._ownerConflictError("create a prompt",s);let o=g(l(l(l({repo_handle:a},t?.description&&{description:t.description}),t?.readme&&{readme:t.readme}),t?.tags&&{tags:t.tags}),{is_public:!!t?.isPublic}),u=yield this.caller.call(I(),`${this.apiUrl}/repos/`,l({method:"POST",headers:g(l({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield Z(u,"create prompt");let{repo:c}=yield u.json();return c})}createCommit(e,t,n){return h(this,null,function*(){if(!(yield this.promptExists(e)))throw new Error("Prompt does not exist, you must create it first.");let[s,a,i]=dt(e),o=n?.parentCommitHash==="latest"||!n?.parentCommitHash?yield this._getLatestCommitHash(`${s}/${a}`):n?.parentCommitHash,u={manifest:JSON.parse(JSON.stringify(t)),parent_commit:o},c=yield this.caller.call(I(),`${this.apiUrl}/commits/${s}/${a}`,l({method:"POST",headers:g(l({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield Z(c,"create commit");let d=yield c.json();return this._getPromptUrl(`${s}/${a}${d.commit_hash?`:${d.commit_hash}`:""}`)})}updatePrompt(e,t){return h(this,null,function*(){if(!(yield this.promptExists(e)))throw new Error("Prompt does not exist, you must create it first.");let[n,s]=dt(e);if(!(yield this._currentTenantIsOwner(n)))throw yield this._ownerConflictError("update a prompt",n);let a={};if(t?.description!==void 0&&(a.description=t.description),t?.readme!==void 0&&(a.readme=t.readme),t?.tags!==void 0&&(a.tags=t.tags),t?.isPublic!==void 0&&(a.is_public=t.isPublic),t?.isArchived!==void 0&&(a.is_archived=t.isArchived),Object.keys(a).length===0)throw new Error("No valid update options provided");let i=yield this.caller.call(I(),`${this.apiUrl}/repos/${n}/${s}`,l({method:"PATCH",body:JSON.stringify(a),headers:g(l({},this.headers),{"Content-Type":"application/json"}),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield Z(i,"update prompt"),i.json()})}deletePrompt(e){return h(this,null,function*(){if(!(yield this.promptExists(e)))throw new Error("Prompt does not exist, you must create it first.");let[t,n,s]=dt(e);if(!(yield this._currentTenantIsOwner(t)))throw yield this._ownerConflictError("delete a prompt",t);return yield(yield this.caller.call(I(),`${this.apiUrl}/repos/${t}/${n}`,l({method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions))).json()})}pullPromptCommit(e,t){return h(this,null,function*(){let[n,s,a]=dt(e),i=yield this._getServerInfo(),o=ol(i.version,"0.5.23"),u=a;if(!o&&a==="latest"){let f=yield this._getLatestCommitHash(`${n}/${s}`);if(f)u=f;else throw new Error("No commits found")}let c=yield this.caller.call(I(),`${this.apiUrl}/commits/${n}/${s}/${u}${t?.includeModel?"?include_model=true":""}`,l({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield Z(c,"pull prompt commit");let d=yield c.json();return{owner:n,repo:s,commit_hash:d.commit_hash,manifest:d.manifest,examples:d.examples}})}_pullPrompt(e,t){return h(this,null,function*(){let n=yield this.pullPromptCommit(e,{includeModel:t?.includeModel});return JSON.stringify(n.manifest)})}pushPrompt(e,t){return h(this,null,function*(){return(yield this.promptExists(e))?t&&Object.keys(t).some(s=>s!=="object")&&(yield this.updatePrompt(e,{description:t?.description,readme:t?.readme,tags:t?.tags,isPublic:t?.isPublic})):yield this.createPrompt(e,{description:t?.description,readme:t?.readme,tags:t?.tags,isPublic:t?.isPublic}),t?.object?yield this.createCommit(e,t?.object,{parentCommitHash:t?.parentCommitHash}):yield this._getPromptUrl(e)})}clonePublicDataset(n){return h(this,arguments,function*(e,t={}){let{sourceApiUrl:s=this.apiUrl,datasetName:a}=t,[i,o]=this.parseTokenOrUrl(e,s),u=new r({apiUrl:i,apiKey:"placeholder"}),c=yield u.readSharedDataset(o),d=a||c.name;try{if(yield this.hasDataset({datasetId:d})){console.log(`Dataset ${d} already exists in your tenant. Skipping.`);return}}catch{}let f=yield u.listSharedExamples(o),p=yield this.createDataset(d,{description:c.description,dataType:c.data_type||"kv",inputsSchema:c.inputs_schema_definition??void 0,outputsSchema:c.outputs_schema_definition??void 0});try{yield this.createExamples({inputs:f.map(m=>m.inputs),outputs:f.flatMap(m=>m.outputs?[m.outputs]:[]),datasetId:p.id})}catch(m){throw console.error(`An error occurred while creating dataset ${d}. You should delete it manually.`),m}})}parseTokenOrUrl(e,t,n=2,s="dataset"){try{return G(e),[t,e]}catch{}try{let i=new URL(e).pathname.split("/").filter(o=>o!=="");if(i.length>=n){let o=i[i.length-n];return[t,o]}else throw new Error(`Invalid public ${s} URL: ${e}`)}catch{throw new Error(`Invalid public ${s} URL or token: ${e}`)}}awaitPendingTraceBatches(){return Promise.all(this.autoBatchQueue.items.map(({itemPromise:e})=>e))}};var ll=r=>r!==void 0?r:!!["TRACING_V2","TRACING"].find(t=>lt(t)==="true");var Wn=Symbol.for("lc:context_variables");function Ty(r){return r.replace(/[-:.]/g,"")}function Sy(r,e,t=1){let n=t.toFixed(0).slice(0,3).padStart(3,"0");return Ty(`${new Date(r).toISOString().slice(0,-1)}${n}Z`)+e}var Kn=class r{constructor(e,t){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=t}static fromHeader(e){let t=e.split(","),n={},s=[];for(let a of t){let[i,o]=a.split("="),u=decodeURIComponent(o);i==="langsmith-metadata"?n=JSON.parse(u):i==="langsmith-tags"&&(s=u.split(","))}return new r(n,s)}toHeader(){let e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),e.join(",")}},Xn=class r{constructor(e){if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Ay(e)){Object.assign(this,l({},e));return}let t=r.getDefaultConfig(),o=e,{metadata:n}=o,s=he(o,["metadata"]),a=s.client??r.getSharedClient(),i=l(l({},n),s?.extra?.metadata);if(s.extra=g(l({},s.extra),{metadata:i}),Object.assign(this,g(l(l({},t),s),{client:a})),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.execution_order??=1,this.child_execution_order??=1,!this.dotted_order){let u=Sy(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+u:this.dotted_order=u}}static getDefaultConfig(){return{id:Lt(),run_type:"chain",project_name:vt("LANGCHAIN_PROJECT")??vt("LANGCHAIN_SESSION")??"default",child_runs:[],api_url:vt("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:vt("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{}}}static getSharedClient(){return r.sharedClient||(r.sharedClient=new Mt),r.sharedClient}createChild(e){let t=this.child_execution_order+1,n=new r(g(l({},e),{parent_run:this,project_name:this.project_name,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:t,child_execution_order:t}));Wn in this&&(n[Wn]=this[Wn]);let s=Symbol.for("lc:child_config"),a=e.extra?.[s]??this.extra[s];if(ky(a)){let u=l({},a),c=Ry(u.callbacks)?u.callbacks.copy?.():void 0;c&&(Object.assign(c,{_parentRunId:n.id}),c.handlers?.find(fl)?.updateFromRunTree?.(n),u.callbacks=c),n.extra[s]=u}let i=new Set,o=this;for(;o!=null&&!i.has(o.id);)i.add(o.id),o.child_execution_order=Math.max(o.child_execution_order,t),o=o.parent_run;return this.child_runs.push(n),n}end(a,i){return h(this,arguments,function*(e,t,n=Date.now(),s){this.outputs=this.outputs??e,this.error=this.error??t,this.end_time=this.end_time??n,s&&Object.keys(s).length>0&&(this.extra=this.extra?g(l({},this.extra),{metadata:l(l({},this.extra.metadata),s)}):{metadata:s})})}_convertToCreate(e,t,n=!0){let s=e.extra??{};if(s.runtime||(s.runtime={}),t)for(let[u,c]of Object.entries(t))s.runtime[u]||(s.runtime[u]=c);let a,i;return n?(i=e.parent_run?.id,a=[]):(a=e.child_runs.map(u=>this._convertToCreate(u,t,n)),i=void 0),{id:e.id,name:e.name,start_time:e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:s,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:a,parent_run_id:i,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags}}postRun(e=!0){return h(this,null,function*(){try{let t=Nn(),n=yield this._convertToCreate(this,t,!0);if(yield this.client.createRun(n),!e){Ln("Posting with excludeChildRuns=false is deprecated and will be removed in a future version.");for(let s of this.child_runs)yield s.postRun(!1)}}catch(t){console.error(`Error in postRun for run ${this.id}:`,t)}})}patchRun(){return h(this,null,function*(){try{let e={end_time:this.end_time,error:this.error,inputs:this.inputs,outputs:this.outputs,parent_run_id:this.parent_run?.id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags};yield this.client.updateRun(this.id,e)}catch(e){console.error(`Error in patchRun for run ${this.id}`,e)}})}toJSON(){return this._convertToCreate(this,void 0,!1)}static fromRunnableConfig(e,t){let n=e?.callbacks,s,a,i,o=ll();if(n){let c=n?.getParentRunId?.()??"",d=n?.handlers?.find(f=>f?.name=="langchain_tracer");s=d?.getRun?.(c),a=d?.projectName,i=d?.client,o=o||!!d}return s?new r({name:s.name,id:s.id,trace_id:s.trace_id,dotted_order:s.dotted_order,client:i,tracingEnabled:o,project_name:a,tags:[...new Set((s?.tags??[]).concat(e?.tags??[]))],extra:{metadata:l(l({},s?.extra?.metadata),e?.metadata)}}).createChild(t):new r(g(l({},t),{client:i,tracingEnabled:o,project_name:a}))}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,t){let n="get"in e&&typeof e.get=="function"?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,s=n["langsmith-trace"];if(!s||typeof s!="string")return;let a=s.trim(),i=a.split(".").map(c=>{let[d,f]=c.split("Z");return{strTime:d,time:Date.parse(d+"Z"),uuid:f}}),o=i[0].uuid,u=g(l({},t),{name:t?.name??"parent",run_type:t?.run_type??"chain",start_time:t?.start_time??Date.now(),id:i.at(-1)?.uuid,trace_id:o,dotted_order:a});if(n.baggage&&typeof n.baggage=="string"){let c=Kn.fromHeader(n.baggage);u.metadata=c.metadata,u.tags=c.tags}return new r(u)}toHeaders(e){let t={"langsmith-trace":this.dotted_order,baggage:new Kn(this.extra?.metadata,this.tags).toHeader()};if(e)for(let[n,s]of Object.entries(t))e.set(n,s);return t}};Object.defineProperty(Xn,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null});function Ay(r){return r!==void 0&&typeof r.createChild=="function"&&typeof r.postRun=="function"}function fl(r){return typeof r=="object"&&r!=null&&typeof r.name=="string"&&r.name==="langchain_tracer"}function dl(r){return Array.isArray(r)&&r.some(e=>fl(e))}function Ry(r){return typeof r=="object"&&r!=null&&Array.isArray(r.handlers)}function ky(r){return r!==void 0&&typeof r.callbacks=="object"&&(dl(r.callbacks?.handlers)||dl(r.callbacks))}var $n="0.1.68";var Pr=class extends qe{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let{exampleId:t,projectName:n,client:s}=e;this.projectName=n??$e("LANGCHAIN_PROJECT")??$e("LANGCHAIN_SESSION"),this.exampleId=t,this.client=s??new Mt({})}_convertToCreate(e,t=void 0){return h(this,null,function*(){return g(l({},e),{extra:g(l({},e.extra),{runtime:yield ou()}),child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:t})})}persistRun(e){return h(this,null,function*(){})}onRunCreate(e){return h(this,null,function*(){let t=yield this._convertToCreate(e,this.exampleId);yield this.client.createRun(t)})}onRunUpdate(e){return h(this,null,function*(){let t={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events,inputs:e.inputs,trace_id:e.trace_id,dotted_order:e.dotted_order,parent_run_id:e.parent_run_id};yield this.client.updateRun(e.id,t)})}getRun(e){return this.runMap.get(e)}};function hl(){return h(this,null,function*(){return new Pr})}var Yn=Re(mn(),1);var Wa;function Cy(){let r="default"in Yn.default?Yn.default.default:Yn.default;return new r({autoStart:!0,concurrency:1})}function ue(r,e){return h(this,null,function*(){e===!0?yield r():(typeof Wa>"u"&&(Wa=Cy()),Wa.add(r))})}$e("LANGCHAIN_TRACING_V2")==="true"&&$e("LANGCHAIN_CALLBACKS_BACKGROUND")!=="true"&&["[WARN]: You have enabled LangSmith tracing without backgrounding callbacks.","[WARN]: If you are not using a serverless environment where you must wait for tracing calls to finish,",'[WARN]: we suggest setting "process.env.LANGCHAIN_CALLBACKS_BACKGROUND=true" to avoid additional latency.'].join(`
`);var Ka=class{setHandler(e){return this.setHandlers([e])}},rr=class{constructor(e,t,n,s,a,i,o,u){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:u})}handleText(e){return h(this,null,function*(){yield Promise.all(this.handlers.map(t=>ue(()=>h(this,null,function*(){try{yield t.handleText?.(e,this.runId,this._parentRunId,this.tags)}catch(n){console.error(`Error in handler ${t.constructor.name}, handleText: ${n}`)}}),t.awaitHandlers)))})}},Xa=class extends rr{getChild(e){let t=new xe(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}handleRetrieverEnd(e){return h(this,null,function*(){yield Promise.all(this.handlers.map(t=>ue(()=>h(this,null,function*(){if(!t.ignoreRetriever)try{yield t.handleRetrieverEnd?.(e,this.runId,this._parentRunId,this.tags)}catch{console.error(`Error in handler ${t.constructor.name}, handleRetriever`)}}),t.awaitHandlers)))})}handleRetrieverError(e){return h(this,null,function*(){yield Promise.all(this.handlers.map(t=>ue(()=>h(this,null,function*(){if(!t.ignoreRetriever)try{yield t.handleRetrieverError?.(e,this.runId,this._parentRunId,this.tags)}catch(n){console.error(`Error in handler ${t.constructor.name}, handleRetrieverError: ${n}`)}}),t.awaitHandlers)))})}},Qn=class extends rr{handleLLMNewToken(e,t,n,s,a,i){return h(this,null,function*(){yield Promise.all(this.handlers.map(o=>ue(()=>h(this,null,function*(){if(!o.ignoreLLM)try{yield o.handleLLMNewToken?.(e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,i)}catch(u){console.error(`Error in handler ${o.constructor.name}, handleLLMNewToken: ${u}`)}}),o.awaitHandlers)))})}handleLLMError(e){return h(this,null,function*(){yield Promise.all(this.handlers.map(t=>ue(()=>h(this,null,function*(){if(!t.ignoreLLM)try{yield t.handleLLMError?.(e,this.runId,this._parentRunId,this.tags)}catch(n){console.error(`Error in handler ${t.constructor.name}, handleLLMError: ${n}`)}}),t.awaitHandlers)))})}handleLLMEnd(e){return h(this,null,function*(){yield Promise.all(this.handlers.map(t=>ue(()=>h(this,null,function*(){if(!t.ignoreLLM)try{yield t.handleLLMEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(n){console.error(`Error in handler ${t.constructor.name}, handleLLMEnd: ${n}`)}}),t.awaitHandlers)))})}},Ya=class extends rr{getChild(e){let t=new xe(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}handleChainError(e,t,n,s,a){return h(this,null,function*(){yield Promise.all(this.handlers.map(i=>ue(()=>h(this,null,function*(){if(!i.ignoreChain)try{yield i.handleChainError?.(e,this.runId,this._parentRunId,this.tags,a)}catch(o){console.error(`Error in handler ${i.constructor.name}, handleChainError: ${o}`)}}),i.awaitHandlers)))})}handleChainEnd(e,t,n,s,a){return h(this,null,function*(){yield Promise.all(this.handlers.map(i=>ue(()=>h(this,null,function*(){if(!i.ignoreChain)try{yield i.handleChainEnd?.(e,this.runId,this._parentRunId,this.tags,a)}catch(o){console.error(`Error in handler ${i.constructor.name}, handleChainEnd: ${o}`)}}),i.awaitHandlers)))})}handleAgentAction(e){return h(this,null,function*(){yield Promise.all(this.handlers.map(t=>ue(()=>h(this,null,function*(){if(!t.ignoreAgent)try{yield t.handleAgentAction?.(e,this.runId,this._parentRunId,this.tags)}catch(n){console.error(`Error in handler ${t.constructor.name}, handleAgentAction: ${n}`)}}),t.awaitHandlers)))})}handleAgentEnd(e){return h(this,null,function*(){yield Promise.all(this.handlers.map(t=>ue(()=>h(this,null,function*(){if(!t.ignoreAgent)try{yield t.handleAgentEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(n){console.error(`Error in handler ${t.constructor.name}, handleAgentEnd: ${n}`)}}),t.awaitHandlers)))})}},Qa=class extends rr{getChild(e){let t=new xe(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}handleToolError(e){return h(this,null,function*(){yield Promise.all(this.handlers.map(t=>ue(()=>h(this,null,function*(){if(!t.ignoreAgent)try{yield t.handleToolError?.(e,this.runId,this._parentRunId,this.tags)}catch(n){console.error(`Error in handler ${t.constructor.name}, handleToolError: ${n}`)}}),t.awaitHandlers)))})}handleToolEnd(e){return h(this,null,function*(){yield Promise.all(this.handlers.map(t=>ue(()=>h(this,null,function*(){if(!t.ignoreAgent)try{yield t.handleToolEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(n){console.error(`Error in handler ${t.constructor.name}, handleToolEnd: ${n}`)}}),t.awaitHandlers)))})}},xe=class r extends Ka{constructor(e,t){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=t?.handlers??this.handlers,this.inheritableHandlers=t?.inheritableHandlers??this.inheritableHandlers,this.tags=t?.tags??this.tags,this.inheritableTags=t?.inheritableTags??this.inheritableTags,this.metadata=t?.metadata??this.metadata,this.inheritableMetadata=t?.inheritableMetadata??this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}handleLLMStart(e,t,n=void 0,s=void 0,a=void 0,i=void 0,o=void 0,u=void 0){return h(this,null,function*(){return Promise.all(t.map((c,d)=>h(this,null,function*(){let f=d===0&&n?n:Ne();return yield Promise.all(this.handlers.map(p=>ue(()=>h(this,null,function*(){if(!p.ignoreLLM)try{yield p.handleLLMStart?.(e,[c],f,this._parentRunId,a,this.tags,this.metadata,u)}catch(m){console.error(`Error in handler ${p.constructor.name}, handleLLMStart: ${m}`)}}),p.awaitHandlers))),new Qn(f,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)})))})}handleChatModelStart(e,t,n=void 0,s=void 0,a=void 0,i=void 0,o=void 0,u=void 0){return h(this,null,function*(){return Promise.all(t.map((c,d)=>h(this,null,function*(){let f=d===0&&n?n:Ne();return yield Promise.all(this.handlers.map(p=>ue(()=>h(this,null,function*(){if(!p.ignoreLLM)try{if(p.handleChatModelStart)yield p.handleChatModelStart?.(e,[c],f,this._parentRunId,a,this.tags,this.metadata,u);else if(p.handleLLMStart){let m=pr(c);yield p.handleLLMStart?.(e,[m],f,this._parentRunId,a,this.tags,this.metadata,u)}}catch(m){console.error(`Error in handler ${p.constructor.name}, handleLLMStart: ${m}`)}}),p.awaitHandlers))),new Qn(f,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)})))})}handleChainStart(u,c){return h(this,arguments,function*(e,t,n=Ne(),s=void 0,a=void 0,i=void 0,o=void 0){return yield Promise.all(this.handlers.map(d=>ue(()=>h(this,null,function*(){if(!d.ignoreChain)try{yield d.handleChainStart?.(e,t,n,this._parentRunId,this.tags,this.metadata,s,o)}catch(f){console.error(`Error in handler ${d.constructor.name}, handleChainStart: ${f}`)}}),d.awaitHandlers))),new Ya(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)})}handleToolStart(u,c){return h(this,arguments,function*(e,t,n=Ne(),s=void 0,a=void 0,i=void 0,o=void 0){return yield Promise.all(this.handlers.map(d=>ue(()=>h(this,null,function*(){if(!d.ignoreAgent)try{yield d.handleToolStart?.(e,t,n,this._parentRunId,this.tags,this.metadata,o)}catch(f){console.error(`Error in handler ${d.constructor.name}, handleToolStart: ${f}`)}}),d.awaitHandlers))),new Qa(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)})}handleRetrieverStart(u,c){return h(this,arguments,function*(e,t,n=Ne(),s=void 0,a=void 0,i=void 0,o=void 0){return yield Promise.all(this.handlers.map(d=>ue(()=>h(this,null,function*(){if(!d.ignoreRetriever)try{yield d.handleRetrieverStart?.(e,t,n,this._parentRunId,this.tags,this.metadata,o)}catch(f){console.error(`Error in handler ${d.constructor.name}, handleRetrieverStart: ${f}`)}}),d.awaitHandlers))),new Xa(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)})}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e),this.inheritableHandlers=this.inheritableHandlers.filter(t=>t!==e)}setHandlers(e,t=!0){this.handlers=[],this.inheritableHandlers=[];for(let n of e)this.addHandler(n,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(t=>!e.includes(t)),this.inheritableTags=this.inheritableTags.filter(t=>!e.includes(t))}addMetadata(e,t=!0){this.metadata=l(l({},this.metadata),e),t&&(this.inheritableMetadata=l(l({},this.inheritableMetadata),e))}removeMetadata(e){for(let t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){let n=new r(this._parentRunId);for(let s of this.handlers){let a=this.inheritableHandlers.includes(s);n.addHandler(s,a)}for(let s of this.tags){let a=this.inheritableTags.includes(s);n.addTags([s],a)}for(let s of Object.keys(this.metadata)){let a=Object.keys(this.inheritableMetadata).includes(s);n.addMetadata({[s]:this.metadata[s]},a)}for(let s of e)n.handlers.filter(a=>a.name==="console_callback_handler").some(a=>a.name===s.name)||n.addHandler(s,t);return n}static fromHandlers(e){class t extends $t{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:Ne()}),Object.assign(this,e)}}let n=new this;return n.addHandler(new t),n}static configure(e,t,n,s,a,i,o){return h(this,null,function*(){let u;(e||t)&&(Array.isArray(e)||!e?(u=new r,u.setHandlers(e?.map(Ir)??[],!0)):u=e,u=u.copy(Array.isArray(t)?t.map(Ir):t?.handlers,!1));let c=$e("LANGCHAIN_VERBOSE")==="true"||o?.verbose,d=$e("LANGCHAIN_TRACING_V2")==="true",f=d||($e("LANGCHAIN_TRACING")??!1);if(c||f){if(u||(u=new r),c&&!u.handlers.some(p=>p.name===xr.prototype.name)){let p=new xr;u.addHandler(p,!0)}f&&!u.handlers.some(p=>p.name==="langchain_tracer")&&d&&u.addHandler(yield hl(),!0)}return(n||s)&&u&&(u.addTags(n??[]),u.addTags(s??[],!1)),(a||i)&&u&&(u.addMetadata(a??{}),u.addMetadata(i??{},!1)),u})}};function Ir(r){return"name"in r?r:$t.fromMethods(r)}var ei={};Cs(ei,{JsonPatchError:()=>te,_areEquals:()=>$r,applyOperation:()=>Ft,applyPatch:()=>Bt,applyReducer:()=>$y,deepClone:()=>Iy,getValueByPointer:()=>ns,validate:()=>yl,validator:()=>ss});var Py=Object.prototype.hasOwnProperty;function ml(r,e){return Py.call(r,e)}function gl(r){if(Array.isArray(r)){let t=new Array(r.length);for(let n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(r);let e=[];for(let t in r)ml(r,t)&&e.push(t);return e}function De(r){switch(typeof r){case"object":return JSON.parse(JSON.stringify(r));case"undefined":return null;default:return r}}function ts(r){let e=0,t=r.length,n;for(;e<t;){if(n=r.charCodeAt(e),n>=48&&n<=57){e++;continue}return!1}return!0}function rs(r){return r.indexOf("/")===-1&&r.indexOf("~")===-1?r:r.replace(/~/g,"~0").replace(/\//g,"~1")}function Nr(r){return r.replace(/~1/g,"/").replace(/~0/g,"~")}function es(r){if(r===void 0)return!0;if(r){if(Array.isArray(r)){for(let t=0,n=r.length;t<n;t++)if(es(r[t]))return!0}else if(typeof r=="object"){let t=gl(r),n=t.length;for(var e=0;e<n;e++)if(es(r[t[e]]))return!0}}return!1}function pl(r,e){let t=[r];for(let n in e){let s=typeof e[n]=="object"?JSON.stringify(e[n],null,2):e[n];typeof s<"u"&&t.push(`${n}: ${s}`)}return t.join(`
`)}var Ut=class extends Error{constructor(e,t,n,s,a){super(pl(e,{name:t,index:n,operation:s,tree:a})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.setPrototypeOf(this,new.target.prototype),this.message=pl(e,{name:t,index:n,operation:s,tree:a})}};var te=Ut,Iy=De,nr={add:function(r,e,t){return r[e]=this.value,{newDocument:t}},remove:function(r,e,t){var n=r[e];return delete r[e],{newDocument:t,removed:n}},replace:function(r,e,t){var n=r[e];return r[e]=this.value,{newDocument:t,removed:n}},move:function(r,e,t){let n=ns(t,this.path);n&&(n=De(n));let s=Ft(t,{op:"remove",path:this.from}).removed;return Ft(t,{op:"add",path:this.path,value:s}),{newDocument:t,removed:n}},copy:function(r,e,t){let n=ns(t,this.from);return Ft(t,{op:"add",path:this.path,value:De(n)}),{newDocument:t}},test:function(r,e,t){return{newDocument:t,test:$r(r[e],this.value)}},_get:function(r,e,t){return this.value=r[e],{newDocument:t}}},Ny={add:function(r,e,t){return ts(e)?r.splice(e,0,this.value):r[e]=this.value,{newDocument:t,index:e}},remove:function(r,e,t){var n=r.splice(e,1);return{newDocument:t,removed:n[0]}},replace:function(r,e,t){var n=r[e];return r[e]=this.value,{newDocument:t,removed:n}},move:nr.move,copy:nr.copy,test:nr.test,_get:nr._get};function ns(r,e){if(e=="")return r;var t={op:"_get",path:e};return Ft(r,t),t.value}function Ft(r,e,t=!1,n=!0,s=!0,a=0){if(t&&(typeof t=="function"?t(e,0,r,e.path):ss(e,0)),e.path===""){let i={newDocument:r};if(e.op==="add")return i.newDocument=e.value,i;if(e.op==="replace")return i.newDocument=e.value,i.removed=r,i;if(e.op==="move"||e.op==="copy")return i.newDocument=ns(r,e.from),e.op==="move"&&(i.removed=r),i;if(e.op==="test"){if(i.test=$r(r,e.value),i.test===!1)throw new te("Test operation failed","TEST_OPERATION_FAILED",a,e,r);return i.newDocument=r,i}else{if(e.op==="remove")return i.removed=r,i.newDocument=null,i;if(e.op==="_get")return e.value=r,i;if(t)throw new te("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",a,e,r);return i}}else{n||(r=De(r));let o=(e.path||"").split("/"),u=r,c=1,d=o.length,f,p,m;for(typeof t=="function"?m=t:m=ss;;){if(p=o[c],p&&p.indexOf("~")!=-1&&(p=Nr(p)),s&&(p=="__proto__"||p=="prototype"&&c>0&&o[c-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(t&&f===void 0&&(u[p]===void 0?f=o.slice(0,c).join("/"):c==d-1&&(f=e.path),f!==void 0&&m(e,0,r,f)),c++,Array.isArray(u)){if(p==="-")p=u.length;else{if(t&&!ts(p))throw new te("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",a,e,r);ts(p)&&(p=~~p)}if(c>=d){if(t&&e.op==="add"&&p>u.length)throw new te("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",a,e,r);let _=Ny[e.op].call(e,u,p,r);if(_.test===!1)throw new te("Test operation failed","TEST_OPERATION_FAILED",a,e,r);return _}}else if(c>=d){let _=nr[e.op].call(e,u,p,r);if(_.test===!1)throw new te("Test operation failed","TEST_OPERATION_FAILED",a,e,r);return _}if(u=u[p],t&&c<d&&(!u||typeof u!="object"))throw new te("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",a,e,r)}}}function Bt(r,e,t,n=!0,s=!0){if(t&&!Array.isArray(e))throw new te("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");n||(r=De(r));let a=new Array(e.length);for(let i=0,o=e.length;i<o;i++)a[i]=Ft(r,e[i],t,!0,s,i),r=a[i].newDocument;return a.newDocument=r,a}function $y(r,e,t){let n=Ft(r,e);if(n.test===!1)throw new te("Test operation failed","TEST_OPERATION_FAILED",t,e,r);return n.newDocument}function ss(r,e,t,n){if(typeof r!="object"||r===null||Array.isArray(r))throw new te("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,r,t);if(nr[r.op]){if(typeof r.path!="string")throw new te("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,r,t);if(r.path.indexOf("/")!==0&&r.path.length>0)throw new te('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,r,t);if((r.op==="move"||r.op==="copy")&&typeof r.from!="string")throw new te("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,r,t);if((r.op==="add"||r.op==="replace"||r.op==="test")&&r.value===void 0)throw new te("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,r,t);if((r.op==="add"||r.op==="replace"||r.op==="test")&&es(r.value))throw new te("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,r,t);if(t){if(r.op=="add"){var s=r.path.split("/").length,a=n.split("/").length;if(s!==a+1&&s!==a)throw new te("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,r,t)}else if(r.op==="replace"||r.op==="remove"||r.op==="_get"){if(r.path!==n)throw new te("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,r,t)}else if(r.op==="move"||r.op==="copy"){var i={op:"_get",path:r.from,value:void 0},o=yl([i],t);if(o&&o.name==="OPERATION_PATH_UNRESOLVABLE")throw new te("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,r,t)}}}else throw new te("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,r,t)}function yl(r,e,t){try{if(!Array.isArray(r))throw new te("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)Bt(De(e),De(r),t||!0);else{t=t||ss;for(var n=0;n<r.length;n++)t(r[n],n,e,void 0)}}catch(s){if(s instanceof te)return s;throw s}}function $r(r,e){if(r===e)return!0;if(r&&e&&typeof r=="object"&&typeof e=="object"){var t=Array.isArray(r),n=Array.isArray(e),s,a,i;if(t&&n){if(a=r.length,a!=e.length)return!1;for(s=a;s--!==0;)if(!$r(r[s],e[s]))return!1;return!0}if(t!=n)return!1;var o=Object.keys(r);if(a=o.length,a!==Object.keys(e).length)return!1;for(s=a;s--!==0;)if(!e.hasOwnProperty(o[s]))return!1;for(s=a;s--!==0;)if(i=o[s],!$r(r[i],e[i]))return!1;return!0}return r!==r&&e!==e}var vE=g(l({},ei),{JsonPatchError:Ut,deepClone:De,escapePathComponent:rs,unescapePathComponent:Nr});var Me=class r extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}next(){return h(this,null,function*(){this.ensureReader();try{let e=yield this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}})}return(){return h(this,null,function*(){if(this.ensureReader(),this.locked){let e=this.reader.cancel();this.reader.releaseLock(),yield e}return{done:!0,value:void 0}})}throw(e){return h(this,null,function*(){if(this.ensureReader(),this.locked){let t=this.reader.cancel();this.reader.releaseLock(),yield t}throw e})}[Symbol.asyncIterator](){return this}static fromReadableStream(e){let t=e.getReader();return new r({start(n){return s();function s(){return t.read().then(({done:a,value:i})=>{if(a){n.close();return}return n.enqueue(i),s()})}},cancel(){t.releaseLock()}})}static fromAsyncGenerator(e){return new r({pull(n){return h(this,null,function*(){let{value:s,done:a}=yield e.next();a&&n.close(),n.enqueue(s)})},cancel(n){return h(this,null,function*(){yield e.return(n)})}})}};function ti(r,e=2){let t=Array.from({length:e},()=>[]);return t.map(function(s){return j(this,null,function*(){for(;;)if(s.length===0){let a=yield new v(r.next());for(let i of t)i.push(a)}else{if(s[0].done)return;yield s.shift().value}})})}function ht(r,e){if(Array.isArray(r)&&Array.isArray(e))return r.concat(e);if(typeof r=="string"&&typeof e=="string")return r+e;if(typeof r=="number"&&typeof e=="number")return r+e;if("concat"in r&&typeof r.concat=="function")return r.concat(e);if(typeof r=="object"&&typeof e=="object"){let t=l({},r);for(let[n,s]of Object.entries(e))n in t&&!Array.isArray(t[n])?t[n]=ht(t[n],s):t[n]=s;return t}else throw new Error(`Cannot concat ${typeof r} and ${typeof e}`)}var ft=class{constructor(e,t){Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e,this.setup=new Promise((n,s)=>{this.firstResult=e.next(),t?this.firstResult.then(t).then(n,s):this.firstResult.then(a=>n(void 0),s)})}next(...e){return h(this,null,function*(){return this.firstResultUsed?this.generator.next(...e):(this.firstResultUsed=!0,this.firstResult)})}return(e){return h(this,null,function*(){return this.generator.return(e)})}throw(e){return h(this,null,function*(){return this.generator.throw(e)})}[Symbol.asyncIterator](){return this}};function _l(r,e,t,...n){return h(this,null,function*(){let s=new ft(e,t),a=yield s.setup;return{output:r(s,a,...n),setup:a}})}var ze=class{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops??[]}concat(e){let t=this.ops.concat(e.ops),n=Bt({},t);return new Lr({ops:t,state:n[n.length-1].newDocument})}},Lr=class r extends ze{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){let t=this.ops.concat(e.ops),n=Bt(this.state,e.ops);return new r({ops:t,state:n[n.length-1].newDocument})}static fromRunLogPatch(e){let t=Bt({},e.ops);return new r({ops:e.ops,state:t[t.length-1].newDocument})}};function bl(r,e){return h(this,null,function*(){if(e==="original")throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");let{inputs:t}=r;if(["retriever","llm","prompt"].includes(r.run_type))return t;if(!(Object.keys(t).length===1&&t?.input===""))return t.input})}function wl(r,e){return h(this,null,function*(){let{outputs:t}=r;return e==="original"||["retriever","llm","prompt"].includes(r.run_type)?t:t!==void 0&&Object.keys(t).length===1&&t?.output!==void 0?t.output:t})}function Ly(r){return r!==void 0&&r.message!==void 0}var jr=class extends qe{constructor(e){super(l({_awaitHandler:!0},e)),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this._schemaFormat=e?._schemaFormat??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=Me.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}persistRun(e){return h(this,null,function*(){})}_includeRun(e){if(e.id===this.rootId)return!1;let t=e.tags??[],n=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(e.run_type)),this.includeTags!==void 0&&(n=n||t.find(s=>this.includeTags?.includes(s))!==void 0),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(e.run_type)),this.excludeTags!==void 0&&(n=n&&t.every(s=>!this.excludeTags?.includes(s))),n}tapOutputIterable(e,t){return j(this,null,function*(){try{for(var n=z(t),s,a,i;s=!(a=yield new v(n.next())).done;s=!1){let o=a.value;if(e!==this.rootId){let u=this.keyMapByRunId[e];u&&(yield new v(this.writer.write(new ze({ops:[{op:"add",path:`/logs/${u}/streamed_output/-`,value:o}]}))))}yield o}}catch{i=[a]}finally{try{s&&(a=n.return)&&(yield new v(a.call(n)))}finally{if(i)throw i[0]}}})}onRunCreate(e){return h(this,null,function*(){if(this.rootId===void 0&&(this.rootId=e.id,yield this.writer.write(new ze({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;this.counterMapByRunName[e.name]===void 0&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;let t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=t===1?e.name:`${e.name}:${t}`;let n={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:e.extra?.metadata??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};this._schemaFormat==="streaming_events"&&(n.inputs=yield bl(e,this._schemaFormat)),yield this.writer.write(new ze({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:n}]}))})}onRunUpdate(e){return h(this,null,function*(){try{let t=this.keyMapByRunId[e.id];if(t===void 0)return;let n=[];this._schemaFormat==="streaming_events"&&n.push({op:"replace",path:`/logs/${t}/inputs`,value:yield bl(e,this._schemaFormat)}),n.push({op:"add",path:`/logs/${t}/final_output`,value:yield wl(e,this._schemaFormat)}),e.end_time!==void 0&&n.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});let s=new ze({ops:n});yield this.writer.write(s)}finally{if(e.id===this.rootId){let t=new ze({ops:[{op:"replace",path:"/final_output",value:yield wl(e,this._schemaFormat)}]});yield this.writer.write(t),this.autoClose&&(yield this.writer.close())}}})}onLLMNewToken(e,t,n){return h(this,null,function*(){let s=this.keyMapByRunId[e.id];if(s===void 0)return;let a=e.inputs.messages!==void 0,i;a?Ly(n?.chunk)?i=n?.chunk:i=new Rt(t):i=t;let o=new ze({ops:[{op:"add",path:`/logs/${s}/streamed_output_str/-`,value:t},{op:"add",path:`/logs/${s}/streamed_output/-`,value:i}]});yield this.writer.write(o)})}};var ri=class{getStore(){}run(e,t){return t()}},ni=class{constructor(){Object.defineProperty(this,"asyncLocalStorage",{enumerable:!0,configurable:!0,writable:!0,value:new ri}),Object.defineProperty(this,"hasBeenInitialized",{enumerable:!0,configurable:!0,writable:!0,value:!1})}getInstance(){return this.asyncLocalStorage}initializeGlobalInstance(e){this.hasBeenInitialized||(this.hasBeenInitialized=!0,this.asyncLocalStorage=e)}},xt=new ni;var as=25;function Et(r){return h(this,null,function*(){return xe.configure(r?.callbacks,void 0,r?.tags,void 0,r?.metadata)})}function si(...r){let e={};for(let t of r.filter(n=>!!n))for(let n of Object.keys(t))if(n==="metadata")e[n]=l(l({},e[n]),t[n]);else if(n==="tags"){let s=e[n]??[];e[n]=[...new Set(s.concat(t[n]??[]))]}else if(n==="configurable")e[n]=l(l({},e[n]),t[n]);else if(n==="callbacks"){let s=e.callbacks,a=t.callbacks;if(Array.isArray(a))if(!s)e.callbacks=a;else if(Array.isArray(s))e.callbacks=s.concat(a);else{let i=s.copy();for(let o of a)i.addHandler(Ir(o),!0);e.callbacks=i}else if(a)if(!s)e.callbacks=a;else if(Array.isArray(s)){let i=a.copy();for(let o of s)i.addHandler(Ir(o),!0);e.callbacks=i}else e.callbacks=new xe(a._parentRunId,{handlers:s.handlers.concat(a.handlers),inheritableHandlers:s.inheritableHandlers.concat(a.inheritableHandlers),tags:Array.from(new Set(s.tags.concat(a.tags))),inheritableTags:Array.from(new Set(s.inheritableTags.concat(a.inheritableTags))),metadata:l(l({},s.metadata),a.metadata)})}else{let s=n;e[s]=t[s]??e[s]}return e}var jy=new Set(["string","number","boolean"]);function re(r){let e=r??xt.getInstance().getStore(),t={tags:[],metadata:{},callbacks:void 0,recursionLimit:25,runId:void 0};if(e&&(t=l(l({},t),e)),e?.configurable)for(let n of Object.keys(e.configurable))jy.has(typeof e.configurable[n])&&!t.metadata?.[n]&&(t.metadata||(t.metadata={}),t.metadata[n]=e.configurable[n]);return t}function Ee(r={},{callbacks:e,maxConcurrency:t,recursionLimit:n,runName:s,configurable:a,runId:i}={}){let o=re(r);return e!==void 0&&(delete o.runName,o.callbacks=e),n!==void 0&&(o.recursionLimit=n),t!==void 0&&(o.maxConcurrency=t),s!==void 0&&(o.runName=s),a!==void 0&&(o.configurable=l(l({},o.configurable),a)),i!==void 0&&delete o.runId,o}var Dr=class extends qe{constructor({config:e,onStart:t,onEnd:n,onError:s}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=t,this.argOnEnd=n,this.argOnError=s}persistRun(e){return Promise.resolve()}onRunCreate(e){return h(this,null,function*(){this.rootId||(this.rootId=e.id,this.argOnStart&&(this.argOnStart.length===1?yield this.argOnStart(e):this.argOnStart.length===2&&(yield this.argOnStart(e,this.config))))})}onRunUpdate(e){return h(this,null,function*(){e.id===this.rootId&&(e.error?this.argOnError&&(this.argOnError.length===1?yield this.argOnError(e):this.argOnError.length===2&&(yield this.argOnError(e,this.config))):this.argOnEnd&&(this.argOnEnd.length===1?yield this.argOnEnd(e):this.argOnEnd.length===2&&(yield this.argOnEnd(e,this.config))))})}};function os(r){return r?r.lc_runnable:!1}var is=class{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,t){let n=this.includeNames===void 0&&this.includeTypes===void 0&&this.includeTags===void 0,s=e.tags??[];return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(t)),this.includeTags!==void 0&&(n=n||s.some(a=>this.includeTags?.includes(a))),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(t)),this.excludeTags!==void 0&&(n=n&&s.every(a=>!this.excludeTags?.includes(a))),n}};var xl=Symbol("Let zodToJsonSchema decide on which parser to use");var vl={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},El=r=>typeof r=="string"?g(l({},vl),{name:r}):l(l({},vl),r);var Ol=r=>{let e=El(r),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return g(l({},e),{flags:{hasReferencedOpenAiAnyType:!1},currentPath:t,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([n,s])=>[s._def,{def:s._def,path:[...e.basePath,e.definitionPath,n],jsonSchema:void 0}]))})};function ai(r,e,t,n){n?.errorMessages&&t&&(r.errorMessage=g(l({},r.errorMessage),{[e]:t}))}function J(r,e,t,n,s){r[e]=t,ai(r,e,n,s)}var us=(r,e)=>{let t=0;for(;t<r.length&&t<e.length&&r[t]===e[t];t++);return[(r.length-t).toString(),...e.slice(t)].join("/")};function Y(r){if(r.target!=="openAi")return{};let e=[...r.basePath,r.definitionPath,r.openAiAnyTypeName];return r.flags.hasReferencedOpenAiAnyType=!0,{$ref:r.$refStrategy==="relative"?us(e,r.currentPath):e.join("/")}}function Tl(r,e){let t={type:"array"};return r.type?._def&&r.type?._def?.typeName!==E.ZodAny&&(t.items=L(r.type._def,g(l({},e),{currentPath:[...e.currentPath,"items"]}))),r.minLength&&J(t,"minItems",r.minLength.value,r.minLength.message,e),r.maxLength&&J(t,"maxItems",r.maxLength.value,r.maxLength.message,e),r.exactLength&&(J(t,"minItems",r.exactLength.value,r.exactLength.message,e),J(t,"maxItems",r.exactLength.value,r.exactLength.message,e)),t}function Sl(r,e){let t={type:"integer",format:"int64"};if(!r.checks)return t;for(let n of r.checks)switch(n.kind){case"min":e.target==="jsonSchema7"?n.inclusive?J(t,"minimum",n.value,n.message,e):J(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),J(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?J(t,"maximum",n.value,n.message,e):J(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),J(t,"maximum",n.value,n.message,e));break;case"multipleOf":J(t,"multipleOf",n.value,n.message,e);break}return t}function Al(){return{type:"boolean"}}function cs(r,e){return L(r.type._def,e)}var Rl=(r,e)=>L(r.innerType._def,e);function ii(r,e,t){let n=t??e.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((s,a)=>ii(r,e,s))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return Dy(r,e)}}var Dy=(r,e)=>{let t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(let n of r.checks)switch(n.kind){case"min":J(t,"minimum",n.value,n.message,e);break;case"max":J(t,"maximum",n.value,n.message,e);break}return t};function kl(r,e){return g(l({},L(r.innerType._def,e)),{default:r.defaultValue()})}function Cl(r,e){return e.effectStrategy==="input"?L(r.schema._def,e):Y(e)}function Pl(r){return{type:"string",enum:Array.from(r.values)}}var My=r=>"type"in r&&r.type==="string"?!1:"allOf"in r;function Il(r,e){let t=[L(r.left._def,g(l({},e),{currentPath:[...e.currentPath,"allOf","0"]})),L(r.right._def,g(l({},e),{currentPath:[...e.currentPath,"allOf","1"]}))].filter(a=>!!a),n=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0,s=[];return t.forEach(a=>{if(My(a))s.push(...a.allOf),a.unevaluatedProperties===void 0&&(n=void 0);else{let o=a;if("additionalProperties"in a&&a.additionalProperties===!1){let i=a,{additionalProperties:u}=i;o=he(i,["additionalProperties"])}else n=void 0;s.push(o)}}),s.length?l({allOf:s},n):void 0}function Nl(r,e){let t=typeof r.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(r.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[r.value]}:{type:t==="bigint"?"integer":t,const:r.value}}var oi,Ze={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(oi===void 0&&(oi=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),oi),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function ls(r,e){let t={type:"string"};if(r.checks)for(let n of r.checks)switch(n.kind){case"min":J(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,n.value):n.value,n.message,e);break;case"max":J(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,n.value):n.value,n.message,e);break;case"email":switch(e.emailStrategy){case"format:email":Ve(t,"email",n.message,e);break;case"format:idn-email":Ve(t,"idn-email",n.message,e);break;case"pattern:zod":Oe(t,Ze.email,n.message,e);break}break;case"url":Ve(t,"uri",n.message,e);break;case"uuid":Ve(t,"uuid",n.message,e);break;case"regex":Oe(t,n.regex,n.message,e);break;case"cuid":Oe(t,Ze.cuid,n.message,e);break;case"cuid2":Oe(t,Ze.cuid2,n.message,e);break;case"startsWith":Oe(t,RegExp(`^${ui(n.value,e)}`),n.message,e);break;case"endsWith":Oe(t,RegExp(`${ui(n.value,e)}$`),n.message,e);break;case"datetime":Ve(t,"date-time",n.message,e);break;case"date":Ve(t,"date",n.message,e);break;case"time":Ve(t,"time",n.message,e);break;case"duration":Ve(t,"duration",n.message,e);break;case"length":J(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,n.value):n.value,n.message,e),J(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,n.value):n.value,n.message,e);break;case"includes":{Oe(t,RegExp(ui(n.value,e)),n.message,e);break}case"ip":{n.version!=="v6"&&Ve(t,"ipv4",n.message,e),n.version!=="v4"&&Ve(t,"ipv6",n.message,e);break}case"base64url":Oe(t,Ze.base64url,n.message,e);break;case"jwt":Oe(t,Ze.jwt,n.message,e);break;case"cidr":{n.version!=="v6"&&Oe(t,Ze.ipv4Cidr,n.message,e),n.version!=="v4"&&Oe(t,Ze.ipv6Cidr,n.message,e);break}case"emoji":Oe(t,Ze.emoji(),n.message,e);break;case"ulid":{Oe(t,Ze.ulid,n.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{Ve(t,"binary",n.message,e);break}case"contentEncoding:base64":{J(t,"contentEncoding","base64",n.message,e);break}case"pattern:zod":{Oe(t,Ze.base64,n.message,e);break}}break}case"nanoid":Oe(t,Ze.nanoid,n.message,e);case"toLowerCase":case"toUpperCase":case"trim":break;default:}return t}function ui(r,e){return e.patternStrategy==="escape"?Fy(r):r}var Uy=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function Fy(r){let e="";for(let t=0;t<r.length;t++)Uy.has(r[t])||(e+="\\"),e+=r[t];return e}function Ve(r,e,t,n){r.format||r.anyOf?.some(s=>s.format)?(r.anyOf||(r.anyOf=[]),r.format&&(r.anyOf.push(l({format:r.format},r.errorMessage&&n.errorMessages&&{errorMessage:{format:r.errorMessage.format}})),delete r.format,r.errorMessage&&(delete r.errorMessage.format,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.anyOf.push(l({format:e},t&&n.errorMessages&&{errorMessage:{format:t}}))):J(r,"format",e,t,n)}function Oe(r,e,t,n){r.pattern||r.allOf?.some(s=>s.pattern)?(r.allOf||(r.allOf=[]),r.pattern&&(r.allOf.push(l({pattern:r.pattern},r.errorMessage&&n.errorMessages&&{errorMessage:{pattern:r.errorMessage.pattern}})),delete r.pattern,r.errorMessage&&(delete r.errorMessage.pattern,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.allOf.push(l({pattern:$l(e,n)},t&&n.errorMessages&&{errorMessage:{pattern:t}}))):J(r,"pattern",$l(e,n),t,n)}function $l(r,e){if(!e.applyRegexFlags||!r.flags)return r.source;let t={i:r.flags.includes("i"),m:r.flags.includes("m"),s:r.flags.includes("s")},n=t.i?r.source.toLowerCase():r.source,s="",a=!1,i=!1,o=!1;for(let u=0;u<n.length;u++){if(a){s+=n[u],a=!1;continue}if(t.i){if(i){if(n[u].match(/[a-z]/)){o?(s+=n[u],s+=`${n[u-2]}-${n[u]}`.toUpperCase(),o=!1):n[u+1]==="-"&&n[u+2]?.match(/[a-z]/)?(s+=n[u],o=!0):s+=`${n[u]}${n[u].toUpperCase()}`;continue}}else if(n[u].match(/[a-z]/)){s+=`[${n[u]}${n[u].toUpperCase()}]`;continue}}if(t.m){if(n[u]==="^"){s+=`(^|(?<=[\r
]))`;continue}else if(n[u]==="$"){s+=`($|(?=[\r
]))`;continue}}if(t.s&&n[u]==="."){s+=i?`${n[u]}\r
`:`[${n[u]}\r
]`;continue}s+=n[u],n[u]==="\\"?a=!0:i&&n[u]==="]"?i=!1:!i&&n[u]==="["&&(i=!0)}try{new RegExp(s)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),r.source}return s}function ds(r,e){if(e.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),e.target==="openApi3"&&r.keyType?._def.typeName===E.ZodEnum)return{type:"object",required:r.keyType._def.values,properties:r.keyType._def.values.reduce((a,i)=>g(l({},a),{[i]:L(r.valueType._def,g(l({},e),{currentPath:[...e.currentPath,"properties",i]}))??Y(e)}),{}),additionalProperties:e.rejectedAdditionalProperties};let t={type:"object",additionalProperties:L(r.valueType._def,g(l({},e),{currentPath:[...e.currentPath,"additionalProperties"]}))??e.allowedAdditionalProperties};if(e.target==="openApi3")return t;if(r.keyType?._def.typeName===E.ZodString&&r.keyType._def.checks?.length){let n=ls(r.keyType._def,e),{type:a}=n,i=he(n,["type"]);return g(l({},t),{propertyNames:i})}else{if(r.keyType?._def.typeName===E.ZodEnum)return g(l({},t),{propertyNames:{enum:r.keyType._def.values}});if(r.keyType?._def.typeName===E.ZodBranded&&r.keyType._def.type._def.typeName===E.ZodString&&r.keyType._def.type._def.checks?.length){let s=cs(r.keyType._def,e),{type:a}=s,i=he(s,["type"]);return g(l({},t),{propertyNames:i})}}return t}function Ll(r,e){if(e.mapStrategy==="record")return ds(r,e);let t=L(r.keyType._def,g(l({},e),{currentPath:[...e.currentPath,"items","items","0"]}))||Y(e),n=L(r.valueType._def,g(l({},e),{currentPath:[...e.currentPath,"items","items","1"]}))||Y(e);return{type:"array",maxItems:125,items:{type:"array",items:[t,n],minItems:2,maxItems:2}}}function jl(r){let e=r.values,n=Object.keys(r.values).filter(a=>typeof e[e[a]]!="number").map(a=>e[a]),s=Array.from(new Set(n.map(a=>typeof a)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:n}}function Dl(r){return r.target==="openAi"?void 0:{not:Y(g(l({},r),{currentPath:[...r.currentPath,"not"]}))}}function Ml(r){return r.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}var Mr={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function Fl(r,e){if(e.target==="openApi3")return Ul(r,e);let t=r.options instanceof Map?Array.from(r.options.values()):r.options;if(t.every(n=>n._def.typeName in Mr&&(!n._def.checks||!n._def.checks.length))){let n=t.reduce((s,a)=>{let i=Mr[a._def.typeName];return i&&!s.includes(i)?[...s,i]:s},[]);return{type:n.length>1?n:n[0]}}else if(t.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){let n=t.reduce((s,a)=>{let i=typeof a._def.value;switch(i){case"string":case"number":case"boolean":return[...s,i];case"bigint":return[...s,"integer"];case"object":if(a._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(n.length===t.length){let s=n.filter((a,i,o)=>o.indexOf(a)===i);return{type:s.length>1?s:s[0],enum:t.reduce((a,i)=>a.includes(i._def.value)?a:[...a,i._def.value],[])}}}else if(t.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((n,s)=>[...n,...s._def.values.filter(a=>!n.includes(a))],[])};return Ul(r,e)}var Ul=(r,e)=>{let t=(r.options instanceof Map?Array.from(r.options.values()):r.options).map((n,s)=>L(n._def,g(l({},e),{currentPath:[...e.currentPath,"anyOf",`${s}`]}))).filter(n=>!!n&&(!e.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return t.length?{anyOf:t}:void 0};function Bl(r,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(r.innerType._def.typeName)&&(!r.innerType._def.checks||!r.innerType._def.checks.length))return e.target==="openApi3"?{type:Mr[r.innerType._def.typeName],nullable:!0}:{type:[Mr[r.innerType._def.typeName],"null"]};if(e.target==="openApi3"){let n=L(r.innerType._def,g(l({},e),{currentPath:[...e.currentPath]}));return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&g(l({},n),{nullable:!0})}let t=L(r.innerType._def,g(l({},e),{currentPath:[...e.currentPath,"anyOf","0"]}));return t&&{anyOf:[t,{type:"null"}]}}function ql(r,e){let t={type:"number"};if(!r.checks)return t;for(let n of r.checks)switch(n.kind){case"int":t.type="integer",ai(t,"type",n.message,e);break;case"min":e.target==="jsonSchema7"?n.inclusive?J(t,"minimum",n.value,n.message,e):J(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),J(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?J(t,"maximum",n.value,n.message,e):J(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),J(t,"maximum",n.value,n.message,e));break;case"multipleOf":J(t,"multipleOf",n.value,n.message,e);break}return t}function Hl(r,e){let t=e.target==="openAi",n={type:"object",properties:{}},s=[],a=r.shape();for(let o in a){let u=a[o];if(u===void 0||u._def===void 0)continue;let c=qy(u);c&&t&&(u._def.typeName==="ZodOptional"&&(u=u._def.innerType),u.isNullable()||(u=u.nullable()),c=!1);let d=L(u._def,g(l({},e),{currentPath:[...e.currentPath,"properties",o],propertyPath:[...e.currentPath,"properties",o]}));d!==void 0&&(n.properties[o]=d,c||s.push(o))}s.length&&(n.required=s);let i=By(r,e);return i!==void 0&&(n.additionalProperties=i),n}function By(r,e){if(r.catchall._def.typeName!=="ZodNever")return L(r.catchall._def,g(l({},e),{currentPath:[...e.currentPath,"additionalProperties"]}));switch(r.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function qy(r){try{return r.isOptional()}catch{return!0}}var zl=(r,e)=>{if(e.currentPath.toString()===e.propertyPath?.toString())return L(r.innerType._def,e);let t=L(r.innerType._def,g(l({},e),{currentPath:[...e.currentPath,"anyOf","1"]}));return t?{anyOf:[{not:Y(e)},t]}:Y(e)};var Zl=(r,e)=>{if(e.pipeStrategy==="input")return L(r.in._def,e);if(e.pipeStrategy==="output")return L(r.out._def,e);let t=L(r.in._def,g(l({},e),{currentPath:[...e.currentPath,"allOf","0"]})),n=L(r.out._def,g(l({},e),{currentPath:[...e.currentPath,"allOf",t?"1":"0"]}));return{allOf:[t,n].filter(s=>s!==void 0)}};function Vl(r,e){return L(r.type._def,e)}function Gl(r,e){let n={type:"array",uniqueItems:!0,items:L(r.valueType._def,g(l({},e),{currentPath:[...e.currentPath,"items"]}))};return r.minSize&&J(n,"minItems",r.minSize.value,r.minSize.message,e),r.maxSize&&J(n,"maxItems",r.maxSize.value,r.maxSize.message,e),n}function Jl(r,e){return r.rest?{type:"array",minItems:r.items.length,items:r.items.map((t,n)=>L(t._def,g(l({},e),{currentPath:[...e.currentPath,"items",`${n}`]}))).reduce((t,n)=>n===void 0?t:[...t,n],[]),additionalItems:L(r.rest._def,g(l({},e),{currentPath:[...e.currentPath,"additionalItems"]}))}:{type:"array",minItems:r.items.length,maxItems:r.items.length,items:r.items.map((t,n)=>L(t._def,g(l({},e),{currentPath:[...e.currentPath,"items",`${n}`]}))).reduce((t,n)=>n===void 0?t:[...t,n],[])}}function Wl(r){return{not:Y(r)}}function Kl(r){return Y(r)}var Xl=(r,e)=>L(r.innerType._def,e);var Yl=(r,e,t)=>{switch(e){case E.ZodString:return ls(r,t);case E.ZodNumber:return ql(r,t);case E.ZodObject:return Hl(r,t);case E.ZodBigInt:return Sl(r,t);case E.ZodBoolean:return Al();case E.ZodDate:return ii(r,t);case E.ZodUndefined:return Wl(t);case E.ZodNull:return Ml(t);case E.ZodArray:return Tl(r,t);case E.ZodUnion:case E.ZodDiscriminatedUnion:return Fl(r,t);case E.ZodIntersection:return Il(r,t);case E.ZodTuple:return Jl(r,t);case E.ZodRecord:return ds(r,t);case E.ZodLiteral:return Nl(r,t);case E.ZodEnum:return Pl(r);case E.ZodNativeEnum:return jl(r);case E.ZodNullable:return Bl(r,t);case E.ZodOptional:return zl(r,t);case E.ZodMap:return Ll(r,t);case E.ZodSet:return Gl(r,t);case E.ZodLazy:return()=>r.getter()._def;case E.ZodPromise:return Vl(r,t);case E.ZodNaN:case E.ZodNever:return Dl(t);case E.ZodEffects:return Cl(r,t);case E.ZodAny:return Y(t);case E.ZodUnknown:return Kl(t);case E.ZodDefault:return kl(r,t);case E.ZodBranded:return cs(r,t);case E.ZodReadonly:return Xl(r,t);case E.ZodCatch:return Rl(r,t);case E.ZodPipeline:return Zl(r,t);case E.ZodFunction:case E.ZodVoid:case E.ZodSymbol:return;default:return(n=>{})(e)}};function L(r,e,t=!1){let n=e.seen.get(r);if(e.override){let o=e.override?.(r,e,n,t);if(o!==xl)return o}if(n&&!t){let o=Hy(n,e);if(o!==void 0)return o}let s={def:r,path:e.currentPath,jsonSchema:void 0};e.seen.set(r,s);let a=Yl(r,r.typeName,e),i=typeof a=="function"?L(a(),e):a;if(i&&zy(r,e,i),e.postProcess){let o=e.postProcess(i,r,e);return s.jsonSchema=i,o}return s.jsonSchema=i,i}var Hy=(r,e)=>{switch(e.$refStrategy){case"root":return{$ref:r.path.join("/")};case"relative":return{$ref:us(e.currentPath,r.path)};case"none":case"seen":return r.path.length<e.currentPath.length&&r.path.every((t,n)=>e.currentPath[n]===t)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),Y(e)):e.$refStrategy==="seen"?Y(e):void 0}},zy=(r,e,t)=>(r.description&&(t.description=r.description,e.markdownDescription&&(t.markdownDescription=r.description)),t);var ci=(r,e)=>{let t=Ol(e),n=typeof e=="object"&&e.definitions?Object.entries(e.definitions).reduce((u,[c,d])=>g(l({},u),{[c]:L(d._def,g(l({},t),{currentPath:[...t.basePath,t.definitionPath,c]}),!0)??Y(t)}),{}):void 0,s=typeof e=="string"?e:e?.nameStrategy==="title"?void 0:e?.name,a=L(r._def,s===void 0?t:g(l({},t),{currentPath:[...t.basePath,t.definitionPath,s]}),!1)??Y(t),i=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;i!==void 0&&(a.title=i),t.flags.hasReferencedOpenAiAnyType&&(n||(n={}),n[t.openAiAnyTypeName]||(n[t.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:t.$refStrategy==="relative"?"1":[...t.basePath,t.definitionPath,t.openAiAnyTypeName].join("/")}}));let o=s===void 0?n?g(l({},a),{[t.definitionPath]:n}):a:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,s].join("/"),[t.definitionPath]:g(l({},n),{[s]:a})};return t.target==="jsonSchema7"?o.$schema="http://json-schema.org/draft-07/schema#":(t.target==="jsonSchema2019-09"||t.target==="openAi")&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),t.target==="openAi"&&("anyOf"in o||"oneOf"in o||"allOf"in o||"type"in o&&Array.isArray(o.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),o};function Zy(r){return os(r.data)?{type:"runnable",data:{id:r.data.lc_id,name:r.data.getName()}}:{type:"schema",data:g(l({},ci(r.data.schema)),{title:r.data.name})}}var Ur=class{constructor(){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]})}toJSON(){let e={};return Object.values(this.nodes).forEach((t,n)=>{e[t.id]=da(t.id)?n:t.id}),{nodes:Object.values(this.nodes).map(t=>l({id:e[t.id]},Zy(t))),edges:this.edges.map(t=>t.data?{source:e[t.source],target:e[t.target],data:t.data}:{source:e[t.source],target:e[t.target]})}}addNode(e,t){if(t!==void 0&&this.nodes[t]!==void 0)throw new Error(`Node with id ${t} already exists`);let n=t||Ne(),s={id:n,data:e};return this.nodes[n]=s,s}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(t=>t.source!==e.id&&t.target!==e.id)}addEdge(e,t,n){if(this.nodes[e.id]===void 0)throw new Error(`Source node ${e.id} not in graph`);if(this.nodes[t.id]===void 0)throw new Error(`Target node ${t.id} not in graph`);let s={source:e.id,target:t.id,data:n};return this.edges.push(s),s}firstNode(){let e=new Set(this.edges.map(n=>n.target)),t=[];return Object.values(this.nodes).forEach(n=>{e.has(n.id)||t.push(n)}),t[0]}lastNode(){let e=new Set(this.edges.map(n=>n.source)),t=[];return Object.values(this.nodes).forEach(n=>{e.has(n.id)||t.push(n)}),t[0]}extend(e){Object.entries(e.nodes).forEach(([t,n])=>{this.nodes[t]=n}),this.edges=[...this.edges,...e.edges]}trimFirstNode(){let e=this.firstNode();if(e){let t=this.edges.filter(n=>n.source===e.id);(Object.keys(this.nodes).length===1||t.length===1)&&this.removeNode(e)}}trimLastNode(){let e=this.lastNode();if(e){let t=this.edges.filter(n=>n.target===e.id);(Object.keys(this.nodes).length===1||t.length===1)&&this.removeNode(e)}}};function Ql(r){let e=new TextEncoder,t=new ReadableStream({start(s){return h(this,null,function*(){try{for(var a=z(r),i,o,u;i=!(o=yield a.next()).done;i=!1){let c=o.value;s.enqueue(e.encode(`event: data
data: ${JSON.stringify(c)}

`))}}catch{u=[o]}finally{try{i&&(o=a.return)&&(yield o.call(a))}finally{if(u)throw u[0]}}s.enqueue(e.encode(`event: end

`)),s.close()})}});return Me.fromReadableStream(t)}function li(r){return typeof r=="object"&&r!==null&&typeof r[Symbol.iterator]=="function"&&typeof r.next=="function"}function di(r){return typeof r=="object"&&r!==null&&typeof r[Symbol.asyncIterator]=="function"}function*fi(r,e){let t=xt.getInstance();for(;;){let{value:n,done:s}=t.run(r,e.next.bind(e));if(s)break;yield n}}function hi(r,e){return j(this,null,function*(){let t=xt.getInstance(),n=e[Symbol.asyncIterator]();for(;;){let{value:s,done:a}=yield new v(t.run(r,n.next.bind(e)));if(a)break;yield s}})}function ye(r,e){return r&&!Array.isArray(r)&&!(r instanceof Date)&&typeof r=="object"?r:{[e]:r}}var fe=class extends Ue{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){let t=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${t}${e}`:t}bind(e){return new sr({bound:this,kwargs:e,config:{}})}map(){return new mi({bound:this})}withRetry(e){return new gi(l({bound:this,kwargs:{},config:{},maxAttemptNumber:e?.stopAfterAttempt},e))}withConfig(e){return new sr({bound:this,config:e,kwargs:{}})}withFallbacks(e){return new bi({runnable:this,fallbacks:e.fallbacks})}_getOptionsList(e,t=0){if(Array.isArray(e)&&e.length!==t)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);if(Array.isArray(e))return e.map(re);if(t>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");let n=Object.fromEntries(Object.entries(e).filter(([s])=>s!=="runId"));return Array.from({length:t},(s,a)=>re(a===0?e:n))}return Array.from({length:t},()=>re(e))}batch(e,t,n){return h(this,null,function*(){let s=this._getOptionsList(t??{},e.length),a=s[0]?.maxConcurrency??n?.maxConcurrency,i=new yt({maxConcurrency:a,onFailedAttempt:u=>{throw u}}),o=e.map((u,c)=>i.call(()=>h(this,null,function*(){try{return yield this.invoke(u,s[c])}catch(d){if(n?.returnExceptions)return d;throw d}})));return Promise.all(o)})}_streamIterator(e,t){return j(this,null,function*(){yield this.invoke(e,t)})}stream(e,t){return h(this,null,function*(){let n=new ft(this._streamIterator(e,re(t)));return yield n.setup,Me.fromAsyncGenerator(n)})}_separateRunnableConfigFromCallOptions(e){let t;e===void 0?t=re(e):t=re({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId});let n=l({},e);return delete n.callbacks,delete n.tags,delete n.metadata,delete n.runName,delete n.configurable,delete n.recursionLimit,delete n.maxConcurrency,delete n.runId,[t,n]}_callWithConfig(e,t,n){return h(this,null,function*(){let s=re(n),i=yield(yield Et(s))?.handleChainStart(this.toJSON(),ye(t,"input"),s.runId,s?.runType,void 0,void 0,s?.runName??this.getName());delete s.runId;let o;try{o=yield e.call(this,t,s,i)}catch(u){throw yield i?.handleChainError(u),u}return yield i?.handleChainEnd(ye(o,"output")),o})}_batchWithConfig(e,t,n,s){return h(this,null,function*(){let a=this._getOptionsList(n??{},t.length),i=yield Promise.all(a.map(Et)),o=yield Promise.all(i.map((c,d)=>h(this,null,function*(){let f=yield c?.handleChainStart(this.toJSON(),ye(t[d],"input"),a[d].runId,a[d].runType,void 0,void 0,a[d].runName??this.getName());return delete a[d].runId,f}))),u;try{u=yield e.call(this,t,a,o,s)}catch(c){throw yield Promise.all(o.map(d=>d?.handleChainError(c))),c}return yield Promise.all(o.map(c=>c?.handleChainEnd(ye(u,"output")))),u})}_transformStreamWithConfig(e,t,n){return j(this,null,function*(){let s,a=!0,i,o=!0,u=re(n),c=yield new v(Et(u));function d(){return j(this,null,function*(){try{for(var b=z(e),T,A,M;T=!(A=yield new v(b.next())).done;T=!1){let $=A.value;if(a)if(s===void 0)s=$;else try{s=ht(s,$)}catch{s=void 0,a=!1}yield $}}catch{M=[A]}finally{try{T&&(A=b.return)&&(yield new v(A.call(b)))}finally{if(M)throw M[0]}}})}let f;try{let b=yield new v(_l(t.bind(this),d(),()=>h(this,null,function*(){return c?.handleChainStart(this.toJSON(),{input:""},u.runId,u.runType,void 0,void 0,u.runName??this.getName())}),u));delete u.runId,f=b.setup;let T=$=>$.name==="log_stream_tracer",A=f?.handlers.find(T),M=b.output;A!==void 0&&f!==void 0&&(M=yield new v(A.tapOutputIterable(f.runId,b.output)));try{for(var p=z(M),m,_,w;m=!(_=yield new v(p.next())).done;m=!1){let $=_.value;if(yield $,o)if(i===void 0)i=$;else try{i=ht(i,$)}catch{i=void 0,o=!1}}}catch{w=[_]}finally{try{m&&(_=p.return)&&(yield new v(_.call(p)))}finally{if(w)throw w[0]}}}catch(b){throw yield new v(f?.handleChainError(b,void 0,void 0,void 0,{inputs:ye(s,"input")})),b}yield new v(f?.handleChainEnd(i??{},void 0,void 0,void 0,{inputs:ye(s,"input")}))})}getGraph(e){let t=new Ur,n=t.addNode({name:`${this.getName()}Input`,schema:vr.any()}),s=t.addNode(this),a=t.addNode({name:`${this.getName()}Output`,schema:vr.any()});return t.addEdge(n,s),t.addEdge(s,a),t}pipe(e){return new yi({first:this,last:qt(e)})}pick(e){return this.pipe(new vi(e))}assign(e){return this.pipe(new wi(new Fr({steps:e})))}transform(e,t){return j(this,null,function*(){let n;try{for(var s=z(e),a,i,o;a=!(i=yield new v(s.next())).done;a=!1){let u=i.value;n===void 0?n=u:n=ht(n,u)}}catch{o=[i]}finally{try{a&&(i=s.return)&&(yield new v(i.call(s)))}finally{if(o)throw o[0]}}yield*ee(this._streamIterator(n,re(t)))})}streamLog(e,t,n){return j(this,null,function*(){let s=new jr(g(l({},n),{autoClose:!1,_schemaFormat:"original"})),a=re(t);yield*ee(this._streamLog(e,s,a))})}_streamLog(e,t,n){return j(this,null,function*(){let{callbacks:s}=n;if(s===void 0)n.callbacks=[t];else if(Array.isArray(s))n.callbacks=s.concat([t]);else{let p=s.copy();p.inheritableHandlers.push(t),n.callbacks=p}let a=this.stream(e,n);function i(){return h(this,null,function*(){try{let b=yield a;try{for(var p=z(b),m,_,w;m=!(_=yield p.next()).done;m=!1){let T=_.value;let A=new ze({ops:[{op:"add",path:"/streamed_output/-",value:T}]});yield t.writer.write(A)}}catch{w=[_]}finally{try{m&&(_=p.return)&&(yield _.call(p))}finally{if(w)throw w[0]}}}finally{yield t.writer.close()}})}let o=i();try{try{for(var u=z(t),c,d,f;c=!(d=yield new v(u.next())).done;c=!1){let p=d.value;yield p}}catch{f=[d]}finally{try{c&&(d=u.return)&&(yield new v(d.call(u)))}finally{if(f)throw f[0]}}}finally{yield new v(o)}})}streamEvents(e,t,n){return j(this,null,function*(){if(t.encoding==="text/event-stream"){let s=yield new v(this._streamEvents(e,t,n));yield*ee(Ql(s))}else yield*ee(this._streamEvents(e,t,n))})}_streamEvents(e,t,n){return j(this,null,function*(){if(t.version!=="v1")throw new Error('Only version "v1" of the events schema is currently supported.');let s,a=!1,i=re(t),o=i.tags??[],u=i.metadata??{},c=i.runName??this.getName(),d=new jr(g(l({},n),{autoClose:!1,_schemaFormat:"streaming_events"})),f=new is(l({},n)),p=this._streamLog(e,d,i);try{for(var _=z(p),w,b,T;w=!(b=yield new v(_.next())).done;w=!1){let A=b.value;if(s?s=s.concat(A):s=Lr.fromRunLogPatch(A),s.state===void 0)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!a){a=!0;let K=l({},s.state),W={run_id:K.id,event:`on_${K.type}_start`,name:c,tags:o,metadata:u,data:{input:e}};f.includeEvent(W,K.type)&&(yield W)}let M=A.ops.filter(K=>K.path.startsWith("/logs/")).map(K=>K.path.split("/")[2]),$=[...new Set(M)];for(let K of $){let W,ae={},ne=s.state.logs[K];if(ne.end_time===void 0?ne.streamed_output.length>0?W="stream":W="start":W="end",W==="start")ne.inputs!==void 0&&(ae.input=ne.inputs);else if(W==="end")ne.inputs!==void 0&&(ae.input=ne.inputs),ae.output=ne.final_output;else if(W==="stream"){let hr=ne.streamed_output.length;if(hr!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${hr} instead. Encountered in: "${ne.name}"`);ae={chunk:ne.streamed_output[0]},ne.streamed_output=[]}yield{event:`on_${ne.type}_${W}`,name:ne.name,run_id:ne.id,tags:ne.tags,metadata:ne.metadata,data:ae}}let{state:B}=s;if(B.streamed_output.length>0){let K=B.streamed_output.length;if(K!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${K} instead. Encountered in: "${B.name}"`);let W={chunk:B.streamed_output[0]};B.streamed_output=[];let ae={event:`on_${B.type}_stream`,run_id:B.id,tags:o,metadata:u,name:c,data:W};f.includeEvent(ae,B.type)&&(yield ae)}}}catch{T=[b]}finally{try{w&&(b=_.return)&&(yield new v(b.call(_)))}finally{if(T)throw T[0]}}let m=s?.state;if(m!==void 0){let A={event:`on_${m.type}_end`,name:c,run_id:m.id,tags:o,metadata:u,data:{output:m.final_output}};f.includeEvent(A,m.type)&&(yield A)}})}static isRunnable(e){return os(e)}withListeners({onStart:e,onEnd:t,onError:n}){return new sr({bound:this,config:{},configFactories:[s=>({callbacks:[new Dr({config:s,onStart:e,onEnd:t,onError:n})]})]})}},sr=class r extends fe{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}_mergeConfig(...e){return h(this,null,function*(){let t=si(this.config,...e);return si(t,...this.configFactories?yield Promise.all(this.configFactories.map(n=>h(this,null,function*(){return yield n(t)}))):[])})}bind(e){return new this.constructor({bound:this.bound,kwargs:l(l({},this.kwargs),e),config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:l(l({},this.config),e)})}withRetry(e){return new this.constructor({bound:this.bound.withRetry(e),kwargs:this.kwargs,config:this.config})}invoke(e,t){return h(this,null,function*(){return this.bound.invoke(e,yield this._mergeConfig(re(t),this.kwargs))})}batch(e,t,n){return h(this,null,function*(){let s=Array.isArray(t)?yield Promise.all(t.map(a=>h(this,null,function*(){return this._mergeConfig(re(a),this.kwargs)}))):yield this._mergeConfig(re(t),this.kwargs);return this.bound.batch(e,s,n)})}_streamIterator(e,t){return j(this,null,function*(){yield*ee(this.bound._streamIterator(e,yield new v(this._mergeConfig(re(t),this.kwargs))))})}stream(e,t){return h(this,null,function*(){return this.bound.stream(e,yield this._mergeConfig(re(t),this.kwargs))})}transform(e,t){return j(this,null,function*(){yield*ee(this.bound.transform(e,yield new v(this._mergeConfig(re(t),this.kwargs))))})}streamEvents(e,t,n){return j(this,null,function*(){yield*ee(this.bound.streamEvents(e,g(l({},yield new v(this._mergeConfig(re(t),this.kwargs))),{version:t.version}),n))})}static isRunnableBinding(e){return e.bound&&fe.isRunnable(e.bound)}withListeners({onStart:e,onEnd:t,onError:n}){return new r({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[s=>({callbacks:[new Dr({config:s,onStart:e,onEnd:t,onError:n})]})]})}},mi=class r extends fe{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new r({bound:this.bound.bind(e)})}invoke(e,t){return h(this,null,function*(){return this._callWithConfig(this._invoke,e,t)})}_invoke(e,t,n){return h(this,null,function*(){return this.bound.batch(e,Ee(t,{callbacks:n?.getChild()}))})}withListeners({onStart:e,onEnd:t,onError:n}){return new r({bound:this.bound.withListeners({onStart:e,onEnd:t,onError:n})})}},gi=class r extends sr{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,n){let s=e>1?`retry:attempt:${e}`:void 0;return Ee(t,{callbacks:n?.getChild(s)})}_invoke(e,t,n){return h(this,null,function*(){return(0,pi.default)(s=>Ps(r.prototype,this,"invoke").call(this,e,this._patchConfigForRetry(s,t,n)),{onFailedAttempt:s=>this.onFailedAttempt(s,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})})}invoke(e,t){return h(this,null,function*(){return this._callWithConfig(this._invoke,e,t)})}_batch(e,t,n,s){return h(this,null,function*(){let a={};try{yield(0,pi.default)(i=>h(this,null,function*(){let o=e.map((p,m)=>m).filter(p=>a[p.toString()]===void 0||a[p.toString()]instanceof Error),u=o.map(p=>e[p]),c=o.map(p=>this._patchConfigForRetry(i,t?.[p],n?.[p])),d=yield Ps(r.prototype,this,"batch").call(this,u,c,g(l({},s),{returnExceptions:!0})),f;for(let p=0;p<d.length;p+=1){let m=d[p],_=o[p];m instanceof Error&&f===void 0&&(f=m,f.input=u[p]),a[_.toString()]=m}if(f)throw f;return d}),{onFailedAttempt:i=>this.onFailedAttempt(i,i.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(i){if(s?.returnExceptions!==!0)throw i}return Object.keys(a).sort((i,o)=>parseInt(i,10)-parseInt(o,10)).map(i=>a[parseInt(i,10)])})}batch(e,t,n){return h(this,null,function*(){return this._batchWithConfig(this._batch.bind(this),e,t,n)})}},yi=class r extends fe{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name}get steps(){return[this.first,...this.middle,this.last]}invoke(e,t){return h(this,null,function*(){let n=re(t),a=yield(yield Et(n))?.handleChainStart(this.toJSON(),ye(e,"input"),n.runId,void 0,void 0,void 0,n?.runName);delete n.runId;let i=e,o;try{let u=[this.first,...this.middle];for(let c=0;c<u.length;c+=1)i=yield u[c].invoke(i,Ee(n,{callbacks:a?.getChild(`seq:step:${c+1}`)}));o=yield this.last.invoke(i,Ee(n,{callbacks:a?.getChild(`seq:step:${this.steps.length}`)}))}catch(u){throw yield a?.handleChainError(u),u}return yield a?.handleChainEnd(ye(o,"output")),o})}batch(e,t,n){return h(this,null,function*(){let s=this._getOptionsList(t??{},e.length),a=yield Promise.all(s.map(Et)),i=yield Promise.all(a.map((u,c)=>h(this,null,function*(){let d=yield u?.handleChainStart(this.toJSON(),ye(e[c],"input"),s[c].runId,void 0,void 0,void 0,s[c].runName);return delete s[c].runId,d}))),o=e;try{for(let u=0;u<this.steps.length;u+=1)o=yield this.steps[u].batch(o,i.map((d,f)=>{let p=d?.getChild(`seq:step:${u+1}`);return Ee(s[f],{callbacks:p})}),n)}catch(u){throw yield Promise.all(i.map(c=>c?.handleChainError(u))),u}return yield Promise.all(i.map(u=>u?.handleChainEnd(ye(o,"output")))),o})}_streamIterator(e,t){return j(this,null,function*(){let n=yield new v(Et(t)),f=t??{},{runId:s}=f,a=he(f,["runId"]),i=yield new v(n?.handleChainStart(this.toJSON(),ye(e,"input"),s,void 0,void 0,void 0,a?.runName)),o=[this.first,...this.middle,this.last],u=!0,c;function d(){return j(this,null,function*(){yield e})}try{let b=o[0].transform(d(),Ee(a,{callbacks:i?.getChild("seq:step:1")}));for(let T=1;T<o.length;T+=1){let A=o[T];b=yield new v(A.transform(b,Ee(a,{callbacks:i?.getChild(`seq:step:${T+1}`)})))}try{for(var p=z(b),m,_,w;m=!(_=yield new v(p.next())).done;m=!1){let T=_.value;if(yield T,u)if(c===void 0)c=T;else try{c=ht(c,T)}catch{c=void 0,u=!1}}}catch{w=[_]}finally{try{m&&(_=p.return)&&(yield new v(_.call(p)))}finally{if(w)throw w[0]}}}catch(b){throw yield new v(i?.handleChainError(b)),b}yield new v(i?.handleChainEnd(ye(c,"output")))})}getGraph(e){let t=new Ur,n=null;return this.steps.forEach((s,a)=>{let i=s.getGraph(e);a!==0&&i.trimFirstNode(),a!==this.steps.length-1&&i.trimLastNode(),t.extend(i);let o=i.firstNode();if(!o)throw new Error(`Runnable ${s} has no first node`);n&&t.addEdge(n,o),n=i.lastNode()}),t}pipe(e){return r.isRunnableSequence(e)?new r({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:this.name??e.name}):new r({first:this.first,middle:[...this.middle,this.last],last:qt(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&fe.isRunnable(e)}static from([e,...t],n){return new r({first:qt(e),middle:t.slice(0,-1).map(qt),last:qt(t[t.length-1]),name:n})}},Fr=class r extends fe{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(let[t,n]of Object.entries(e.steps))this.steps[t]=qt(n)}static from(e){return new r({steps:e})}invoke(e,t){return h(this,null,function*(){let n=re(t),a=yield(yield Et(n))?.handleChainStart(this.toJSON(),{input:e},n.runId,void 0,void 0,void 0,n?.runName);delete n.runId;let i={};try{yield Promise.all(Object.entries(this.steps).map(c=>h(this,[c],function*([o,u]){i[o]=yield u.invoke(e,Ee(n,{callbacks:a?.getChild(`map:key:${o}`)}))})))}catch(o){throw yield a?.handleChainError(o),o}return yield a?.handleChainEnd(i),i})}_transform(e,t,n){return j(this,null,function*(){let s=l({},this.steps),a=ti(e,Object.keys(s).length),i=new Map(Object.entries(s).map(([o,u],c)=>{let d=u.transform(a[c],Ee(n,{callbacks:t?.getChild(`map:key:${o}`)}));return[o,d.next().then(f=>({key:o,gen:d,result:f}))]}));for(;i.size;){let{key:o,result:u,gen:c}=yield new v(Promise.race(i.values()));i.delete(o),u.done||(yield{[o]:u.value},i.set(o,c.next().then(d=>({key:o,gen:c,result:d}))))}})}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}stream(e,t){return h(this,null,function*(){function n(){return j(this,null,function*(){yield e})}let s=new ft(this.transform(n(),t));return yield s.setup,Me.fromAsyncGenerator(s)})}},_i=class r extends fe{static lc_name(){return"RunnableLambda"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.func=e.func}static from(e){return new r({func:e})}_invoke(e,t,n){return h(this,null,function*(){return new Promise((s,a)=>{let i=Ee(t,{callbacks:n?.getChild(),recursionLimit:(t?.recursionLimit??as)-1});xt.getInstance().run(i,()=>h(this,null,function*(){try{let f=yield this.func(e,g(l({},i),{config:i}));if(f&&fe.isRunnable(f)){if(t?.recursionLimit===0)throw new Error("Recursion limit reached.");f=yield f.invoke(e,g(l({},i),{recursionLimit:(i.recursionLimit??as)-1}))}else if(di(f)){let p;try{for(var o=z(hi(i,f)),u,c,d;u=!(c=yield o.next()).done;u=!1){let m=c.value;if(p===void 0)p=m;else try{p=ht(p,m)}catch{p=m}}}catch{d=[c]}finally{try{u&&(c=o.return)&&(yield c.call(o))}finally{if(d)throw d[0]}}f=p}else if(li(f)){let p;for(let m of fi(i,f))if(p===void 0)p=m;else try{p=ht(p,m)}catch{p=m}f=p}s(f)}catch(f){a(f)}}))})})}invoke(e,t){return h(this,null,function*(){return this._callWithConfig(this._invoke,e,t)})}_transform(e,t,n){return j(this,null,function*(){let s;try{for(var i=z(e),o,u,c;o=!(u=yield new v(i.next())).done;o=!1){let A=u.value;if(s===void 0)s=A;else try{s=ht(s,A)}catch{s=A}}}catch{c=[u]}finally{try{o&&(u=i.return)&&(yield new v(u.call(i)))}finally{if(c)throw c[0]}}let a=yield new v(new Promise((A,M)=>{xt.getInstance().run(n,()=>h(this,null,function*(){try{let $=yield this.func(s,g(l({},n),{config:n}));A($)}catch($){M($)}}))}));if(a&&fe.isRunnable(a)){if(n?.recursionLimit===0)throw new Error("Recursion limit reached.");let A=yield new v(a.stream(s,Ee(n,{callbacks:t?.getChild(),recursionLimit:(n?.recursionLimit??as)-1})));try{for(var d=z(A),f,p,m;f=!(p=yield new v(d.next())).done;f=!1){let M=p.value;yield M}}catch{m=[p]}finally{try{f&&(p=d.return)&&(yield new v(p.call(d)))}finally{if(m)throw m[0]}}}else if(di(a))try{for(var _=z(hi(n,a)),w,b,T;w=!(b=yield new v(_.next())).done;w=!1){let A=b.value;yield A}}catch{T=[b]}finally{try{w&&(b=_.return)&&(yield new v(b.call(_)))}finally{if(T)throw T[0]}}else if(li(a))for(let A of fi(n,a))yield A;else yield a})}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}stream(e,t){return h(this,null,function*(){function n(){return j(this,null,function*(){yield e})}let s=new ft(this.transform(n(),t));return yield s.setup,Me.fromAsyncGenerator(s)})}};var bi=class extends fe{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(let e of this.fallbacks)yield e}invoke(e,t){return h(this,null,function*(){let n=yield xe.configure(t?.callbacks,void 0,t?.tags,void 0,t?.metadata),u=t??{},{runId:s}=u,a=he(u,["runId"]),i=yield n?.handleChainStart(this.toJSON(),ye(e,"input"),s,void 0,void 0,void 0,a?.runName),o;for(let c of this.runnables())try{let d=yield c.invoke(e,Ee(a,{callbacks:i?.getChild()}));return yield i?.handleChainEnd(ye(d,"output")),d}catch(d){o===void 0&&(o=d)}throw o===void 0?new Error("No error stored at end of fallback."):(yield i?.handleChainError(o),o)})}batch(e,t,n){return h(this,null,function*(){if(n?.returnExceptions)throw new Error("Not implemented.");let s=this._getOptionsList(t??{},e.length),a=yield Promise.all(s.map(u=>xe.configure(u?.callbacks,void 0,u?.tags,void 0,u?.metadata))),i=yield Promise.all(a.map((u,c)=>h(this,null,function*(){let d=yield u?.handleChainStart(this.toJSON(),ye(e[c],"input"),s[c].runId,void 0,void 0,void 0,s[c].runName);return delete s[c].runId,d}))),o;for(let u of this.runnables())try{let c=yield u.batch(e,i.map((d,f)=>Ee(s[f],{callbacks:d?.getChild()})),n);return yield Promise.all(i.map((d,f)=>d?.handleChainEnd(ye(c[f],"output")))),c}catch(c){o===void 0&&(o=c)}throw o?(yield Promise.all(i.map(u=>u?.handleChainError(o))),o):new Error("No error stored at end of fallbacks.")})}};function qt(r){if(typeof r=="function")return new _i({func:r});if(fe.isRunnable(r))return r;if(!Array.isArray(r)&&typeof r=="object"){let e={};for(let[t,n]of Object.entries(r))e[t]=qt(n);return new Fr({steps:e})}else throw new Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`)}var wi=class extends fe{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof Fr&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}invoke(e,t){return h(this,null,function*(){let n=yield this.mapper.invoke(e,t);return l(l({},e),n)})}_transform(e,t,n){return j(this,null,function*(){let s=this.mapper.getStepsKeys(),[a,i]=ti(e),o=this.mapper.transform(i,Ee(n,{callbacks:t?.getChild()})),u=o.next();try{for(var c=z(a),d,f,p;d=!(f=yield new v(c.next())).done;d=!1){let T=f.value;if(typeof T!="object"||Array.isArray(T))throw new Error(`RunnableAssign can only be used with objects as input, got ${typeof T}`);let A=Object.fromEntries(Object.entries(T).filter(([M])=>!s.includes(M)));Object.keys(A).length>0&&(yield A)}}catch{p=[f]}finally{try{d&&(f=c.return)&&(yield new v(f.call(c)))}finally{if(p)throw p[0]}}yield(yield new v(u)).value;try{for(var m=z(o),_,w,b;_=!(w=yield new v(m.next())).done;_=!1){let T=w.value;yield T}}catch{b=[w]}finally{try{_&&(w=m.return)&&(yield new v(w.call(m)))}finally{if(b)throw b[0]}}})}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}stream(e,t){return h(this,null,function*(){function n(){return j(this,null,function*(){yield e})}let s=new ft(this.transform(n(),t));return yield s.setup,Me.fromAsyncGenerator(s)})}},vi=class extends fe{static lc_name(){return"RunnablePick"}constructor(e){(typeof e=="string"||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}_pick(e){return h(this,null,function*(){if(typeof this.keys=="string")return e[this.keys];{let t=this.keys.map(n=>[n,e[n]]).filter(n=>n[1]!==void 0);return t.length===0?void 0:Object.fromEntries(t)}})}invoke(e,t){return h(this,null,function*(){return this._callWithConfig(this._pick.bind(this),e,t)})}_transform(e){return j(this,null,function*(){try{for(var t=z(e),n,s,a;n=!(s=yield new v(t.next())).done;n=!1){let i=s.value;let o=yield new v(this._pick(i));o!==void 0&&(yield o)}}catch{a=[s]}finally{try{n&&(s=t.return)&&(yield new v(s.call(t)))}finally{if(a)throw a[0]}}})}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}stream(e,t){return h(this,null,function*(){function n(){return j(this,null,function*(){yield e})}let s=new ft(this.transform(n(),t));return yield s.setup,Me.fromAsyncGenerator(s)})}};var Vy=r=>r.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":r.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":r.startsWith("gpt-4-32k")?"gpt-4-32k":r.startsWith("gpt-4-")?"gpt-4":r.startsWith("gpt-4o")?"gpt-4o":r;var Gy=()=>!1,xi=class extends fe{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??Gy(),this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}},fs=class extends xi{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor(s){var a=s,{callbacks:e,callbackManager:t}=a,n=he(a,["callbacks","callbackManager"]);super(l({callbacks:e??t},n)),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof n.cache=="object"?this.cache=n.cache:n.cache?this.cache=nn.global():this.cache=void 0,this.caller=new yt(n??{})}getNumTokens(e){return h(this,null,function*(){if(typeof e!="string")return 0;let t=Math.ceil(e.length/4);if(!this._encoding)try{this._encoding=yield Fo("modelName"in this?Vy(this.modelName):"gpt2")}catch(n){console.warn("Failed to calculate number of tokens, falling back to approximate count",n)}if(this._encoding)try{t=this._encoding.encode(e).length}catch(n){console.warn("Failed to calculate number of tokens, falling back to approximate count",n)}return t})}static _convertInputToPromptValue(e){return typeof e=="string"?new an(e):Array.isArray(e)?new on(e.map(kt)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall(n){var s=n,{config:e}=s,t=he(s,["config"]);let a=g(l(l({},this._identifyingParams()),t),{_type:this._llmType(),_model:this._modelType()});return Object.entries(a).filter(([u,c])=>c!==void 0).map(([u,c])=>`${u}:${JSON.stringify(c)}`).sort().join(",")}serialize(){return g(l({},this._identifyingParams()),{_type:this._llmType(),_model:this._modelType()})}static deserialize(e){return h(this,null,function*(){throw new Error("Use .toJSON() instead")})}};var Ei=class r extends fs{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models",this._llmType()]})}_separateRunnableConfigFromCallOptions(e){let[t,n]=super._separateRunnableConfigFromCallOptions(e);return n?.timeout&&!n.signal&&(n.signal=AbortSignal.timeout(n.timeout)),[t,n]}invoke(e,t){return h(this,null,function*(){let n=r._convertInputToPromptValue(e);return(yield this.generatePrompt([n],t,t?.callbacks)).generations[0][0].message})}_streamResponseChunks(e,t,n){return j(this,null,function*(){throw new Error("Not implemented.")})}_streamIterator(e,t){return j(this,null,function*(){if(this._streamResponseChunks===r.prototype._streamResponseChunks)yield this.invoke(e,t);else{let u=r._convertInputToPromptValue(e).toChatMessages(),[c,d]=this._separateRunnableConfigFromCallOptions(t),f=yield new v(xe.configure(c.callbacks,this.callbacks,c.tags,this.tags,c.metadata,this.metadata,{verbose:this.verbose})),p={options:d,invocation_params:this?.invocationParams(d),batch_size:1},m=yield new v(f?.handleChatModelStart(this.toJSON(),[u],c.runId,void 0,p,void 0,void 0,c.runName)),_;try{try{for(var n=z(this._streamResponseChunks(u,d,m?.[0])),s,a,i;s=!(a=yield new v(n.next())).done;s=!1){let w=a.value;w.message.response_metadata=l(l({},w.generationInfo),w.message.response_metadata),yield w.message,_?_=_.concat(w):_=w}}catch{i=[a]}finally{try{s&&(a=n.return)&&(yield new v(a.call(n)))}finally{if(i)throw i[0]}}}catch(w){throw yield new v(Promise.all((m??[]).map(b=>b?.handleLLMError(w)))),w}yield new v(Promise.all((m??[]).map(w=>w?.handleLLMEnd({generations:[[_]]}))))}})}_generateUncached(e,t,n){return h(this,null,function*(){let s=e.map(p=>p.map(kt)),a=yield xe.configure(n.callbacks,this.callbacks,n.tags,this.tags,n.metadata,this.metadata,{verbose:this.verbose}),i={options:t,invocation_params:this?.invocationParams(t),batch_size:1},o=yield a?.handleChatModelStart(this.toJSON(),s,n.runId,void 0,i,void 0,void 0,n.runName),u=yield Promise.allSettled(s.map((p,m)=>this._generate(p,g(l({},t),{promptIndex:m}),o?.[m]))),c=[],d=[];yield Promise.all(u.map((p,m)=>h(this,null,function*(){if(p.status==="fulfilled"){let _=p.value;for(let w of _.generations)w.message.response_metadata=l(l({},w.generationInfo),w.message.response_metadata);return _.generations.length===1&&(_.generations[0].message.response_metadata=l(l({},_.llmOutput),_.generations[0].message.response_metadata)),c[m]=_.generations,d[m]=_.llmOutput,o?.[m]?.handleLLMEnd({generations:[_.generations],llmOutput:_.llmOutput})}else return yield o?.[m]?.handleLLMError(p.reason),Promise.reject(p.reason)})));let f={generations:c,llmOutput:d.length?this._combineLLMOutput?.(...d):void 0};return Object.defineProperty(f,js,{value:o?{runIds:o?.map(p=>p.runId)}:void 0,configurable:!0}),f})}_generateCached(i){return h(this,arguments,function*({messages:e,cache:t,llmStringKey:n,parsedOptions:s,handledOptions:a}){let o=e.map(b=>b.map(kt)),u=yield xe.configure(a.callbacks,this.callbacks,a.tags,this.tags,a.metadata,this.metadata,{verbose:this.verbose}),c={options:s,invocation_params:this?.invocationParams(s),batch_size:1,cached:!0},d=yield u?.handleChatModelStart(this.toJSON(),o,a.runId,void 0,c,void 0,void 0,a.runName),f=[],m=(yield Promise.allSettled(o.map((b,T)=>h(this,null,function*(){let A=r._convertInputToPromptValue(b).toString(),M=yield t.lookup(A,n);return M==null&&f.push(T),M})))).map((b,T)=>({result:b,runManager:d?.[T]})).filter(({result:b})=>b.status==="fulfilled"&&b.value!=null||b.status==="rejected"),_=[];yield Promise.all(m.map((M,$)=>h(this,[M,$],function*({result:b,runManager:T},A){if(b.status==="fulfilled"){let B=b.value;return _[A]=B,B.length&&(yield T?.handleLLMNewToken(B[0].text)),T?.handleLLMEnd({generations:[B]})}else return yield T?.handleLLMError(b.reason),Promise.reject(b.reason)})));let w={generations:_,missingPromptIndices:f};return Object.defineProperty(w,js,{value:d?{runIds:d?.map(b=>b.runId)}:void 0,configurable:!0}),w})}generate(e,t,n){return h(this,null,function*(){let s;Array.isArray(t)?s={stop:t}:s=t;let a=e.map(m=>m.map(kt)),[i,o]=this._separateRunnableConfigFromCallOptions(s);if(i.callbacks=i.callbacks??n,!this.cache)return this._generateUncached(a,o,i);let{cache:u}=this,c=this._getSerializedCacheKeyParametersForCall(o),{generations:d,missingPromptIndices:f}=yield this._generateCached({messages:a,cache:u,llmStringKey:c,parsedOptions:o,handledOptions:i}),p={};if(f.length>0){let m=yield this._generateUncached(f.map(_=>a[_]),o,i);yield Promise.all(m.generations.map((_,w)=>h(this,null,function*(){let b=f[w];d[b]=_;let T=r._convertInputToPromptValue(a[b]).toString();return u.update(T,c,_)}))),p=m.llmOutput??{}}return{generations:d,llmOutput:p}})}invocationParams(e){return{}}_modelType(){return"base_chat_model"}serialize(){return g(l({},this.invocationParams()),{_type:this._llmType(),_model:this._modelType()})}generatePrompt(e,t,n){return h(this,null,function*(){let s=e.map(a=>a.toChatMessages());return this.generate(s,t,n)})}call(e,t,n){return h(this,null,function*(){return(yield this.generate([e.map(kt)],t,n)).generations[0][0].message})}callPrompt(e,t,n){return h(this,null,function*(){let s=e.toChatMessages();return this.call(s,t,n)})}predictMessages(e,t,n){return h(this,null,function*(){return this.call(e,t,n)})}predict(e,t,n){return h(this,null,function*(){let s=new it(e),a=yield this.call([s],t,n);if(typeof a.content!="string")throw new Error("Cannot use predict when output is not a string.");return a.content})}},hs=class extends Ei{_generate(e,t,n){return h(this,null,function*(){let s=yield this._call(e,t,n),a=new Zt(s);if(typeof a.content!="string")throw new Error("Cannot generate with a simple chat model when output is not a string.");return{generations:[{text:a.content,message:a}]}})}};function Br(r,e){return function(){return r.apply(e,arguments)}}var{toString:Jy}=Object.prototype,{getPrototypeOf:Ti}=Object,{iterator:ms,toStringTag:td}=Symbol,gs=(r=>e=>{let t=Jy.call(e);return r[t]||(r[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),Ge=r=>(r=r.toLowerCase(),e=>gs(e)===r),ys=r=>e=>typeof e===r,{isArray:ir}=Array,ar=ys("undefined");function qr(r){return r!==null&&!ar(r)&&r.constructor!==null&&!ar(r.constructor)&&Ae(r.constructor.isBuffer)&&r.constructor.isBuffer(r)}var rd=Ge("ArrayBuffer");function Wy(r){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(r):e=r&&r.buffer&&rd(r.buffer),e}var Ky=ys("string"),Ae=ys("function"),nd=ys("number"),Hr=r=>r!==null&&typeof r=="object",Xy=r=>r===!0||r===!1,ps=r=>{if(gs(r)!=="object")return!1;let e=Ti(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(td in r)&&!(ms in r)},Yy=r=>{if(!Hr(r)||qr(r))return!1;try{return Object.keys(r).length===0&&Object.getPrototypeOf(r)===Object.prototype}catch{return!1}},Qy=Ge("Date"),e_=Ge("File"),t_=Ge("Blob"),r_=Ge("FileList"),n_=r=>Hr(r)&&Ae(r.pipe),s_=r=>{let e;return r&&(typeof FormData=="function"&&r instanceof FormData||Ae(r.append)&&((e=gs(r))==="formdata"||e==="object"&&Ae(r.toString)&&r.toString()==="[object FormData]"))},a_=Ge("URLSearchParams"),[i_,o_,u_,c_]=["ReadableStream","Request","Response","Headers"].map(Ge),l_=r=>r.trim?r.trim():r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function zr(r,e,{allOwnKeys:t=!1}={}){if(r===null||typeof r>"u")return;let n,s;if(typeof r!="object"&&(r=[r]),ir(r))for(n=0,s=r.length;n<s;n++)e.call(null,r[n],n,r);else{if(qr(r))return;let a=t?Object.getOwnPropertyNames(r):Object.keys(r),i=a.length,o;for(n=0;n<i;n++)o=a[n],e.call(null,r[o],o,r)}}function sd(r,e){if(qr(r))return null;e=e.toLowerCase();let t=Object.keys(r),n=t.length,s;for(;n-- >0;)if(s=t[n],e===s.toLowerCase())return s;return null}var Ht=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,ad=r=>!ar(r)&&r!==Ht;function Oi(){let{caseless:r,skipUndefined:e}=ad(this)&&this||{},t={},n=(s,a)=>{let i=r&&sd(t,a)||a;ps(t[i])&&ps(s)?t[i]=Oi(t[i],s):ps(s)?t[i]=Oi({},s):ir(s)?t[i]=s.slice():(!e||!ar(s))&&(t[i]=s)};for(let s=0,a=arguments.length;s<a;s++)arguments[s]&&zr(arguments[s],n);return t}var d_=(r,e,t,{allOwnKeys:n}={})=>(zr(e,(s,a)=>{t&&Ae(s)?r[a]=Br(s,t):r[a]=s},{allOwnKeys:n}),r),f_=r=>(r.charCodeAt(0)===65279&&(r=r.slice(1)),r),h_=(r,e,t,n)=>{r.prototype=Object.create(e.prototype,n),r.prototype.constructor=r,Object.defineProperty(r,"super",{value:e.prototype}),t&&Object.assign(r.prototype,t)},p_=(r,e,t,n)=>{let s,a,i,o={};if(e=e||{},r==null)return e;do{for(s=Object.getOwnPropertyNames(r),a=s.length;a-- >0;)i=s[a],(!n||n(i,r,e))&&!o[i]&&(e[i]=r[i],o[i]=!0);r=t!==!1&&Ti(r)}while(r&&(!t||t(r,e))&&r!==Object.prototype);return e},m_=(r,e,t)=>{r=String(r),(t===void 0||t>r.length)&&(t=r.length),t-=e.length;let n=r.indexOf(e,t);return n!==-1&&n===t},g_=r=>{if(!r)return null;if(ir(r))return r;let e=r.length;if(!nd(e))return null;let t=new Array(e);for(;e-- >0;)t[e]=r[e];return t},y_=(r=>e=>r&&e instanceof r)(typeof Uint8Array<"u"&&Ti(Uint8Array)),__=(r,e)=>{let n=(r&&r[ms]).call(r),s;for(;(s=n.next())&&!s.done;){let a=s.value;e.call(r,a[0],a[1])}},b_=(r,e)=>{let t,n=[];for(;(t=r.exec(e))!==null;)n.push(t);return n},w_=Ge("HTMLFormElement"),v_=r=>r.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,n,s){return n.toUpperCase()+s}),ed=(({hasOwnProperty:r})=>(e,t)=>r.call(e,t))(Object.prototype),x_=Ge("RegExp"),id=(r,e)=>{let t=Object.getOwnPropertyDescriptors(r),n={};zr(t,(s,a)=>{let i;(i=e(s,a,r))!==!1&&(n[a]=i||s)}),Object.defineProperties(r,n)},E_=r=>{id(r,(e,t)=>{if(Ae(r)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;let n=r[t];if(Ae(n)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},O_=(r,e)=>{let t={},n=s=>{s.forEach(a=>{t[a]=!0})};return ir(r)?n(r):n(String(r).split(e)),t},T_=()=>{},S_=(r,e)=>r!=null&&Number.isFinite(r=+r)?r:e;function A_(r){return!!(r&&Ae(r.append)&&r[td]==="FormData"&&r[ms])}var R_=r=>{let e=new Array(10),t=(n,s)=>{if(Hr(n)){if(e.indexOf(n)>=0)return;if(qr(n))return n;if(!("toJSON"in n)){e[s]=n;let a=ir(n)?[]:{};return zr(n,(i,o)=>{let u=t(i,s+1);!ar(u)&&(a[o]=u)}),e[s]=void 0,a}}return n};return t(r,0)},k_=Ge("AsyncFunction"),C_=r=>r&&(Hr(r)||Ae(r))&&Ae(r.then)&&Ae(r.catch),od=((r,e)=>r?setImmediate:e?((t,n)=>(Ht.addEventListener("message",({source:s,data:a})=>{s===Ht&&a===t&&n.length&&n.shift()()},!1),s=>{n.push(s),Ht.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",Ae(Ht.postMessage)),P_=typeof queueMicrotask<"u"?queueMicrotask.bind(Ht):typeof process<"u"&&process.nextTick||od,I_=r=>r!=null&&Ae(r[ms]),y={isArray:ir,isArrayBuffer:rd,isBuffer:qr,isFormData:s_,isArrayBufferView:Wy,isString:Ky,isNumber:nd,isBoolean:Xy,isObject:Hr,isPlainObject:ps,isEmptyObject:Yy,isReadableStream:i_,isRequest:o_,isResponse:u_,isHeaders:c_,isUndefined:ar,isDate:Qy,isFile:e_,isBlob:t_,isRegExp:x_,isFunction:Ae,isStream:n_,isURLSearchParams:a_,isTypedArray:y_,isFileList:r_,forEach:zr,merge:Oi,extend:d_,trim:l_,stripBOM:f_,inherits:h_,toFlatObject:p_,kindOf:gs,kindOfTest:Ge,endsWith:m_,toArray:g_,forEachEntry:__,matchAll:b_,isHTMLForm:w_,hasOwnProperty:ed,hasOwnProp:ed,reduceDescriptors:id,freezeMethods:E_,toObjectSet:O_,toCamelCase:v_,noop:T_,toFiniteNumber:S_,findKey:sd,global:Ht,isContextDefined:ad,isSpecCompliantForm:A_,toJSONObject:R_,isAsyncFn:k_,isThenable:C_,setImmediate:od,asap:P_,isIterable:I_};function or(r,e,t,n,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=r,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),n&&(this.request=n),s&&(this.response=s,this.status=s.status?s.status:null)}y.inherits(or,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:y.toJSONObject(this.config),code:this.code,status:this.status}}});var ud=or.prototype,cd={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(r=>{cd[r]={value:r}});Object.defineProperties(or,cd);Object.defineProperty(ud,"isAxiosError",{value:!0});or.from=(r,e,t,n,s,a)=>{let i=Object.create(ud);y.toFlatObject(r,i,function(d){return d!==Error.prototype},c=>c!=="isAxiosError");let o=r&&r.message?r.message:"Error",u=e==null&&r?r.code:e;return or.call(i,o,u,t,n,s),r&&i.cause==null&&Object.defineProperty(i,"cause",{value:r,configurable:!0}),i.name=r&&r.name||"Error",a&&Object.assign(i,a),i};var D=or;var _s=null;function Si(r){return y.isPlainObject(r)||y.isArray(r)}function dd(r){return y.endsWith(r,"[]")?r.slice(0,-2):r}function ld(r,e,t){return r?r.concat(e).map(function(s,a){return s=dd(s),!t&&a?"["+s+"]":s}).join(t?".":""):e}function N_(r){return y.isArray(r)&&!r.some(Si)}var $_=y.toFlatObject(y,{},null,function(e){return/^is[A-Z]/.test(e)});function L_(r,e,t){if(!y.isObject(r))throw new TypeError("target must be an object");e=e||new(_s||FormData),t=y.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(w,b){return!y.isUndefined(b[w])});let n=t.metaTokens,s=t.visitor||d,a=t.dots,i=t.indexes,u=(t.Blob||typeof Blob<"u"&&Blob)&&y.isSpecCompliantForm(e);if(!y.isFunction(s))throw new TypeError("visitor must be a function");function c(_){if(_===null)return"";if(y.isDate(_))return _.toISOString();if(y.isBoolean(_))return _.toString();if(!u&&y.isBlob(_))throw new D("Blob is not supported. Use a Buffer instead.");return y.isArrayBuffer(_)||y.isTypedArray(_)?u&&typeof Blob=="function"?new Blob([_]):Buffer.from(_):_}function d(_,w,b){let T=_;if(_&&!b&&typeof _=="object"){if(y.endsWith(w,"{}"))w=n?w:w.slice(0,-2),_=JSON.stringify(_);else if(y.isArray(_)&&N_(_)||(y.isFileList(_)||y.endsWith(w,"[]"))&&(T=y.toArray(_)))return w=dd(w),T.forEach(function(M,$){!(y.isUndefined(M)||M===null)&&e.append(i===!0?ld([w],$,a):i===null?w:w+"[]",c(M))}),!1}return Si(_)?!0:(e.append(ld(b,w,a),c(_)),!1)}let f=[],p=Object.assign($_,{defaultVisitor:d,convertValue:c,isVisitable:Si});function m(_,w){if(!y.isUndefined(_)){if(f.indexOf(_)!==-1)throw Error("Circular reference detected in "+w.join("."));f.push(_),y.forEach(_,function(T,A){(!(y.isUndefined(T)||T===null)&&s.call(e,T,y.isString(A)?A.trim():A,w,p))===!0&&m(T,w?w.concat(A):[A])}),f.pop()}}if(!y.isObject(r))throw new TypeError("data must be an object");return m(r),e}var Ot=L_;function fd(r){let e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(r).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function hd(r,e){this._pairs=[],r&&Ot(r,this,e)}var pd=hd.prototype;pd.append=function(e,t){this._pairs.push([e,t])};pd.toString=function(e){let t=e?function(n){return e.call(this,n,fd)}:fd;return this._pairs.map(function(s){return t(s[0])+"="+t(s[1])},"").join("&")};var bs=hd;function j_(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function Zr(r,e,t){if(!e)return r;let n=t&&t.encode||j_;y.isFunction(t)&&(t={serialize:t});let s=t&&t.serialize,a;if(s?a=s(e,t):a=y.isURLSearchParams(e)?e.toString():new bs(e,t).toString(n),a){let i=r.indexOf("#");i!==-1&&(r=r.slice(0,i)),r+=(r.indexOf("?")===-1?"?":"&")+a}return r}var Ai=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){y.forEach(this.handlers,function(n){n!==null&&e(n)})}},Ri=Ai;var ws={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1};var md=typeof URLSearchParams<"u"?URLSearchParams:bs;var gd=typeof FormData<"u"?FormData:null;var yd=typeof Blob<"u"?Blob:null;var _d={isBrowser:!0,classes:{URLSearchParams:md,FormData:gd,Blob:yd},protocols:["http","https","file","blob","url","data"]};var Pi={};Cs(Pi,{hasBrowserEnv:()=>Ci,hasStandardBrowserEnv:()=>D_,hasStandardBrowserWebWorkerEnv:()=>M_,navigator:()=>ki,origin:()=>U_});var Ci=typeof window<"u"&&typeof document<"u",ki=typeof navigator=="object"&&navigator||void 0,D_=Ci&&(!ki||["ReactNative","NativeScript","NS"].indexOf(ki.product)<0),M_=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",U_=Ci&&window.location.href||"http://localhost";var Q=l(l({},Pi),_d);function Ii(r,e){return Ot(r,new Q.classes.URLSearchParams,l({visitor:function(t,n,s,a){return Q.isNode&&y.isBuffer(t)?(this.append(n,t.toString("base64")),!1):a.defaultVisitor.apply(this,arguments)}},e))}function F_(r){return y.matchAll(/\w+|\[(\w*)]/g,r).map(e=>e[0]==="[]"?"":e[1]||e[0])}function B_(r){let e={},t=Object.keys(r),n,s=t.length,a;for(n=0;n<s;n++)a=t[n],e[a]=r[a];return e}function q_(r){function e(t,n,s,a){let i=t[a++];if(i==="__proto__")return!0;let o=Number.isFinite(+i),u=a>=t.length;return i=!i&&y.isArray(s)?s.length:i,u?(y.hasOwnProp(s,i)?s[i]=[s[i],n]:s[i]=n,!o):((!s[i]||!y.isObject(s[i]))&&(s[i]=[]),e(t,n,s[i],a)&&y.isArray(s[i])&&(s[i]=B_(s[i])),!o)}if(y.isFormData(r)&&y.isFunction(r.entries)){let t={};return y.forEachEntry(r,(n,s)=>{e(F_(n),s,t,0)}),t}return null}var vs=q_;function H_(r,e,t){if(y.isString(r))try{return(e||JSON.parse)(r),y.trim(r)}catch(n){if(n.name!=="SyntaxError")throw n}return(t||JSON.stringify)(r)}var Ni={transitional:ws,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){let n=t.getContentType()||"",s=n.indexOf("application/json")>-1,a=y.isObject(e);if(a&&y.isHTMLForm(e)&&(e=new FormData(e)),y.isFormData(e))return s?JSON.stringify(vs(e)):e;if(y.isArrayBuffer(e)||y.isBuffer(e)||y.isStream(e)||y.isFile(e)||y.isBlob(e)||y.isReadableStream(e))return e;if(y.isArrayBufferView(e))return e.buffer;if(y.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let o;if(a){if(n.indexOf("application/x-www-form-urlencoded")>-1)return Ii(e,this.formSerializer).toString();if((o=y.isFileList(e))||n.indexOf("multipart/form-data")>-1){let u=this.env&&this.env.FormData;return Ot(o?{"files[]":e}:e,u&&new u,this.formSerializer)}}return a||s?(t.setContentType("application/json",!1),H_(e)):e}],transformResponse:[function(e){let t=this.transitional||Ni.transitional,n=t&&t.forcedJSONParsing,s=this.responseType==="json";if(y.isResponse(e)||y.isReadableStream(e))return e;if(e&&y.isString(e)&&(n&&!this.responseType||s)){let i=!(t&&t.silentJSONParsing)&&s;try{return JSON.parse(e,this.parseReviver)}catch(o){if(i)throw o.name==="SyntaxError"?D.from(o,D.ERR_BAD_RESPONSE,this,null,this.response):o}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Q.classes.FormData,Blob:Q.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};y.forEach(["delete","get","head","post","put","patch"],r=>{Ni.headers[r]={}});var ur=Ni;var z_=y.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),bd=r=>{let e={},t,n,s;return r&&r.split(`
`).forEach(function(i){s=i.indexOf(":"),t=i.substring(0,s).trim().toLowerCase(),n=i.substring(s+1).trim(),!(!t||e[t]&&z_[t])&&(t==="set-cookie"?e[t]?e[t].push(n):e[t]=[n]:e[t]=e[t]?e[t]+", "+n:n)}),e};var wd=Symbol("internals");function Vr(r){return r&&String(r).trim().toLowerCase()}function xs(r){return r===!1||r==null?r:y.isArray(r)?r.map(xs):String(r)}function Z_(r){let e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g,n;for(;n=t.exec(r);)e[n[1]]=n[2];return e}var V_=r=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(r.trim());function $i(r,e,t,n,s){if(y.isFunction(n))return n.call(this,e,t);if(s&&(e=t),!!y.isString(e)){if(y.isString(n))return e.indexOf(n)!==-1;if(y.isRegExp(n))return n.test(e)}}function G_(r){return r.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,n)=>t.toUpperCase()+n)}function J_(r,e){let t=y.toCamelCase(" "+e);["get","set","has"].forEach(n=>{Object.defineProperty(r,n+t,{value:function(s,a,i){return this[n].call(this,e,s,a,i)},configurable:!0})})}var cr=class{constructor(e){e&&this.set(e)}set(e,t,n){let s=this;function a(o,u,c){let d=Vr(u);if(!d)throw new Error("header name must be a non-empty string");let f=y.findKey(s,d);(!f||s[f]===void 0||c===!0||c===void 0&&s[f]!==!1)&&(s[f||u]=xs(o))}let i=(o,u)=>y.forEach(o,(c,d)=>a(c,d,u));if(y.isPlainObject(e)||e instanceof this.constructor)i(e,t);else if(y.isString(e)&&(e=e.trim())&&!V_(e))i(bd(e),t);else if(y.isObject(e)&&y.isIterable(e)){let o={},u,c;for(let d of e){if(!y.isArray(d))throw TypeError("Object iterator must return a key-value pair");o[c=d[0]]=(u=o[c])?y.isArray(u)?[...u,d[1]]:[u,d[1]]:d[1]}i(o,t)}else e!=null&&a(t,e,n);return this}get(e,t){if(e=Vr(e),e){let n=y.findKey(this,e);if(n){let s=this[n];if(!t)return s;if(t===!0)return Z_(s);if(y.isFunction(t))return t.call(this,s,n);if(y.isRegExp(t))return t.exec(s);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Vr(e),e){let n=y.findKey(this,e);return!!(n&&this[n]!==void 0&&(!t||$i(this,this[n],n,t)))}return!1}delete(e,t){let n=this,s=!1;function a(i){if(i=Vr(i),i){let o=y.findKey(n,i);o&&(!t||$i(n,n[o],o,t))&&(delete n[o],s=!0)}}return y.isArray(e)?e.forEach(a):a(e),s}clear(e){let t=Object.keys(this),n=t.length,s=!1;for(;n--;){let a=t[n];(!e||$i(this,this[a],a,e,!0))&&(delete this[a],s=!0)}return s}normalize(e){let t=this,n={};return y.forEach(this,(s,a)=>{let i=y.findKey(n,a);if(i){t[i]=xs(s),delete t[a];return}let o=e?G_(a):String(a).trim();o!==a&&delete t[a],t[o]=xs(s),n[o]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){let t=Object.create(null);return y.forEach(this,(n,s)=>{n!=null&&n!==!1&&(t[s]=e&&y.isArray(n)?n.join(", "):n)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){let n=new this(e);return t.forEach(s=>n.set(s)),n}static accessor(e){let n=(this[wd]=this[wd]={accessors:{}}).accessors,s=this.prototype;function a(i){let o=Vr(i);n[o]||(J_(s,i),n[o]=!0)}return y.isArray(e)?e.forEach(a):a(e),this}};cr.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);y.reduceDescriptors(cr.prototype,({value:r},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>r,set(n){this[t]=n}}});y.freezeMethods(cr);var ie=cr;function Gr(r,e){let t=this||ur,n=e||t,s=ie.from(n.headers),a=n.data;return y.forEach(r,function(o){a=o.call(t,a,s.normalize(),e?e.status:void 0)}),s.normalize(),a}function Jr(r){return!!(r&&r.__CANCEL__)}function vd(r,e,t){D.call(this,r??"canceled",D.ERR_CANCELED,e,t),this.name="CanceledError"}y.inherits(vd,D,{__CANCEL__:!0});var rt=vd;function Wr(r,e,t){let n=t.config.validateStatus;!t.status||!n||n(t.status)?r(t):e(new D("Request failed with status code "+t.status,[D.ERR_BAD_REQUEST,D.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function Li(r){let e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(r);return e&&e[1]||""}function W_(r,e){r=r||10;let t=new Array(r),n=new Array(r),s=0,a=0,i;return e=e!==void 0?e:1e3,function(u){let c=Date.now(),d=n[a];i||(i=c),t[s]=u,n[s]=c;let f=a,p=0;for(;f!==s;)p+=t[f++],f=f%r;if(s=(s+1)%r,s===a&&(a=(a+1)%r),c-i<e)return;let m=d&&c-d;return m?Math.round(p*1e3/m):void 0}}var xd=W_;function K_(r,e){let t=0,n=1e3/e,s,a,i=(c,d=Date.now())=>{t=d,s=null,a&&(clearTimeout(a),a=null),r(...c)};return[(...c)=>{let d=Date.now(),f=d-t;f>=n?i(c,d):(s=c,a||(a=setTimeout(()=>{a=null,i(s)},n-f)))},()=>s&&i(s)]}var Ed=K_;var lr=(r,e,t=3)=>{let n=0,s=xd(50,250);return Ed(a=>{let i=a.loaded,o=a.lengthComputable?a.total:void 0,u=i-n,c=s(u),d=i<=o;n=i;let f={loaded:i,total:o,progress:o?i/o:void 0,bytes:u,rate:c||void 0,estimated:c&&o&&d?(o-i)/c:void 0,event:a,lengthComputable:o!=null,[e?"download":"upload"]:!0};r(f)},t)},ji=(r,e)=>{let t=r!=null;return[n=>e[0]({lengthComputable:t,total:r,loaded:n}),e[1]]},Di=r=>(...e)=>y.asap(()=>r(...e));var Od=Q.hasStandardBrowserEnv?((r,e)=>t=>(t=new URL(t,Q.origin),r.protocol===t.protocol&&r.host===t.host&&(e||r.port===t.port)))(new URL(Q.origin),Q.navigator&&/(msie|trident)/i.test(Q.navigator.userAgent)):()=>!0;var Td=Q.hasStandardBrowserEnv?{write(r,e,t,n,s,a){let i=[r+"="+encodeURIComponent(e)];y.isNumber(t)&&i.push("expires="+new Date(t).toGMTString()),y.isString(n)&&i.push("path="+n),y.isString(s)&&i.push("domain="+s),a===!0&&i.push("secure"),document.cookie=i.join("; ")},read(r){let e=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(r){this.write(r,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Mi(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}function Ui(r,e){return e?r.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):r}function Kr(r,e,t){let n=!Mi(e);return r&&(n||t==!1)?Ui(r,e):e}var Sd=r=>r instanceof ie?l({},r):r;function Je(r,e){e=e||{};let t={};function n(c,d,f,p){return y.isPlainObject(c)&&y.isPlainObject(d)?y.merge.call({caseless:p},c,d):y.isPlainObject(d)?y.merge({},d):y.isArray(d)?d.slice():d}function s(c,d,f,p){if(y.isUndefined(d)){if(!y.isUndefined(c))return n(void 0,c,f,p)}else return n(c,d,f,p)}function a(c,d){if(!y.isUndefined(d))return n(void 0,d)}function i(c,d){if(y.isUndefined(d)){if(!y.isUndefined(c))return n(void 0,c)}else return n(void 0,d)}function o(c,d,f){if(f in e)return n(c,d);if(f in r)return n(void 0,c)}let u={url:a,method:a,data:a,baseURL:i,transformRequest:i,transformResponse:i,paramsSerializer:i,timeout:i,timeoutMessage:i,withCredentials:i,withXSRFToken:i,adapter:i,responseType:i,xsrfCookieName:i,xsrfHeaderName:i,onUploadProgress:i,onDownloadProgress:i,decompress:i,maxContentLength:i,maxBodyLength:i,beforeRedirect:i,transport:i,httpAgent:i,httpsAgent:i,cancelToken:i,socketPath:i,responseEncoding:i,validateStatus:o,headers:(c,d,f)=>s(Sd(c),Sd(d),f,!0)};return y.forEach(Object.keys(l(l({},r),e)),function(d){let f=u[d]||s,p=f(r[d],e[d],d);y.isUndefined(p)&&f!==o||(t[d]=p)}),t}var Es=r=>{let e=Je({},r),{data:t,withXSRFToken:n,xsrfHeaderName:s,xsrfCookieName:a,headers:i,auth:o}=e;if(e.headers=i=ie.from(i),e.url=Zr(Kr(e.baseURL,e.url,e.allowAbsoluteUrls),r.params,r.paramsSerializer),o&&i.set("Authorization","Basic "+btoa((o.username||"")+":"+(o.password?unescape(encodeURIComponent(o.password)):""))),y.isFormData(t)){if(Q.hasStandardBrowserEnv||Q.hasStandardBrowserWebWorkerEnv)i.setContentType(void 0);else if(y.isFunction(t.getHeaders)){let u=t.getHeaders(),c=["content-type","content-length"];Object.entries(u).forEach(([d,f])=>{c.includes(d.toLowerCase())&&i.set(d,f)})}}if(Q.hasStandardBrowserEnv&&(n&&y.isFunction(n)&&(n=n(e)),n||n!==!1&&Od(e.url))){let u=s&&a&&Td.read(a);u&&i.set(s,u)}return e};var X_=typeof XMLHttpRequest<"u",Ad=X_&&function(r){return new Promise(function(t,n){let s=Es(r),a=s.data,i=ie.from(s.headers).normalize(),{responseType:o,onUploadProgress:u,onDownloadProgress:c}=s,d,f,p,m,_;function w(){m&&m(),_&&_(),s.cancelToken&&s.cancelToken.unsubscribe(d),s.signal&&s.signal.removeEventListener("abort",d)}let b=new XMLHttpRequest;b.open(s.method.toUpperCase(),s.url,!0),b.timeout=s.timeout;function T(){if(!b)return;let M=ie.from("getAllResponseHeaders"in b&&b.getAllResponseHeaders()),B={data:!o||o==="text"||o==="json"?b.responseText:b.response,status:b.status,statusText:b.statusText,headers:M,config:r,request:b};Wr(function(W){t(W),w()},function(W){n(W),w()},B),b=null}"onloadend"in b?b.onloadend=T:b.onreadystatechange=function(){!b||b.readyState!==4||b.status===0&&!(b.responseURL&&b.responseURL.indexOf("file:")===0)||setTimeout(T)},b.onabort=function(){b&&(n(new D("Request aborted",D.ECONNABORTED,r,b)),b=null)},b.onerror=function($){let B=$&&$.message?$.message:"Network Error",K=new D(B,D.ERR_NETWORK,r,b);K.event=$||null,n(K),b=null},b.ontimeout=function(){let $=s.timeout?"timeout of "+s.timeout+"ms exceeded":"timeout exceeded",B=s.transitional||ws;s.timeoutErrorMessage&&($=s.timeoutErrorMessage),n(new D($,B.clarifyTimeoutError?D.ETIMEDOUT:D.ECONNABORTED,r,b)),b=null},a===void 0&&i.setContentType(null),"setRequestHeader"in b&&y.forEach(i.toJSON(),function($,B){b.setRequestHeader(B,$)}),y.isUndefined(s.withCredentials)||(b.withCredentials=!!s.withCredentials),o&&o!=="json"&&(b.responseType=s.responseType),c&&([p,_]=lr(c,!0),b.addEventListener("progress",p)),u&&b.upload&&([f,m]=lr(u),b.upload.addEventListener("progress",f),b.upload.addEventListener("loadend",m)),(s.cancelToken||s.signal)&&(d=M=>{b&&(n(!M||M.type?new rt(null,r,b):M),b.abort(),b=null)},s.cancelToken&&s.cancelToken.subscribe(d),s.signal&&(s.signal.aborted?d():s.signal.addEventListener("abort",d)));let A=Li(s.url);if(A&&Q.protocols.indexOf(A)===-1){n(new D("Unsupported protocol "+A+":",D.ERR_BAD_REQUEST,r));return}b.send(a||null)})};var Y_=(r,e)=>{let{length:t}=r=r?r.filter(Boolean):[];if(e||t){let n=new AbortController,s,a=function(c){if(!s){s=!0,o();let d=c instanceof Error?c:this.reason;n.abort(d instanceof D?d:new rt(d instanceof Error?d.message:d))}},i=e&&setTimeout(()=>{i=null,a(new D(`timeout ${e} of ms exceeded`,D.ETIMEDOUT))},e),o=()=>{r&&(i&&clearTimeout(i),i=null,r.forEach(c=>{c.unsubscribe?c.unsubscribe(a):c.removeEventListener("abort",a)}),r=null)};r.forEach(c=>c.addEventListener("abort",a));let{signal:u}=n;return u.unsubscribe=()=>y.asap(o),u}},Rd=Y_;var Q_=function*(r,e){let t=r.byteLength;if(!e||t<e){yield r;return}let n=0,s;for(;n<t;)s=n+e,yield r.slice(n,s),n=s},eb=function(r,e){return j(this,null,function*(){try{for(var t=z(tb(r)),n,s,a;n=!(s=yield new v(t.next())).done;n=!1){let i=s.value;yield*ee(Q_(i,e))}}catch{a=[s]}finally{try{n&&(s=t.return)&&(yield new v(s.call(t)))}finally{if(a)throw a[0]}}})},tb=function(r){return j(this,null,function*(){if(r[Symbol.asyncIterator]){yield*ee(r);return}let e=r.getReader();try{for(;;){let{done:t,value:n}=yield new v(e.read());if(t)break;yield n}}finally{yield new v(e.cancel())}})},Fi=(r,e,t,n)=>{let s=eb(r,e),a=0,i,o=c=>{i||(i=!0,n&&n(c))};return new ReadableStream({pull(c){return h(this,null,function*(){try{let{done:d,value:f}=yield s.next();if(d){o(),c.close();return}let p=f.byteLength;if(t){let m=a+=p;t(m)}c.enqueue(new Uint8Array(f))}catch(d){throw o(d),d}})},cancel(c){return o(c),s.return()}},{highWaterMark:2})};var kd=64*1024,{isFunction:Os}=y,rb=(({Request:r,Response:e})=>({Request:r,Response:e}))(y.global),{ReadableStream:Cd,TextEncoder:Pd}=y.global,Id=(r,...e)=>{try{return!!r(...e)}catch{return!1}},nb=r=>{r=y.merge.call({skipUndefined:!0},rb,r);let{fetch:e,Request:t,Response:n}=r,s=e?Os(e):typeof fetch=="function",a=Os(t),i=Os(n);if(!s)return!1;let o=s&&Os(Cd),u=s&&(typeof Pd=="function"?(_=>w=>_.encode(w))(new Pd):_=>h(null,null,function*(){return new Uint8Array(yield new t(_).arrayBuffer())})),c=a&&o&&Id(()=>{let _=!1,w=new t(Q.origin,{body:new Cd,method:"POST",get duplex(){return _=!0,"half"}}).headers.has("Content-Type");return _&&!w}),d=i&&o&&Id(()=>y.isReadableStream(new n("").body)),f={stream:d&&(_=>_.body)};s&&["text","arrayBuffer","blob","formData","stream"].forEach(_=>{!f[_]&&(f[_]=(w,b)=>{let T=w&&w[_];if(T)return T.call(w);throw new D(`Response type '${_}' is not supported`,D.ERR_NOT_SUPPORT,b)})});let p=_=>h(null,null,function*(){if(_==null)return 0;if(y.isBlob(_))return _.size;if(y.isSpecCompliantForm(_))return(yield new t(Q.origin,{method:"POST",body:_}).arrayBuffer()).byteLength;if(y.isArrayBufferView(_)||y.isArrayBuffer(_))return _.byteLength;if(y.isURLSearchParams(_)&&(_=_+""),y.isString(_))return(yield u(_)).byteLength}),m=(_,w)=>h(null,null,function*(){let b=y.toFiniteNumber(_.getContentLength());return b??p(w)});return _=>h(null,null,function*(){let{url:w,method:b,data:T,signal:A,cancelToken:M,timeout:$,onDownloadProgress:B,onUploadProgress:K,responseType:W,headers:ae,withCredentials:ne="same-origin",fetchOptions:hr}=Es(_),We=e||fetch;W=W?(W+"").toLowerCase():"text";let pt=Rd([A,M&&M.toAbortSignal()],$),St=null,st=pt&&pt.unsubscribe&&(()=>{pt.unsubscribe()}),Xi;try{if(K&&c&&b!=="get"&&b!=="head"&&(Xi=yield m(ae,T))!==0){let gt=new t(w,{method:"POST",body:T,duplex:"half"}),zt;if(y.isFormData(T)&&(zt=gt.headers.get("content-type"))&&ae.setContentType(zt),gt.body){let[ks,en]=ji(Xi,lr(Di(K)));T=Fi(gt.body,kd,ks,en)}}y.isString(ne)||(ne=ne?"include":"omit");let Ke=a&&"credentials"in t.prototype,Yi=g(l({},hr),{signal:pt,method:b.toUpperCase(),headers:ae.normalize().toJSON(),body:T,duplex:"half",credentials:Ke?ne:void 0});St=a&&new t(w,Yi);let mt=yield a?We(St,hr):We(w,Yi),Qi=d&&(W==="stream"||W==="response");if(d&&(B||Qi&&st)){let gt={};["status","statusText","headers"].forEach(eo=>{gt[eo]=mt[eo]});let zt=y.toFiniteNumber(mt.headers.get("content-length")),[ks,en]=B&&ji(zt,lr(Di(B),!0))||[];mt=new n(Fi(mt.body,kd,ks,()=>{en&&en(),st&&st()}),gt)}W=W||"text";let Gd=yield f[y.findKey(f,W)||"text"](mt,_);return!Qi&&st&&st(),yield new Promise((gt,zt)=>{Wr(gt,zt,{data:Gd,headers:ie.from(mt.headers),status:mt.status,statusText:mt.statusText,config:_,request:St})})}catch(Ke){throw st&&st(),Ke&&Ke.name==="TypeError"&&/Load failed|fetch/i.test(Ke.message)?Object.assign(new D("Network Error",D.ERR_NETWORK,_,St),{cause:Ke.cause||Ke}):D.from(Ke,Ke&&Ke.code,_,St)}})},sb=new Map,Bi=r=>{let e=r?r.env:{},{fetch:t,Request:n,Response:s}=e,a=[n,s,t],i=a.length,o=i,u,c,d=sb;for(;o--;)u=a[o],c=d.get(u),c===void 0&&d.set(u,c=o?new Map:nb(e)),d=c;return c},Yk=Bi();var qi={http:_s,xhr:Ad,fetch:{get:Bi}};y.forEach(qi,(r,e)=>{if(r){try{Object.defineProperty(r,"name",{value:e})}catch{}Object.defineProperty(r,"adapterName",{value:e})}});var Nd=r=>`- ${r}`,ib=r=>y.isFunction(r)||r===null||r===!1,Ts={getAdapter:(r,e)=>{r=y.isArray(r)?r:[r];let{length:t}=r,n,s,a={};for(let i=0;i<t;i++){n=r[i];let o;if(s=n,!ib(n)&&(s=qi[(o=String(n)).toLowerCase()],s===void 0))throw new D(`Unknown adapter '${o}'`);if(s&&(y.isFunction(s)||(s=s.get(e))))break;a[o||"#"+i]=s}if(!s){let i=Object.entries(a).map(([u,c])=>`adapter ${u} `+(c===!1?"is not supported by the environment":"is not available in the build")),o=t?i.length>1?`since :
`+i.map(Nd).join(`
`):" "+Nd(i[0]):"as no adapter specified";throw new D("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return s},adapters:qi};function Hi(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new rt(null,r)}function Ss(r){return Hi(r),r.headers=ie.from(r.headers),r.data=Gr.call(r,r.transformRequest),["post","put","patch"].indexOf(r.method)!==-1&&r.headers.setContentType("application/x-www-form-urlencoded",!1),Ts.getAdapter(r.adapter||ur.adapter,r)(r).then(function(n){return Hi(r),n.data=Gr.call(r,r.transformResponse,n),n.headers=ie.from(n.headers),n},function(n){return Jr(n)||(Hi(r),n&&n.response&&(n.response.data=Gr.call(r,r.transformResponse,n.response),n.response.headers=ie.from(n.response.headers))),Promise.reject(n)})}var As="1.12.2";var Rs={};["object","boolean","number","function","string","symbol"].forEach((r,e)=>{Rs[r]=function(n){return typeof n===r||"a"+(e<1?"n ":" ")+r}});var $d={};Rs.transitional=function(e,t,n){function s(a,i){return"[Axios v"+As+"] Transitional option '"+a+"'"+i+(n?". "+n:"")}return(a,i,o)=>{if(e===!1)throw new D(s(i," has been removed"+(t?" in "+t:"")),D.ERR_DEPRECATED);return t&&!$d[i]&&($d[i]=!0,console.warn(s(i," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(a,i,o):!0}};Rs.spelling=function(e){return(t,n)=>(console.warn(`${n} is likely a misspelling of ${e}`),!0)};function ob(r,e,t){if(typeof r!="object")throw new D("options must be an object",D.ERR_BAD_OPTION_VALUE);let n=Object.keys(r),s=n.length;for(;s-- >0;){let a=n[s],i=e[a];if(i){let o=r[a],u=o===void 0||i(o,a,r);if(u!==!0)throw new D("option "+a+" must be "+u,D.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new D("Unknown option "+a,D.ERR_BAD_OPTION)}}var Xr={assertOptions:ob,validators:Rs};var nt=Xr.validators,dr=class{constructor(e){this.defaults=e||{},this.interceptors={request:new Ri,response:new Ri}}request(e,t){return h(this,null,function*(){try{return yield this._request(e,t)}catch(n){if(n instanceof Error){let s={};Error.captureStackTrace?Error.captureStackTrace(s):s=new Error;let a=s.stack?s.stack.replace(/^.+\n/,""):"";try{n.stack?a&&!String(n.stack).endsWith(a.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+a):n.stack=a}catch{}}throw n}})}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=Je(this.defaults,t);let{transitional:n,paramsSerializer:s,headers:a}=t;n!==void 0&&Xr.assertOptions(n,{silentJSONParsing:nt.transitional(nt.boolean),forcedJSONParsing:nt.transitional(nt.boolean),clarifyTimeoutError:nt.transitional(nt.boolean)},!1),s!=null&&(y.isFunction(s)?t.paramsSerializer={serialize:s}:Xr.assertOptions(s,{encode:nt.function,serialize:nt.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),Xr.assertOptions(t,{baseUrl:nt.spelling("baseURL"),withXsrfToken:nt.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let i=a&&y.merge(a.common,a[t.method]);a&&y.forEach(["delete","get","head","post","put","patch","common"],_=>{delete a[_]}),t.headers=ie.concat(i,a);let o=[],u=!0;this.interceptors.request.forEach(function(w){typeof w.runWhen=="function"&&w.runWhen(t)===!1||(u=u&&w.synchronous,o.unshift(w.fulfilled,w.rejected))});let c=[];this.interceptors.response.forEach(function(w){c.push(w.fulfilled,w.rejected)});let d,f=0,p;if(!u){let _=[Ss.bind(this),void 0];for(_.unshift(...o),_.push(...c),p=_.length,d=Promise.resolve(t);f<p;)d=d.then(_[f++],_[f++]);return d}p=o.length;let m=t;for(;f<p;){let _=o[f++],w=o[f++];try{m=_(m)}catch(b){w.call(this,b);break}}try{d=Ss.call(this,m)}catch(_){return Promise.reject(_)}for(f=0,p=c.length;f<p;)d=d.then(c[f++],c[f++]);return d}getUri(e){e=Je(this.defaults,e);let t=Kr(e.baseURL,e.url,e.allowAbsoluteUrls);return Zr(t,e.params,e.paramsSerializer)}};y.forEach(["delete","get","head","options"],function(e){dr.prototype[e]=function(t,n){return this.request(Je(n||{},{method:e,url:t,data:(n||{}).data}))}});y.forEach(["post","put","patch"],function(e){function t(n){return function(a,i,o){return this.request(Je(o||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:a,data:i}))}}dr.prototype[e]=t(),dr.prototype[e+"Form"]=t(!0)});var Yr=dr;var zi=class r{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(a){t=a});let n=this;this.promise.then(s=>{if(!n._listeners)return;let a=n._listeners.length;for(;a-- >0;)n._listeners[a](s);n._listeners=null}),this.promise.then=s=>{let a,i=new Promise(o=>{n.subscribe(o),a=o}).then(s);return i.cancel=function(){n.unsubscribe(a)},i},e(function(a,i,o){n.reason||(n.reason=new rt(a,i,o),t(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;let t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){let e=new AbortController,t=n=>{e.abort(n)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new r(function(s){e=s}),cancel:e}}},Ld=zi;function Zi(r){return function(t){return r.apply(null,t)}}function Vi(r){return y.isObject(r)&&r.isAxiosError===!0}var Gi={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Gi).forEach(([r,e])=>{Gi[e]=r});var jd=Gi;function Dd(r){let e=new Yr(r),t=Br(Yr.prototype.request,e);return y.extend(t,Yr.prototype,e,{allOwnKeys:!0}),y.extend(t,e,null,{allOwnKeys:!0}),t.create=function(s){return Dd(Je(r,s))},t}var se=Dd(ur);se.Axios=Yr;se.CanceledError=rt;se.CancelToken=Ld;se.isCancel=Jr;se.VERSION=As;se.toFormData=Ot;se.AxiosError=D;se.Cancel=se.CanceledError;se.all=function(e){return Promise.all(e)};se.spread=Zi;se.isAxiosError=Vi;se.mergeConfig=Je;se.AxiosHeaders=ie;se.formToJSON=r=>vs(y.isHTMLForm(r)?new FormData(r):r);se.getAdapter=Ts.getAdapter;se.HttpStatusCode=jd;se.default=se;var fr=se;var{Axios:XC,AxiosError:YC,CanceledError:QC,isCancel:eP,CancelToken:tP,VERSION:rP,all:nP,Cancel:sP,isAxiosError:aP,spread:iP,toFormData:oP,AxiosHeaders:uP,HttpStatusCode:cP,formToJSON:lP,getAdapter:dP,mergeConfig:fP}=fr;var Bd=Re(Ud(),1);var Ji="axios-retry";function qd(r){let e=["ERR_CANCELED","ECONNABORTED"];return r.response||!r.code||e.includes(r.code)?!1:(0,Bd.default)(r)}var Hd=["get","head","options"],cb=Hd.concat(["put","delete"]);function Wi(r){return r.code!=="ECONNABORTED"&&(!r.response||r.response.status===429||r.response.status>=500&&r.response.status<=599)}function lb(r){return r.config?.method?Wi(r)&&Hd.indexOf(r.config.method)!==-1:!1}function zd(r){return r.config?.method?Wi(r)&&cb.indexOf(r.config.method)!==-1:!1}function Zd(r){return qd(r)||zd(r)}function Ki(r=void 0){let e=r?.response?.headers["retry-after"];if(!e)return 0;let t=(Number(e)||0)*1e3;return t===0&&(t=(new Date(e).valueOf()||0)-Date.now()),Math.max(0,t)}function db(r=0,e=void 0){return Math.max(0,Ki(e))}function fb(r=0,e=void 0,t=100){let n=2**r*t,s=Math.max(n,Ki(e)),a=s*.2*Math.random();return s+a}function hb(r=100){return(e=0,t=void 0)=>{let n=e*r;return Math.max(n,Ki(t))}}var pb={retries:3,retryCondition:Zd,retryDelay:db,shouldResetTimeout:!1,onRetry:()=>{},onMaxRetryTimesExceeded:()=>{},validateResponse:null};function mb(r,e){return l(l(l({},pb),e),r[Ji])}function Fd(r,e,t=!1){let n=mb(r,e||{});return n.retryCount=n.retryCount||0,(!n.lastRequestTime||t)&&(n.lastRequestTime=Date.now()),r[Ji]=n,n}function gb(r,e){r.defaults.agent===e.agent&&delete e.agent,r.defaults.httpAgent===e.httpAgent&&delete e.httpAgent,r.defaults.httpsAgent===e.httpsAgent&&delete e.httpsAgent}function yb(r,e){return h(this,null,function*(){let{retries:t,retryCondition:n}=r,s=(r.retryCount||0)<t&&n(e);if(typeof s=="object")try{return(yield s)!==!1}catch{return!1}return s})}function _b(r,e,t,n){return h(this,null,function*(){e.retryCount+=1;let{retryDelay:s,shouldResetTimeout:a,onRetry:i}=e,o=s(e.retryCount,t);if(gb(r,n),!a&&n.timeout&&e.lastRequestTime){let u=Date.now()-e.lastRequestTime,c=n.timeout-u-o;if(c<=0)return Promise.reject(t);n.timeout=c}return n.transformRequest=[u=>u],yield i(e.retryCount,t,n),n.signal?.aborted?Promise.resolve(r(n)):new Promise(u=>{let c=()=>{clearTimeout(d),u(r(n))},d=setTimeout(()=>{u(r(n)),n.signal?.removeEventListener&&n.signal.removeEventListener("abort",c)},o);n.signal?.addEventListener&&n.signal.addEventListener("abort",c,{once:!0})})})}function bb(r,e){return h(this,null,function*(){r.retryCount>=r.retries&&(yield r.onMaxRetryTimesExceeded(e,r.retryCount))})}var Tt=(r,e)=>{let t=r.interceptors.request.use(s=>(Fd(s,e,!0),s[Ji]?.validateResponse&&(s.validateStatus=()=>!1),s)),n=r.interceptors.response.use(null,s=>h(null,null,function*(){let{config:a}=s;if(!a)return Promise.reject(s);let i=Fd(a,e);return s.response&&i.validateResponse?.(s.response)?s.response:(yield yb(i,s))?_b(r,i,s,a):(yield bb(i,s),Promise.reject(s))}));return{requestInterceptorId:t,responseInterceptorId:n}};Tt.isNetworkError=qd;Tt.isSafeRequestError=lb;Tt.isIdempotentRequestError=zd;Tt.isNetworkOrIdempotentRequestError=Zd;Tt.exponentialDelay=fb;Tt.linearDelay=hb;Tt.isRetryableError=Wi;var Qr=Tt;var Vd=class extends hs{static lc_name(){return"ChatLLM7"}baseUrl;modelName;temperature;maxTokens;timeout;maxRetries;stop;client;constructor(e={}){super(e),this.baseUrl=e.baseUrl??"https://api.llm7.io/v1",this.modelName=e.modelName??"gpt-4.1-nano",this.temperature=e.temperature??1,this.maxTokens=e.maxTokens,this.timeout=e.timeout??120,this.maxRetries=e.maxRetries??3,this.stop=e.stop,this.client=fr.create({baseURL:this.baseUrl,timeout:this.timeout*1e3,headers:{"Content-Type":"application/json"}}),Qr(this.client,{retries:this.maxRetries,retryDelay:Qr.exponentialDelay,retryCondition:t=>Qr.isNetworkError(t)||Qr.isRetryableError(t)||t.response?.status===429})}_llmType(){return"llm7-chat"}_formatMessages(e){return e.map(t=>{let n,s;if(t._getType()==="human")n="user";else if(t._getType()==="ai")n="assistant";else if(t._getType()==="system")n="system";else throw new Error(`Unsupported message type: ${t._getType()}`);if(typeof t.content=="string")s=t.content;else if(Array.isArray(t.content)){let a=t.content.filter(i=>i.type==="text").map(i=>i.text);a.length===0?(console.warn(`Message content array did not contain any text parts: ${JSON.stringify(t.content)}`),s=""):s=a.join(`
`),a.length<t.content.length&&console.warn(`Ignoring non-text parts in message content for role ${n}. LLM7 only supports text.`)}else throw new Error(`Unsupported message content type: ${typeof t.content}`);return{role:n,content:s}})}_createPayload(e,t,n){let s={model:this.modelName,messages:this._formatMessages(e),temperature:this.temperature,stream:t};this.maxTokens!==void 0&&(s.max_tokens=this.maxTokens);let a=[...this.stop??[],...n??[]];return a.length>0&&(s.stop=Array.from(new Set(a))),s}_call(e,t,n){return h(this,null,function*(){let s=this._createPayload(e,!1,t.stop);try{let a=yield this.client.post("/chat/completions",s,{signal:t.signal});if(a.status!==200)throw new Error(`API request failed with status ${a.status}: ${a.statusText} - ${a.data}`);let i=a.data;if(!i.choices?.[0]?.message)throw new Error(`Invalid API response format: ${JSON.stringify(i)}`);return i.choices[0].message.content}catch(a){throw n?.handleLLMError(a),fr.isAxiosError(a)?new Error(`LLM7 API request error: ${a.message} - ${a.response?.status} ${a.response?.data}`):a}})}_streamResponseChunks(e,t,n){return j(this,null,function*(){let s=this._createPayload(e,!0,t.stop),a;try{let w=yield new v(this.client.post("/chat/completions",s,{responseType:"stream",signal:t.signal}));if(w.status!==200){let b="";try{try{for(var o=z(w.data),u,c,d;u=!(c=yield new v(o.next())).done;u=!1){let T=c.value;b+=T.toString()}}catch{d=[c]}finally{try{u&&(c=o.return)&&(yield new v(c.call(o)))}finally{if(d)throw d[0]}}}catch{}throw new Error(`API request failed with status ${w.status}: ${w.statusText} - ${b}`)}a=w.data}catch(w){throw n?.handleLLMError(w),fr.isAxiosError(w)?new Error(`LLM7 API stream request error: ${w.message} - ${w.response?.status} ${w.response?.data}`):w}let i="";try{try{for(var f=z(a),p,m,_;p=!(m=yield new v(f.next())).done;p=!1){let w=m.value;i+=w.toString("utf-8");let b;for(;(b=i.indexOf(`
`))!==-1;){let T=i.substring(0,b).trim();if(i=i.substring(b+1),T===""||!T.startsWith("data:"))continue;let A=T.substring(6);if(A==="[DONE]")return;try{let B=JSON.parse(A).choices?.[0]?.delta?.content;typeof B=="string"&&B!==""&&(yield new rn({message:new Rt({content:B}),text:B}),yield new v(n?.handleLLMNewToken(B)))}catch(M){console.warn(`Failed to parse stream chunk JSON: ${A}`,M)}}}}catch{_=[m]}finally{try{p&&(m=f.return)&&(yield new v(m.call(f)))}finally{if(_)throw _[0]}}}catch(w){throw n?.handleLLMError(w),new Error(`Error processing LLM7 stream: ${w}`)}finally{a&&typeof a.destroy=="function"&&a.destroy()}i.trim()!==""&&console.warn("Streaming finished with unprocessed buffer content:",i)})}};export{Vd as ChatLLM7};
