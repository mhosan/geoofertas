<div class="container-fluid mt-3">
  <div class="row">
    <!-- Columna para las tarjetas de información y acciones -->
    <div class="col-lg-4 col-md-6 mb-3">
      <!-- Card para info de documents -->
      <div class="card border-primary h-100">
        <div class="card-header bg-primary text-white p-2">
          <h6 class="mb-0">Info tabla documents</h6>
        </div>
        <div class="card-body p-2">
          <div *ngIf="documentsInfo">
            <div *ngIf="documentsInfo.error" class="text-danger">{{ documentsInfo.error }}</div>
            <div *ngIf="!documentsInfo.error">
              <div class="mb-2">
                <strong>Cantidad de registros:&nbsp;</strong>
                <span>{{ documentsInfo.count }}</span>
              </div>
              <div class="mb-2">
                <span>Eliminar embedding por ID:&nbsp;</span>
                <input #deleteIdInput type="number"
                  class="form-control form-control-sm d-inline-block w-auto align-middle" placeholder="ID" />
                <button class="btn btn-danger btn-sm mx-2 align-middle"
                  (click)="deleteEmbeddingById(+deleteIdInput.value)">Eliminar</button>
              </div>
            </div>
          </div>
          <div *ngIf="!documentsInfo">
            <span class="text-muted">Cargando información...</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Columna para las pestañas de documentos -->
    <div class="col-lg-8 col-md-6 mb-3">
      <div class="card border-info h-100">
        <!-- Pestañas de Navegación -->
        <div class="card-header d-flex justify-content-between align-items-center p-0">
          <ul class="nav nav-tabs" id="documentosTab" role="tablist">
            <li class="nav-item" role="presentation">
              <button class="nav-link active text-white bg-primary btn-sm" id="primeros-tab" data-bs-toggle="tab"
                data-bs-target="#primeros-tab-pane" type="button" role="tab" aria-controls="primeros-tab-pane"
                aria-selected="true" (click)="setActiveTab('primeros-tab-pane')">Primeros</button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link text-white bg-primary btn-sm" id="ultimos-tab" data-bs-toggle="tab"
                data-bs-target="#ultimos-tab-pane" type="button" role="tab" aria-controls="ultimos-tab-pane"
                aria-selected="false" (click)="setActiveTab('ultimos-tab-pane')">Últimos</button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link text-white bg-primary btn-sm" id="rango-tab" data-bs-toggle="tab"
                data-bs-target="#rango-tab-pane" type="button" role="tab" aria-controls="rango-tab-pane"
                aria-selected="false" (click)="setActiveTab('rango-tab-pane')">Rango</button>
            </li>
          </ul>
          <button class="btn btn-sm btn-light me-2" (click)="closeDocumentsTabs()" title="Cerrar">&times;</button>
        </div>
        <!-- Contenido de las Pestañas -->
        <div class="card-body p-2" style="max-height: 350px; overflow-y: auto;">
          <div class="tab-content" id="documentosTabContent">
            <!-- Pestaña: Primeros registros -->
            <div class="tab-pane fade show active" id="primeros-tab-pane" role="tabpanel" aria-labelledby="primeros-tab"
              tabindex="0">
              <div class="mb-2 d-flex flex-wrap align-items-center">
                <label for="earliestDocumentsCount" class="me-2 mb-0">Cantidad:</label>
                <input id="earliestDocumentsCount" type="number" min="1" [(ngModel)]="earliestDocumentsCount"
                  class="form-control form-control-sm w-auto me-2" />
                <button class="btn btn-primary btn-sm"
                  (click)="loadEarliestDocuments(earliestDocumentsCount)">OK</button>
              </div>
              <div class="table-responsive" *ngIf="showEarliestTable && earliestDocuments.length > 0">
                <table class="table table-sm table-bordered mb-0">
                  <thead>
                    <tr>
                      <th>#</th>
                      <th>ID</th>
                      <th>Texto</th>
                      <th>Fecha creación</th>
                      <th>Modelo</th>
                      <th>Timestamp</th>
                      <th>Source</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let doc of earliestDocuments; let i = index">
                      <td>{{ i + 1 }}</td>
                      <td>{{ doc.id }}</td>
                      <td>{{ doc.content }}</td>
                      <td>{{ doc.created_at | date:'dd/MM/yyyy HH:mm' }}</td>
                      <td>{{ doc.metadata?.model }}</td>
                      <td>{{ doc.metadata?.timestamp | date:'dd/MM/yyyy HH:mm' }}</td>
                      <td>{{ doc.source }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <div *ngIf="!showEarliestTable || earliestDocuments.length === 0">
                <span class="text-muted">(mín: 1)</span>
              </div>
            </div>
            <!-- Pestaña: Últimos registros -->
            <div class="tab-pane fade" id="ultimos-tab-pane" role="tabpanel" aria-labelledby="ultimos-tab" tabindex="0">
              <div class="mb-2 d-flex flex-wrap align-items-center">
                <label for="latestDocumentsCount" class="me-2 mb-0">Cantidad:</label>
                <input id="latestDocumentsCount" type="number" min="1" [(ngModel)]="latestDocumentsCount"
                  class="form-control form-control-sm w-auto me-2" />
                <button class="btn btn-primary btn-sm" (click)="loadLatestDocuments(latestDocumentsCount)">OK</button>
              </div>
              <div class="table-responsive" *ngIf="latestDocuments.length > 0">
                <table class="table table-sm table-bordered mb-0">
                  <thead>
                    <tr>
                      <th>#</th>
                      <th>ID</th>
                      <th>Texto</th>
                      <th>Fecha creación</th>
                      <th>Modelo</th>
                      <th>Timestamp</th>
                      <th>Source</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let doc of latestDocuments; let i = index">
                      <td>{{ i + 1 }}</td>
                      <td>{{ doc.id }}</td>
                      <td>{{ doc.content }}</td>
                      <td>{{ doc.created_at | date:'dd/MM/yyyy HH:mm' }}</td>
                      <td>{{ doc.metadata?.model }}</td>
                      <td>{{ doc.metadata?.timestamp | date:'dd/MM/yyyy HH:mm' }}</td>
                      <td>{{ doc.source }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <div *ngIf="latestDocuments.length === 0">
                <span class="text-muted">(mín: 1)</span>
              </div>
            </div>
            <!-- Pestaña: Rango de documentos -->
            <div class="tab-pane fade" id="rango-tab-pane" role="tabpanel" aria-labelledby="rango-tab" tabindex="0">
              <div class="mb-2 d-flex flex-wrap align-items-center">
                <label for="documentsRangeStartId" class="me-2 mb-0">Desde ID:</label>
                <input id="documentsRangeStartId" type="number" min="1" [(ngModel)]="documentsRangeStartId"
                  class="form-control form-control-sm w-auto me-2" />
                <label for="documentsRangeEndId" class="me-2 mb-0">Hasta ID:</label>
                <input id="documentsRangeEndId" type="number" min="1" [(ngModel)]="documentsRangeEndId"
                  class="form-control form-control-sm w-auto me-2" />
                <button class="btn btn-primary btn-sm"
                  (click)="loadDocumentsRange(documentsRangeStartId, documentsRangeEndId)">OK</button>
              </div>
              <div class="table-responsive" *ngIf="documentsRange.length > 0">
                <table class="table table-sm table-bordered mb-0">
                  <thead>
                    <tr>
                      <th>#</th>
                      <th>ID</th>
                      <th>Texto</th>
                      <th>Fecha creación</th>
                      <th>Modelo</th>
                      <th>Timestamp</th>
                      <th>Source</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let doc of documentsRange; let i = index">
                      <td>{{ i + 1 }}</td>
                      <td>{{ doc.id }}</td>
                      <td>{{ doc.content }}</td>
                      <td>{{ doc.created_at | date:'dd/MM/yyyy HH:mm' }}</td>
                      <td>{{ doc.metadata?.model }}</td>
                      <td>{{ doc.metadata?.timestamp | date:'dd/MM/yyyy HH:mm' }}</td>
                      <td>{{ doc.source }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <div *ngIf="documentsRange.length === 0">
                <span class="text-muted">(mín: 1)</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>



  <div class="row">
    <!-- Sección de tarjetas para info del modelo, salud del modelo, embedding single y multi-embedding -->
    <div class="col-lg-3 col-md-6 mb-3">
      <div class="card h-100">
        <div class="card-header text-white" (click)="toggleCardInfo()">
          <button (click)="modelInfo()" class="btn btn-primary btn-sm">Info del modelo</button>
        </div>
        <div class="card-body" *ngIf="showContentInfo">
          <ul>
            @if (infoModel?.model_name) {
            <li>Nombre del modelo: {{ infoModel?.model_name }}</li>
            }
            @if (infoModel?.description) {
            <li>Descripción: {{ infoModel?.description }}</li>
            }
            @if (infoModel?.dimensions) {
            <li>Dimensiones del modelo: {{ infoModel?.dimensions }}</li>
            }
            @if (infoModel?.language) {
            <li>Idioma: {{ infoModel?.language }}</li>
            }
            @if (infoModel?.use_case) {
            <li>Caso de uso: {{ infoModel?.use_case }}</li>
            }
            @if (infoModel?.max_sequence_length) {
            <li>Longitud máxima de secuencia: {{ infoModel?.max_sequence_length }}</li>
            }
          </ul>
        </div>
      </div>
    </div>

    <div class="col-lg-3 col-md-6 mb-3">
      <div class="card h-100">
        <div class="card-header text-white" (click)="toggleCardHealth()">
          <button (click)="modelHealth()" class="btn btn-primary btn-sm">Salud del modelo</button>
        </div>
        <div class="card-body" *ngIf="showContentHealth">
          <ul>
            @if (infoModelHealth?.status) {
            <li>Estado: {{ infoModelHealth?.status }}</li>
            }
            @if (infoModelHealth?.model) {
            <li>Descripción: {{ infoModelHealth?.model }}</li>
            }
            @if (infoModelHealth?.api_url) {
            <li>URL de la API: {{ infoModelHealth?.api_url }}</li>
            }
            @if (infoModelHealth?.test_embedding_dimensions) {
            <li>Dimensiones de la prueba de incrustación: {{ infoModelHealth?.test_embedding_dimensions }}</li>
            }
            @if (infoModelHealth?.token_configured) {
            <li>Tokenización: {{ infoModelHealth?.token_configured }}</li>
            }
          </ul>
        </div>
      </div>
    </div>

    <div class="col-lg-3 col-md-6 mb-3">
      <div class="card h-100">
        <div class="card-header text-black" (click)="toggleCardEmbeddingSingle()">
          <h5 class="card-title mb-0 btn-text">Single-Embedding</h5>
        </div>
        <div class="card-body" *ngIf="showContentEmbeddingSingle">
          <div class="input-group mb-3">
            <input type="text" class="form-control" placeholder="Ingrese texto para procesar"
              [(ngModel)]="embeddingText">
          </div>
          <button class="btn btn-primary btn-sm" type="button" (click)="getEmbedding()">Obtener Embedding</button>
          <div *ngIf="embeddingResult">
            <h6>Resultado:</h6>
            <pre class="bg-light p-2"
              style="max-height: 230px; overflow: auto;"><code>{{ embeddingResult | json }}</code></pre>
          </div>
        </div>
      </div>
    </div>

    <div class="col-lg-3 col-md-6 mb-3">
      <div class="card h-100">
        <div class="card-header text-black" (click)="toggleCardEmbeddingMulti()">
          <h5 class="card-title mb-0 btn-text">Multi-Embedding</h5>
        </div>
        <div class="card-body" *ngIf="showContentEmbeddingMulti">
          <div class="input-group mb-3">
            <textarea class="form-control" rows="5"
              placeholder='Ingrese textos entre comillas dobles separados por comas: "Texto Uno","Texto Dos"'
              #rawMultiInput></textarea>
          </div>
          <button class="btn btn-primary btn-sm" type="button"
            (click)="handleMultiEmbedding(rawMultiInput.value)">Obtener Multi-Embedding</button>
          <div *ngIf="multiEmbeddingError" class="alert alert-danger mt-2">
            {{ multiEmbeddingError }}
          </div>
          <div *ngIf="multiEmbeddingResult">
            <h6>Resultado:</h6>
            <pre class="bg-light p-2"
              style="max-height: 230px; overflow: auto;"><code>{{ multiEmbeddingResult | json }}</code></pre>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Card para Búsqueda de Embeddings -->
  <div class="row mt-3">
    <div class="col-12">
      <div class="card border-success">
        <div class="card-header bg-primary text-white">
          <h5 class="card-title mb-0">Búsqueda de Embeddings</h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-8">
              <div class="input-group mb-3">
                <span class="input-group-text">Texto:</span>
                <input type="text" class="form-control" placeholder="Ingrese texto para buscar"
                  [(ngModel)]="searchQuery">
              </div>
            </div>
            <div class="col-md-2">
              <div class="input-group mb-3">
                <span class="input-group-text">Límite:</span>
                <input type="number" class="form-control" [(ngModel)]="searchLimit">
              </div>
            </div>
            <div class="col-md-2">
              <button class="btn btn-primary w-100" type="button" (click)="searchEmbedding()">Buscar</button>
            </div>
          </div>

          <div *ngIf="showSearchResults" class="mt-3">
            <h6>Resultados de la búsqueda:</h6>
            <div class="table-responsive">
              <table class="table table-sm table-bordered">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>ID</th>
                    <th>Contenido</th>
                    <th>Similitud</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let doc of searchResults; let i = index">
                    <td>{{ i + 1 }}</td>
                    <td>{{ doc.id }}</td>
                    <td>{{ doc.content }}</td>
                    <td>{{ doc.similarity | number:'1.0-6' }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>
</div>